/**
 * IPS Social Suite 4
 * (c) 2013 Invision Power Services - http://www.invisionpower.com
 * This file contains minified javascript and is not directly editable
 */

;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.app',{initialize:function(){this.on('click','a.noscript_fallback, a.ipsJS_preventEvent',this.noScriptFallback);this.on('click','[data-clickshow]',this.clickShow);this.on('click','[data-clickhide]',this.clickHide);this.on('click','[data-clickempty]',this.clickEmpty);this.on('click','[data-delete]',this.deleteSomething);this.on('click','a[data-confirm]',this.confirmSomething);this.on('click','[data-doajax]',this.doAjaxAction);this.setup();},setup:function(){this.scope.addClass('ipsJS_has').removeClass('ipsJS_none');},doAjaxAction:function(e){e.preventDefault();ips.getAjax()($(e.currentTarget).attr('href'),{dataType:'json'}).done(function(response){ips.ui.flashMsg.show(response);}).fail(function(jqXHR){if(Debug.isEnabled()){Debug.error(jqXHR.responseText);}else{window.location=$(e.currentTarget).attr('href');}});},deleteSomething:function(e){e.preventDefault();var elem=$(e.currentTarget);var extraWarning=elem.attr('data-delete-warning');ips.ui.alert.show({type:'confirm',icon:'warn',message:ips.getString('delete_confirm'),subText:extraWarning||'',callbacks:{ok:function(){if(elem.attr('data-noajax')!==undefined){window.location=elem.attr('href');return;}
var row=null;if(elem.attr('data-deleterow')){row=$(elem.attr('data-deleterow'));}else{row=elem.closest('tr, .row, [data-role=node]');}
ips.getAjax()(elem.attr('href'),{showLoading:true,data:{form_submitted:1}}).done(function(response){if(row.hasClass('parent')){row.next().remove();}
ips.utils.anim.go('fadeOut',row);}).fail(function(){window.location=elem.attr('href');});}}});},confirmSomething:function(e){e.preventDefault();var elem=$(e.currentTarget);var customMessage=$(e.currentTarget).attr('data-confirmMessage');var customSubMessage=$(e.currentTarget).attr('data-confirmSubMessage');var type=$(e.currentTarget).attr('data-confirmType');var icon=$(e.currentTarget).attr('data-confirmIcon');var alert={type:(type)?type:'confirm',icon:(icon)?icon:'warn',message:(customMessage)?customMessage:ips.getString('generic_confirm'),subText:(customSubMessage)?customSubMessage:'',callbacks:{ok:function(){window.location=elem.attr('href');},yes:function(){window.location=elem.attr('href')+'&prompt=1';},no:function(){window.location=elem.attr('href')+'&prompt=0';}}};if($(e.currentTarget).attr('data-confirmButtons')){alert.buttons=$.parseJSON($(e.currentTarget).attr('data-confirmButtons'));}
ips.ui.alert.show(alert);},clickShow:function(e){e.preventDefault();var elems=ips.utils.getIDsFromList($(e.currentTarget).attr('data-clickshow'));this.scope.find(elems).show().removeClass('ipsHide');},clickHide:function(e){e.preventDefault();var elems=ips.utils.getIDsFromList($(e.currentTarget).attr('data-clickhide'));this.scope.find(elems).hide().addClass('ipsHide');},clickEmpty:function(e){e.preventDefault();var elems=ips.utils.getIDsFromList($(e.currentTarget).attr('data-clickempty'));this.scope.find(elems).val('');},noScriptFallback:function(e){e.preventDefault();}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.dynamicChart',{storedValues:{},identifier:'',type:'',initialize:function(){this.on('click','[data-timescale]',this.changeTimescale);this.on(document,'submit','[data-role="dateForm"]',this.changeDateRange);this.on('menuItemSelected','[data-action="chartFilter"]',this.changeFilter);this.on('click','[data-type]',this.changeChartType);this.setup();},setup:function(){var self=this;this.identifier=this.scope.attr('data-chart-identifier');this.storedValues.timescale=this.scope.find('[data-timescale][data-selected]').attr('data-timescale');this.storedValues.type=this.scope.find('[data-type][data-selected]').attr('data-type');this.storedValues.filters=[];this.storedValues.dates={start:'',end:''};this.type=this.scope.attr('data-chart-type');this.timescale=this.scope.attr('data-chart-timescale');$('#el'+this.identifier+'Filter_menu').find('.ipsMenu_itemChecked').each(function(){self.storedValues.filters.push($(this).attr('data-ipsMenuValue'));});},changeTimescale:function(e){this.timescale=$(e.currentTarget).attr('data-timescale');this._toggleButtonRow(e,'timescale');},changeChartType:function(e){this.type=$(e.currentTarget).attr('data-type');this._toggleButtonRow(e,'type');this.checkType();},checkType:function(){if(this.type=='Table'){$(this.scope).find('[data-role="groupingButtons"] a.ipsButton').addClass('ipsButton_disabled ipsButton_veryLight').removeClass('ipsButton_primary');}else{$(this.scope).find('[data-role="groupingButtons"] a.ipsButton').removeClass('ipsButton_disabled');$(this.scope).find('a.ipsButton[data-timescale="'+this.timescale+'"]').removeClass('ipsButton_veryLight').addClass('ipsButton_primary');}},changeFilter:function(e,data){data.originalEvent.preventDefault();if(_.indexOf(this.storedValues.filters,data.selectedItemID)!==-1){this.storedValues.filters.splice(_.indexOf(this.storedValues.filters,data.selectedItemID),1);}else{this.storedValues.filters.push(data.selectedItemID);}
data.menuElem.trigger('closeMenu');this._updateURL();},changeDateRange:function(e){e.preventDefault();var form=$('#el'+this.identifier+'Date_menu');this.storedValues.dates.start=form.find('[name="start"]').val();this.storedValues.dates.end=form.find('[name="end"]').val();form.trigger('closeMenu');this._updateURL();},_toggleButtonRow:function(e,type){e.preventDefault();var val=$(e.currentTarget).attr('data-'+type);this.scope.find('[data-'+type+']').removeClass('ipsButton_primary').addClass('ipsButton_veryLight').removeAttr('data-selected').filter('[data-'+type+'="'+val+'"]').addClass('ipsButton_primary').removeClass('ipsButton_veryLight').attr('data-selected',true);this.storedValues[type]=val;this._updateURL();},_updateURL:function(){var url=this._buildURL();var chartArea=this.scope.find('[data-role="chart"]');chartArea.css('height',chartArea.height()).html('').addClass('ipsLoading');ips.getAjax()(this.scope.attr('data-chart-url'),{data:url}).done(function(response){chartArea.css('height','auto').html(response);$(document).trigger('contentChange',[chartArea]);}).always(function(){chartArea.removeClass('ipsLoading');});},_buildURL:function(){var pieces=[];var self=this;pieces.push("noheader=1");pieces.push("timescale["+this.identifier+"]="+this.storedValues.timescale);pieces.push("type["+this.identifier+"]="+this.storedValues.type);_.each(this.storedValues.filters,function(value,idx){pieces.push("filters["+self.identifier+"]["+idx+"]="+value);});if(this.storedValues.dates.start||this.storedValues.dates.start){pieces.push("start["+this.identifier+"]="+this.storedValues.dates.start);pieces.push("end["+this.identifier+"]="+this.storedValues.dates.end);}
return pieces.join('&');}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.genericDialog',{initialize:function(){this.on('submit','form',this.submitAjaxForm);$(document).on('multipleRedirectFinished',_.bind(this.dismissDialog,this));},submitAjaxForm:function(e){if($(e.currentTarget).attr('data-bypassValidation')){return;}
e.preventDefault();var dialog=this.scope.closest('.ipsDialog');if(!dialog.length){return;}
var elemId=dialog.attr('id').replace(/_dialog$/,'');var dialogObj=ips.ui.dialog.getObj($('#'+elemId));if(!dialogObj){return;}
dialogObj.setLoading(true);ips.getAjax()($(e.currentTarget).attr('action')+'&ajaxValidate=1',{data:$(e.currentTarget).serialize(),type:'post'}).done(function(response,textStatus,jqXHR){if(jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormError: true')!==-1){dialogObj.updateContent(jqXHR.responseText);$(document).trigger('contentChange',[$('#'+elemId)]);dialogObj.setLoading(false);}else if(jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormNoSubmit: true')!==-1){dialogObj.updateContent(jqXHR.responseText);$(document).trigger('contentChange',[$('#'+elemId)]);dialogObj.setLoading(false);}else{$(e.currentTarget).attr('data-bypassValidation',true).submit();}}).fail(function(jqXHR,textStatus,errorThrown){if(Debug.isEnabled()){Debug.error("Ajax request failed ("+status+"): "+errorThrown);Debug.error(jqXHR.responseText);}else{$(e.currentTarget).attr('data-bypassValidation',true).submit();}});},dismissDialog:function(e){var elemId=$('.ipsDialog').attr('id').replace(/_dialog$/,'');var dialogObj=ips.ui.dialog.getObj($('#'+elemId));dialogObj.hide();$('#'+elemId).data('_dialog','')}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.liveSearch',{_textField:null,_searchMenu:null,_resultsContainer:null,_lastValue:'',_results:{},_timers:{},_modal:null,_activePanel:null,_ajax:{},initialize:function(){this.setup();this.on(document,'focus','#acpSearchKeyword',this.fieldFocus);this.on(document,'blur','#acpLiveSearch',this.fieldBlur);this.on(document,'click','.ipsModal',this.clickModal);this.on('itemClicked.sideMenu',this.changeSection);},setup:function(){this._searchMenu=this.scope.find('[data-role="searchMenu"]');this._resultsContainer=this.scope.find('[data-role="searchResults"]');this._textField=$('#acpSearchKeyword');this._textField.prop('autocomplete','off').prop('spellcheck',false).attr('aria-autocomplete','list').attr('aria-haspopup','true');this._activePanel=this._searchMenu.find('.ipsSideMenu_itemActive').attr('data-ipsMenuValue');},changeSection:function(e,data){this._activePanel=data.selectedItemID;this.scope.find('[data-ipsMenuValue] [data-role="resultCount"]').removeClass('ipsLoading_dark ipsSideMenu_clearCount');this.scope.find('[data-ipsMenuValue="'+data.selectedItemID+'"] [data-role="resultCount"]').addClass('ipsLoading_dark');this._showResultsInPanel(this._activePanel,this._results[this._activePanel]);},fieldFocus:function(e){this._timers.focus=setInterval(_.bind(this._timerFocus,this),700);if(this._textField.val()&&this._textField.val().length>=3){this._showResults();}},fieldBlur:function(e){clearInterval(this._timers);},clickModal:function(e){if($(e.currentTarget).attr('id')!=this._modal.attr('id')){return;}
this._hideResults();},_timerFocus:function(){var currentValue=this._textField.val();if(currentValue==this._lastValue||this._textField.val().length<4){return;}
this._lastValue=currentValue;this._showResults();this._loadResults();},_hideResults:function(){ips.utils.anim.go('fadeOut fast',this._modal);ips.utils.anim.go('fadeOut',this.scope);},_showResults:function(){if(!this._modal){this._buildModal();}
this._modal.css({zIndex:ips.ui.zIndex()});$('#ipsLayout_header').css({zIndex:ips.ui.zIndex()});this.scope.css({zIndex:ips.ui.zIndex()});if(!this.scope.is(':visible')){ips.utils.anim.go('fadeIn fast',this.scope);}
if(!this._modal.is(':visible')){ips.utils.anim.go('fadeIn fast',this._modal);}},_loadResults:function(){var self=this;if(this._ajax){for(var i=0;i<this._ajax.length;i++){if(_.isFunction(this._ajax[i].abort)){this._ajax[i].abort();}}}
this.scope.find('[data-ipsMenuValue] [data-role="resultCount"]').addClass('ipsLoading ipsPad_top').html('&nbsp;');this.scope.find('[data-ipsMenuValue] [data-role="resultCount"]').removeClass('ipsLoading_dark ipsSideMenu_clearCount');this.scope.find('[data-ipsMenuValue].ipsSideMenu_itemActive [data-role="resultCount"]').addClass('ipsLoading_dark ipsSideMenu_clearCount');var value=this._lastValue;this.scope.find('[data-ipsMenuValue]').each(function(){var tab=this;var key=$(this).attr('data-ipsMenuValue');self._setPanelToLoading(key);self._ajax[key]=ips.getAjax()('?app=core&module=system&controller=livesearch',{dataType:'json',data:{search_key:key,search_term:encodeURI(value)}}).done(function(response){self._results[key]=response;$(tab).find('[data-role="resultCount"]').removeClass('ipsLoading ipsPad_top ipsLoading_dark ipsSideMenu_clearCount').text(parseInt(response.length)).end().toggleClass('ipsSideMenu_itemDisabled',(response.length===0)?true:false);if($(tab).attr('data-ipsMenuValue')==self._activePanel){self._showResultsInPanel(self._activePanel,response,true);}
if(!self._searchMenu.find('[data-ipsMenuValue].ipsSideMenu_itemActive:not( .ipsSideMenu_itemDisabled )').length){self._selectFirstResultsTab();}}).fail(function(err){});});},_selectFirstResultsTab:function(){var first=this._searchMenu.find('[data-ipsMenuValue]:not( .ipsSideMenu_itemDisabled )').first();first.click();},_setPanelToLoading:function(panel){var panelContainer=this._resultsContainer.find('[data-resultsSection="'+panel+'"]');panelContainer.addClass('ipsLoading').find('> ol').hide();},_showResultsInPanel:function(panel,results,animate){this._resultsContainer.find('[data-resultsSection]').hide();var panelContainer=this._resultsContainer.find('[data-resultsSection="'+panel+'"]');var panelList=panelContainer.find('> ol');if(!panelContainer.length){this._buildResultsContainer(panel);panelContainer=this._resultsContainer.find('[data-resultsSection="'+panel+'"]');panelList=panelContainer.find('> ol');}
panelContainer.removeClass('ipsLoading');panelList.hide().html('');if(_.isUndefined(results)||_.isUndefined(results)||_.size(results)==0){panelList.html(ips.templates.render('core.livesearch.noResults')).show();return;}
_.each(results,function(val){panelList.append(val);});var resultItems=panelList.find('[data-role="result"]').hide();var delay=25;panelList.show();panelContainer.show();if(animate==true){resultItems.each(function(){var item=$(this);setTimeout(function(){ips.utils.anim.go('fadeIn fast',item);},delay);delay+=25;});}else{resultItems.show();}},_buildResultsContainer:function(panel){this._resultsContainer.append($('<div/>').attr('data-resultsSection',panel).addClass('ipsScrollbar').append($('<ol/>').addClass('ipsList_reset')));},_buildModal:function(){this._modal=ips.ui.getModal();}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.nav',{_reordering:false,_orderChanged:false,_currentMenu:null,_menuTimer:null,initialize:function(){this.setup();this.on(document,'click','#acpMainArea',this.clickMainArea);this.on('click','[data-action="reorder"]',this.startReorder);this.on('click','[data-action="saveOrder"]',this.saveOrder);this.on('click','#elHideMenu',this.toggleMenu);},setup:function(){var self=this;var activating;this._currentMenu=this.scope.find('.acpAppList_active');$('#acpAppMenu').menuAim({rowSelector:"> #acpAppList > li",enter:function(row){if($(row).attr('id')=='elReorderAppMenu'||$(row).attr('id')=='elHideMenu'){activating=self.scope.find('.acpAppList_active');}
if(self._menuTimer){clearTimeout(self._menuTimer);}},activate:function(row){if($(row).attr('id')=='elReorderAppMenu'||$(row).attr('id')=='elHideMenu'){activating.addClass('acpAppList_active');}else{$(row).addClass('acpAppList_active');}},deactivate:function(row){$(row).removeClass('acpAppList_active');},exitMenu:function(){self._menuTimer=setTimeout(function(){self.scope.find('.acpAppList_active').removeClass('acpAppList_active');self._currentMenu.addClass('acpAppList_active');},2000);return false;}});},toggleMenu:function(e){e.preventDefault();if($('body').hasClass('cAdminHideMenu')){$('body').removeClass('cAdminHideMenu');ips.utils.cookie.unset('hideAdminMenu');}else{$('body').addClass('cAdminHideMenu');ips.utils.cookie.set('hideAdminMenu',true,true);}},clickMainArea:function(e){if(!this._reordering){$('#acpAppList').removeClass('acpAppList_childHovering').find('> li').trigger('mouseleave');}},startReorder:function(){var self=this;this.scope.find('> li:not( #elReorderAppMenu ):not( #elHideMenu ) > a').each(function(){$(this).append(ips.templates.render('core.appMenu.reorder'));});this.scope.find('> li > ul > li h3').each(function(){$(this).prepend(ips.templates.render('core.appMenu.reorder'));});ips.utils.anim.go('zoomIn',this.scope.find('[data-role="reorder"]'));this.scope.addClass('acpAppList_reordering').sortable({start:function(e,ui){ui.item.addClass('acpAppList_dragging');},stop:function(e,ui){ui.item.removeClass('acpAppList_dragging');},update:function(){self._orderChanged=true;}}).find('#elReorderAppMenu').find('[data-action="reorder"]').addClass('ipsHide').end().find('[data-action="saveOrder"]').removeClass('ipsHide');this.scope.find('> li > ul').sortable({start:function(e,ui){ui.item.addClass('acpAppList_dragging');},stop:function(e,ui){ui.item.removeClass('acpAppList_dragging');},update:function(){self._orderChanged=true;}});this._reordering=true;this._orderChanged=false;},saveOrder:function(){this.scope.find('[data-role="reorder"]').remove();var tabOrder=this.scope.sortable('toArray',{attribute:'data-tab'});var subMenus={};var self=this;_.each(tabOrder,function(val){if(val){subMenus[val]=self.scope.find('> li[data-tab="'+val+'"] > ul').sortable('toArray',{attribute:'data-menuKey'});}});this.scope.removeClass('acpAppList_reordering').find('#elReorderAppMenu').find('[data-action="reorder"]').removeClass('ipsHide').end().find('[data-action="saveOrder"]').addClass('ipsHide');if(this._orderChanged){ips.getAjax()('?app=core&module=system&controller=ajax&do=saveTabs',{data:{tabOrder:tabOrder,menuOrder:subMenus},dataType:'json',type:'post'}).done(function(response){ips.ui.flashMsg.show(ips.getString('tab_order_saved'));}).fail(function(){ips.ui.alert.show({type:'alert',icon:'warning',message:ips.getString('tab_order_not_saved'),callbacks:{ok:function(){}}});});}
this.scope.sortable('destroy');this._reordering=false;}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.admin.core.nodeCopySetting',{initialize:function(){this.on('click',this.click);},click:function(e){if($(this.scope).next().hasClass('ipsSelectTree'))
{$(this.scope).attr('href',$(this.scope).attr('href')+'&value='+$(this.scope).next('ipsSelectTree').find("input").first().val());}
else
{$(this.scope).attr('href',$(this.scope).attr('href')+'&value='+$(this.scope).nextAll("input:not([type=hidden]),textarea,select").first().val());}}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.mixin('acpTable','core.global.core.table',true,function(){this._timer=null;this._searchField=null;this._curSearchValue='';this._currentValue='';this.after('initialize',function(){this.on('focus','[data-role="tableSearch"]',this.startLiveSearch);this.on('blur','[data-role="tableSearch"]',this.endLiveSearch);this.on('click','[data-action="tableSort"]',this.changeSorting);this.on('menuItemSelected','#elSortMenu',this.sortByMenu);this.on('menuItemSelected','#elOrderMenu',this.orderByMenu);});this.before('setup',function(){this._searchField=this.scope.find('[data-role="tableSearch"]');this.scope.find('[data-role="tableSearch"]').removeClass('ipsHide').show();});this.around('_getUrlParams',function(origFn){return _.extend(origFn(),{quicksearch:this._getSearchValue()||''});});this.after('_updateSort',function(data){var directions='ipsTable_sortableAsc ipsTable_sortableDesc';this.scope.find('[data-role="table"] [data-action="tableSort"]').removeClass('ipsTable_sortableActive').removeAttr('aria-sort').end().find('[data-action="tableSort"][data-key="'+data.by+'"]').addClass('ipsTable_sortableActive').removeClass(directions).addClass('ipsTable_sortable'+data.order.charAt(0).toUpperCase()+data.order.slice(1)).attr('aria-sort',(data.order=='asc')?'ascending':'descending');$('#elSortMenu_menu, #elOrderMenu_menu').find('.ipsMenu_item').removeClass('ipsMenu_itemChecked').end().find('[data-ipsMenuValue="'+data.by+'"], [data-ipsMenuValue="'+data.order+'"]').addClass('ipsMenu_itemChecked');});this.after('_handleStateChanges',function(state){if(!_.isUndefined(state.data.quicksearch)&&state.data.quicksearch!=this._urlParams.quicksearch){this._updateSearch(state.data.quicksearch);}});this.sortByMenu=function(e,data){data.originalEvent.preventDefault();this._updateSort({by:data.selectedItemID});};this.orderByMenu=function(e,data){data.originalEvent.preventDefault();this._updateSort({order:data.selectedItemID});};this.changeSorting=function(e){e.preventDefault();var cell=$(e.currentTarget);var order='';if(cell.hasClass('ipsTable_sortableActive')){order=(cell.hasClass('ipsTable_sortableDesc'))?'asc':'desc';}else{order=(cell.hasClass('ipsTable_sortableDesc'))?'desc':'asc';}
this._updateSort({by:cell.attr('data-key'),order:order});};this.startLiveSearch=function(e){this._timer=setInterval(_.bind(this._checkSearchValue,this),500);};this.endLiveSearch=function(e){clearInterval(this._timer);};this._checkSearchValue=function(){var val=this._searchField.val();if(this._currentValue!=val){this.updateURL({quicksearch:val,page:1});this._currentValue=val;}};this._updateSearch=function(searchValue){this._searchField.val(searchValue);};this._updateFilter=function(newFilter){this.scope.find('[data-role="tableSortBar"] [data-action="tableFilter"] a').removeClass('ipsButtonRow_active').end().find('[data-action="tableFilter"][data-filter="'+newFilter+'"] a').addClass('ipsButtonRow_active');};this._getSortValue=function(){var sortBy=this.scope.find('[data-role="table"] thead .ipsTable_sortable.ipsTable_sortableActive');var sortOrder='desc';if(sortBy.hasClass('ipsTable_sortableAsc')){sortOrder='asc';}
return{by:sortBy.attr('data-key'),order:sortOrder};};this._getFilterValue=function(){var sortBar=this.scope.find('[data-role="tableSortBar"]');if(!sortBar.length){return'';}
return sortBar.find('.ipsButtonRow_active').closest('[data-filter]').attr('data-filter');};this._getSearchValue=function(){if(ips.utils.url.getParam('quicksearch')){return ips.utils.url.getParam('quicksearch');}
return this.scope.find('[data-role="tableSearch"]').val();};});}(jQuery,_));;
/* MENUS */
ips.templates.set('core.appMenu.reorder', " \
	<span data-role='reorder' style='display: none'><i class='fa fa-bars'></i></span>\
");

/* CONTROL STRIP TEMPLATES */
ips.templates.set('core.controlStrip.menu', " \
	<ul class='ipsMenu ipsMenu_auto' role='menu' id='{{id}}_menu' style='display: none'>\
		{{{content}}}\
	</ul>\
");

ips.templates.set('core.controlStrip.menuItem', " \
	<li class='ipsMenu_item ipsControlStrip_menuItem' role='menuitem' id='{{id}}'>\
		{{{item}}}\
	</li>\
");

ips.templates.set('core.controlStrip.dropdown', " \
	<li class='ipsControlStrip_button ipsControlStrip_dropdown' data-dropdown id='{{id}}'>\
		<a href='#'>\
			<i class='ipsControlStrip_icon fa fa-caret-down'></i>\
		</a>\
	</li>\
");

/* TOGGLE TEMPLATES */
ips.templates.set('core.forms.toggle', " \
	<span class='ipsToggle {{className}}' id='{{id}}' tabindex='0'>\
		<span data-role='status'>{{status}}</span>\
	</span>\
");

/* TREES */
ips.templates.set('core.trees.childWrapper', " \
	{{{content}}}\
");

ips.templates.set('core.trees.loadingRow', " \
	<ol class='ipsTree'><li class='ipsTree_loadingRow ipsLoading_tiny'>{{#lang}}loading{{/lang}}</li></ol>\
");

ips.templates.set('core.trees.loadingPane', " \
	<div class='ipsLoading' style='height: 150px'>&nbsp;</div>\
");

ips.templates.set('core.trees.noRows', " \
	<div class='ipsType_center ipsPad ipsType_light'>{{#lang}}no_results{{/lang}}</div>\
");

/* LIVE SEARCH */
ips.templates.set('core.livesearch.noResults', " \
	<li class='ipsType_center ipsPad ipsType_light ipsType_normal' data-role='result'>\
		<br><br>\
	</li>\
");

/* LANGUAGES */
ips.templates.set('languages.translateString', " \
	<div class='cTranslateTable_field'>\
		<textarea>{{value}}</textarea>\
		<a href='#' data-action='saveWords' tabindex='-1' class='ipsButton ipsButton_positive ipsButton_verySmall ipsButton_narrow'><i class='fa fa-check'></i> {{#lang}}save{{/lang}}</a>\
		<!--<a href='#' data-action='revertWords' class='ipsButton ipsButton_negative ipsButton_verySmall ipsButton_narrow'><i class='fa fa-times'></i></a>-->\
	</div>\
");;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.controlStrip',function(){var respond=function(elem,options){if(!$(elem).data('_controlStrip')){$(elem).data('_controlStrip',controlStripObj(elem));}};ips.ui.registerWidget('controlStrip',ips.ui.controlStrip);return{respond:respond};});var controlStripObj=function(elem){var init=function(){var buttons=elem.find('.ipsControlStrip_button:not(.ipsJS_hide)');if(buttons.length>3){_buildMenu(buttons);}
elem.on('click','[data-replace], [data-remove], [data-bubble]',_remoteAction);},_remoteAction=function(e){e.preventDefault();var link=$(e.currentTarget);var url=link.attr('href');ips.getAjax()(url,{dataType:'json',showLoading:true}).done(function(response){if(link.is('[data-replace]')){_replaceButton(link,response);}else if(link.is('[data-remove]')){_removeButton(link,response);}else if(link.is('[data-bubble]')){_bubbleAction(link,response);}}).fail(function(){window.location=url;});},_bubbleAction=function(link,response){link.trigger('buttonAction',response);},_replaceButton=function(link,response){ips.ui.flashMsg.show(response);var item=link.closest('.ipsControlStrip_button, .ipsControlStrip_menuItem');var newItem=$('#'+link.attr('data-replacewith'));if(item.hasClass('ipsControlStrip_button')){item.hide();newItem.show();}else{if(!newItem.hasClass('ipsControlStrip_menuItem')){var newHTML=_getMenuItemFromButton(newItem);item.hide().after(newHTML);}else{item.hide();newItem.show();}}},_removeButton=function(link,response){ips.ui.flashMsg.show(response);var dropdown=$(elem).find('[data-dropdown]');if(link.attr('data-alsoremove')){var also=ips.utils.getIDsFromList(link.attr('data-alsoremove'));}
var toRemove=$(link).add(also||'').closest('.ipsControlStrip_button, .ipsControlStrip_menuItem');toRemove.remove();if(dropdown.length){var menu=$(dropdown.attr('id')+'_menu');if(!menu.find('.ipsControlStrip_menuItem').length){menu.remove();dropdown.remove();}}},_buildMenu=function(buttons){var buttonsToMove=buttons.slice(2);var menu=ips.templates.render('core.controlStrip.menu',{id:elem.identify().attr('id')+'_more',content:_moveButtonsToMenu(buttonsToMove)});$(elem).after(menu);buttonsToMove.remove();elem.css({position:'relative'}).find('.ipsControlStrip_button').last().after(ips.templates.render('core.controlStrip.dropdown',{id:elem.identify().attr('id')+'_more'}));elem.parent().wrapInner($('<div/>').css({position:'relative'})).find('[data-dropdown]').attr('aria-haspopup','true').ipsMenu({appendTo:'#'+elem.parent().identify().attr('id')});$(document).trigger('contentChange',[elem]);},_moveButtonsToMenu=function(buttons){var menuContent='';for(var i=0;i<buttons.length;i++){menuContent+=_getMenuItemFromButton(buttons[i]);}
return menuContent;},_getMenuItemFromButton=function(button){var buttonLink=$(button).find('> a');$(button).find('[data-ipsTooltip]').removeAttr('data-ipsTooltip');return ips.templates.render('core.controlStrip.menuItem',{id:$(button).attr('id')||'',item:$(button).html()});};init();return{};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('textarea.customtags',{initialize:function(){this.on('click','[data-textareacustomtag]',this.insertTag);},insertTag:function(e){console.log('Inserting custom tag: '+$(e.currentTarget).attr('data-textareacustomtag'));$('#'+this.scope.data('textareaid')).focus();$('#'+this.scope.data('textareaid')).insertText($(e.currentTarget).attr('data-textareacustomtag'),$('#'+this.scope.data('textareaid')).getSelection().start,"collapseToEnd");}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.matrix',function(){var defaults={manageable:true};var respond=function(elem,options){if(!$(elem).data('_matrix')){$(elem).data('_matrix',matrixObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('matrix',ips.ui.matrix,['manageable']);return{respond:respond};});var matrixObj=function(elem,options){var init=function(){_setUpEvent();if(options.manageable){_setUpManageable();}},_setUpEvent=function(){elem.on('click','td, th',_clickCell);elem.on('click','td input, th input',_clickInputInCell);elem.on('click','.matrixAdd',_addRow);elem.on('click','.matrixDelete',_deleteRow);elem.on('click','[data-action="checkRow"]',_checkRow);elem.on('click','[data-action="unCheckRow"]',_unCheckRow);elem.on('change','[data-action="checkAll"]',_checkAll);elem.on('change','td input[type="checkbox"]',_checkboxChanged);elem.closest('form').on('submit',_submitForm);},_checkboxChanged=function(e){var col=$(e.currentTarget).closest('[data-col]').attr('data-col');var colHead=elem.find('[data-checkallheader="'+col+'"]');if(_.isUndefined(col)||!elem.find('[data-checkallheader="'+col+'"]').length){return;}
var similar=elem.find('[data-col="'+col+'"] input[type="checkbox"]');colHead.prop('checked',similar.filter(':checked').length==similar.length);},_clickCell=function(e){if(!$(e.target).is('td')&&!$(e.target).is('th')){return;}
var input=$(e.currentTarget).find('input:not([type="hidden"]),select,textarea');if(input.attr('type')=='checkbox'){input.click();}else{input.focus();}},_checkRow=function(e){e.preventDefault();$(e.target).closest('tr').find('input[type="checkbox"]').prop('checked',true).trigger('change');},_unCheckRow=function(e){e.preventDefault();$(e.target).closest('tr').find('input[type="checkbox"]').prop('checked',false).trigger('change');},_checkAll=function(e){var regex='^.*\\['+$(this).attr('data-checkallheader')+'_checkbox\\]$';$(this).closest('table.ipsMatrix').find('input[type="checkbox"]').filter(function(){return $(this).attr('name').match(regex);}).prop('checked',$(this).is(':checked'));},_deleteRow=function(e){e.preventDefault();var row=$(this).closest('tr');row.closest('form').find('input[data-matrixrowid="'+row.attr('data-matrixrowid')+'"]').val(0);ips.utils.anim.go('fadeOut',row).done(function(){row.remove();_checkRows();});},_addRow=function(e){var table=elem.find('.ipsTable[data-matrixID="'+$(this).attr('data-matrixID')+'"]');var blankRow=table.find('tbody tr:not( .ipsMatrix_empty ):last-child');var newRow=blankRow.clone();newRow.insertBefore(blankRow);var index=newRow.index();newRow.find('input,textarea,select,option').each(function(){var input=$(this);if(input.attr('name')){input.attr('name',input.attr('name').replace(/_new_\[x\]/g,'_new_['+index+']')).show();}
if(input.attr('id')){input.attr('id',input.attr('id').replace(/_new__x_/g,'_new__'+index+'_'));}
if(input.attr('data-toggles')){input.attr('data-toggles',input.attr('data-toggles').replace(/_new__x_/g,'_new__'+index+'_'));}});_checkRows();$(document).trigger('contentChange',[newRow]);ips.utils.anim.go('fadeIn',newRow);$('html, body').animate({scrollTop:newRow.offset().top});newRow.find('input,textarea,select').first().focus();return false;},_checkRows=function(){if(elem.find('[data-matrixrowid]:visible').length>0)
{elem.find('.ipsMatrix_empty').hide();}
else
{elem.find('.ipsMatrix_empty').show();}},_clickInputInCell=function(e){e.stopPropagation();},_submitForm=function(e){elem.find('.matrixBlankRow').find('input, select, textarea').attr('name','');},_setUpManageable=function(){elem.find('tr:last-child').find('input, select[required], textarea').removeAttr('required');elem.find('tbody tr:not( .ipsMatrix_empty ):last-child').hide();};init();return{init:init};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.statusToggle',function(){var respond=function(elem,options,e){e.preventDefault();elem=$(elem);if(elem.attr('data-loading')){return;}
var currentBadge=elem.find('[data-state]:visible');var currentState=currentBadge.attr('data-state');var url=currentBadge.attr('href');if(currentBadge.attr('data-ipsdialog')){return;}
var nextState;if(options.intermediate){nextState=(currentState=='enabled')?'intermediate':(currentState=='disabled')?'enabled':'disabled';}else{nextState=(currentState=='enabled')?'disabled':'enabled';}
var nextBadge=elem.find('[data-state="'+nextState+'"]');if(!nextBadge.length){Debug.warn("No badge found for "+nextState+" state");return;}
elem.attr('data-loading',true);currentBadge.css({opacity:0.5});ips.getAjax()(url,{showLoading:true}).done(function(response){currentBadge.hide().css({opacity:1});nextBadge.show();elem.removeAttr('data-loading');elem.trigger('stateChanged',{status:nextState});}).fail(function(jqXHR,textStatus,errorThrown){if(Debug.isEnabled()){Debug.error(textStatus);Debug.error(jqXHR.responseText);}else{window.location=url;}});};ips.ui.registerWidget('statusToggle',ips.ui.statusToggle,['intermediate'],{lazyLoad:true,lazyEvent:'click'});return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.tree',function(){var defaults={openClass:'ipsTree_open',closedClass:'ipsTree_closed',searchable:false,sortable:true};var respond=function(elem,options){if(!$(elem).data('_tree')){$(elem).data('_tree',treeObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('tree',ips.ui.tree,['openClass','closedClass','searchable','results','url','sortable','lockParents','protectRoots']);return{respond:respond};});var treeObj=function(elem,options,e){var _timer=null;var _searchAjax=null;var _currentParentOver=null;var init=function(){if(!options.url){Debug.error("No URL provided for tree widget on "+elem.identify().attr('id'));}
elem.addClass('ipsTree_js');if(options.sortable){_makeSortable();}
elem.on('click','.ipsTree_parent:not( .ipsTree_noToggle )',_toggleRow);if(options.searchable&&$(options.searchable).length){$(options.searchable).on('keydown',_searchKeyPress).on('search',_doSearch);}},_searchKeyPress=function(e){clearTimeout(_timer);_timer=setTimeout(_doSearch,500);},_doSearch=function(){if(_searchAjax&&_searchAjax.abort){_searchAjax.abort();}
var value=$.trim($(options.searchable).val());var searchPane=elem.find('[data-role="treeResults"]');var listPane=elem.find('[data-role="treeListing"]');if(!_.isEmpty(value)){listPane.hide();searchPane.show();searchPane.html(ips.templates.render('core.trees.loadingPane'));_searchAjax=ips.getAjax()(options.url+'&do=search',{data:{input:value}}).done(function(response){if(_.isEmpty($.trim(response))){searchPane.html(ips.templates.render('core.trees.noRows'));}else{searchPane.html(response);$(document).trigger('contentChange',[searchPane]);}});}else{listPane.show();searchPane.hide().html('');}},_toggleRow=function(e){var target=$(e.target);var row=$(e.currentTarget);if(target.closest('.ipsTree_controls').length){return;}
if(row.hasClass(options.openClass)){_closeRow(row);}else{_openRow(row);}},_closeRow=function(row){row.removeClass(options.openClass).addClass(options.closedClass);var realRow=row.closest('[data-role="node"]');var rowID=realRow.find('[data-nodeid]').first().attr('data-nodeid');if(realRow.find('> ol').length){ips.utils.anim.go('fadeOut fast',realRow.find('> ol'));}},_openRow=function(row){row.removeClass(options.closedClass).addClass(options.openClass);var realRow=row.closest('[data-role="node"]');var rowID=realRow.find('[data-nodeid]').first().attr('data-nodeid');realRow.attr('data-nodeid',rowID);if(_.isUndefined(rowID)){Debug.warn('No rowID for row '+realRow.identify().attr('id'));return;}
if(realRow.data('_childrenLoaded')||realRow.data('_childrenLoading')){ips.utils.anim.go('fadeInDown fast',realRow.find('> ol'));return;}
var loading=ips.templates.render('core.trees.loadingRow');var content=ips.templates.render('core.trees.childWrapper',{content:loading});realRow.data('_childrenLoading',true).append(content);ips.getAjax()(options.url+'&root='+rowID).done(function(response){realRow.find('> ol').remove();realRow.find('> .ipsTree_row').after(response);realRow.data('_childrenLoaded',true).removeData('_childrenLoading');ips.utils.anim.go('fadeInDown',realRow.find('> ol'));$(document).trigger('contentChange',[realRow]);if(options.sortable){elem.find('.ipsTree_rows > .ipsTree').nestedSortable('refresh');elem.find('.ipsTree_rows > .ipsTree').nestedSortable('refreshPositions');}}).fail(function(){window.location=options.url+'&root='+rowID;});},_checkParentStatus=function(){Debug.log('check parent status');elem.find('.ipsTree_row:not( .ipsTree_root )').each(function(){var row=$(this);if(row.hasClass('ipsTree_parent')&&!row.hasClass('ipsTree_open')){return;}
var subList=row.siblings('ol');var currentlyParent=row.is('ipsTree_parent');var hasChildren=subList.find('> li').length>0;Debug.log('sublist: ');Debug.log(subList);row.toggleClass('ipsTree_parent',hasChildren);if(hasChildren&&!currentlyParent){row.addClass('ipsTree_open');}
if(row.hasClass('ipsTree_acceptsChildren')&&!subList.length){var newRow=$('<ol/>').addClass('ipsTree ipsTree_node');row.after(newRow);}});},_makeSortable=function(){var sortableOptions={placeholder:'sortable-placeholder',handle:'.ipsTree_dragHandle',items:'[data-role="node"]',excludeRoot:true,update:function(event,ui){var url=options.url+'&do=reorder';var rootID=elem.find('.ipsTree_root').attr('data-nodeid');var data='';setTimeout(function(){_checkParentStatus();},200);if(rootID){url+='&root='+rootID;}
if(rootID){var dataArray=$(this).nestedSortable('toArray',{key:'ajax_order'});var outputArray=[];for(var i=0;i<dataArray.length;i++){outputArray.push('ajax_order['+dataArray[i].item_id+']='+((dataArray[i].parent_id==null)?rootID:dataArray[i].parent_id));}
data=outputArray.join('&');}else{data=$(this).nestedSortable('serialize',{key:'ajax_order'});}
ips.getAjax()(url,{data:data}).fail(function(){window.location=url+"&"+data;});},toleranceElement:'> div',listType:'ol',isTree:true,isAllowed:function(placeholder,placeholderParent,currentItem){$('#ipsTooltip').hide();var parent=null;if(placeholderParent===null){parent=elem.find('> .ipsTree_root');}else{parent=placeholderParent.closest('[data-role="node"]').find('> .ipsTree_row');}
if(parent.hasClass('ipsTree_acceptsChildren')||!parent.length){placeholder.removeAttr('data-error');return true;}else{placeholder.attr('data-error',ips.getString('cannotDragInto'));return false;}},expand:function(event,ui){var row=$(this).find('.mjs-nestedSortable-hovering > .ipsTree_parent[data-nodeid]');if(!row.hasClass('ipsTree_open')){_openRow(row);}},change:function(event,ui){$(this).find('.ipsTree_draggingInto').removeClass('ipsTree_draggingInto');ui.placeholder.closest('[data-role="node"]').find('> .ipsTree_row').addClass('ipsTree_draggingInto');},start:function(event,ui){ui.placeholder.closest('[data-role="node"]').find('> .ipsTree_row').addClass('ipsTree_draggingInto');},stop:function(event,ui){$(this).find('.ipsTree_draggingInto').removeClass('ipsTree_draggingInto');}};if(options.lockParents){sortableOptions['disableParentChange']=true;}
if(options.protectRoots){sortableOptions['protectRoot']=true;}
elem.find('.ipsTree_rows > .ipsTree').nestedSortable(sortableOptions);};init();return{init:init};};}(jQuery,_));;