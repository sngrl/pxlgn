/**
 * IPS Social Suite 4
 * (c) 2013 Invision Power Services - http://www.invisionpower.com
 * This file contains minified javascript and is not directly editable
 */

/* GENERAL TEMPLATES */
ips.templates.set('core.general.loading', " \
	&nbsp;<span class='ipsType_light'><i class='icon-spinner2 ipsLoading_tinyIcon'></i>&nbsp;&nbsp;&nbsp;</span> {{text}}</span>\
");

ips.templates.set('core.general.ajax', " \
	<div id='elAjaxLoading'><i class='icon-spinner2 ipsLoading_tinyIcon'></i> &nbsp;&nbsp;{{#lang}}loading{{/lang}}...</div>\
");

ips.templates.set('core.general.flashMsg', " \
	<div id='elFlashMessage' data-role='flashMessage'></div>\
");

ips.templates.set('core.hovercard.loading', " \
	<i class='icon-spinner2 ipsLoading_tinyIcon'></i>\
");

/* POST CONTENT */
ips.templates.set('core.posts.spoiler', " \
	<span class='ipsStyle_spoilerFancy_text'><span class='ipsButton ipsButton_verySmall ipsButton_primary ipsButton_narrow'><i class='fa fa-chevron-right'></i></span> {{#lang}}spoilerClickToReveal{{/lang}}</span>\
");

ips.templates.set('core.posts.spoilerOpen', " \
	<span class='ipsStyle_spoilerFancy_text'><span class='ipsButton ipsButton_verySmall ipsButton_primary ipsButton_narrow'><i class='fa fa-chevron-down'></i></span> {{#lang}}spoilerClickToHide{{/lang}}</span>\
");

ips.templates.set('core.posts.multiQuoteOff', " \
	<i class='fa fa-plus'></i>\
");

ips.templates.set('core.posts.multiQuoteOn', " \
	<i class='fa fa-check'></i>\
");

ips.templates.set('core.posts.multiQuoter', " \
	<div id='ipsMultiQuoter'>\
		<button class='ipsButton ipsButton_light ipsButton_small' data-role='multiQuote'><i class='fa fa-comments'></i> &nbsp;&nbsp;{{{count}}}</button> &nbsp;&nbsp;<a href='#' data-action='clearQuoted'><i class='fa fa-times'></i></a>\
	</div>\
");

ips.templates.set('core.menus.menuItem', " \
	<li class='ipsMenu_item {{#checked}}ipsMenu_itemChecked{{/checked}}' data-ipsMenuValue='{{value}}'>\
		<a href='{{link}}'>{{title}}</a>\
	</li>\
");

ips.templates.set('core.menus.menuSep', " \
	<li class='ipsMenu_sep'><hr></li>\
");

ips.templates.set('core.posts.quotedSpoiler', " \
	<p><em>{{#lang}}quotedSpoiler{{/lang}}</em></p>\
");

/* NOTIFICATION TEMPLATE */
ips.templates.set('core.postNotify.single', " \
	<span data-role='newPostNotification' class='ipsType_medium'>\
		<img src='{{photo}}' alt='' class='ipsUserPhoto ipsUserPhoto_tiny ipsPos_middle'> &nbsp;&nbsp;&nbsp;{{text}}\
		&nbsp;&nbsp;&nbsp;<a href='#' data-action='loadNewPosts'>{{#lang}}showReply{{/lang}}</a>\
	</span>\
");

ips.templates.set('core.postNotify.multiple', " \
	<span data-role='newPostNotification' class='ipsType_medium'>\
		{{text}}\
		&nbsp;&nbsp;&nbsp;<a href='#' data-action='loadNewPosts'>{{#lang}}showReplies{{/lang}}</a>\
	</span>\
");

/* ALERTS */
ips.templates.set('core.alert.box', " \
<div class='ipsAlert' style='display: none' role='alertdialog' aria-describedby='{{id}}_message'>\
	{{{icon}}}\
	<div class='ipsAlert_msg' id='{{id}}_message'>\
		{{{text}}}\
		{{{subtext}}}\
	</div>\
	<ul class='ipsToolList ipsToolList_horizontal ipsType_right ipsAlert_buttonRow ipsClear ipsClearfix'>\
		{{{buttons}}}\
	</ul>\
</div>\
");

ips.templates.set('core.alert.subText', " \
<div class='ipsType_light ipsType_normal'>{{text}}</div>\
");

ips.templates.set('core.alert.icon', " \
<i class='{{icon}} ipsAlert_icon'></i>\
");

ips.templates.set('core.alert.button', " \
<li><button data-action='{{action}}' class='ipsButton ipsButton_fullWidth {{extra}}' role='button'>{{title}}</button></li>\
");

ips.templates.set('core.alert.prompt', " \
<br><br>\
<input type='text' value='{{value}}' class='ipsField_fullWidth' data-role='promptValue'>\
<br><br>\
");

/* LIGHTBOX TEMPLATES */
ips.templates.set('core.lightbox.meta', "{{title}}");

/* DIALOG TEMPLATES */
ips.templates.set('core.dialog.main', " \
<div class='{{class}} {{#fixed}}{{class}}_fixed{{/fixed}} {{#size}}{{class}}_{{size}}{{/size}}' style='display: none' id='{{id}}' role='dialog' aria-label='{{title}}'>\
	<div>\
		{{#title}}\
			<h3 class='{{class}}_title'>{{title}}</h3>\
			<hr class='ipsHr'>\
		{{/title}}\
		{{#close}}\
			<a href='#' class='{{class}}_close' data-action='dialogClose'>&times;</a>\
		{{/close}}\
		<div class='{{class}}_content'>\
			{{content}}\
		</div>\
		<div class='{{class}}_loading {{class}}_large ipsLoading' style='display: none'></div>\
	</div>\
</div>\
")

/* TOOLTIP TEMPLATE */
ips.templates.set('core.tooltip', " \
	<div id='{{id}}' class='ipsTooltip ipsType_noBreak' role='tooltip'>{{content}}</div>\
");

/* SEARCH TEMPLATES */
ips.templates.set('core.search.loadingPanel', " \
	<div id='{{id}}' class='ipsLoading' style='min-height: 100px'>\
		&nbsp;\
	</div>\
");

/* EDITOR TEMPLATES */
ips.templates.set('core.editor.panelWrapper', " \
	<div id='{{id}}' class='ipsRTE_panel ipsPad'>\
		{{content}}\
	</div>\
");

ips.templates.set('core.editor.emoticons', " \
<div class='ipsMenu ipsMenu_wide' id='{{id}}_menu' style='display: none' data-editorID='{{editor}}' data-controller='core.global.editor.emoticons'>\
	<div class='ipsMenu_headerBar'>\
		<p class='ipsType_reset ipsPos_right'><a href='#' class='ipsType_blendLinks' data-role='categoryTrigger' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_more'>{{#lang}}emoticonCategories{{/lang}} <i class='fa fa-caret-down'></i></a></p>\
		<h4 class='ipsType_sectionHead'>{{#lang}}emoticons{{/lang}}</h4>\
		<ul data-role='categoryMenu' class='ipsMenu ipsMenu_auto' id='{{id}}_more_menu' role='menu' style='display: none'>\
			<li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='overview'><a href='#'>{{#lang}}emoticonOverview{{/lang}}</a></li>\
			<li class='ipsMenu_sep'><hr></li>\
		</ul>\
	</div>\
	<div class='ipsMenu_innerContent ipsEmoticons_content'>\
\
	</div>\
	<div class='ipsMenu_footerBar'>\
		<input type='text' data-role='emoticonSearch' class='ipsField_fullWidth' placeholder='{{#lang}}emoticonFind{{/lang}}'>\
	</div>\
</div>\
");		

ips.templates.set('core.editor.emoticonSection', " \
	<div data-panel='{{id}}'>{{{content}}}</div>\
");

ips.templates.set('core.editor.emoticonMenu', " \
	<li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='{{categoryID}}'><a href='#'><span class='ipsMenu_itemCount'>{{count}}</span>{{title}}</a></li>\
");

ips.templates.set('core.editor.emoticonCategory', " \
	<div class='ipsAreaBackground_light ipsPad_half'><strong>{{title}}</strong></div>\
	<div class='ipsEmoticons_category' data-categoryid='{{categoryID}}'>{{{emoticons}}}</div>\
");

ips.templates.set('core.editor.emoticonRow', " \
	<div class='ipsEmoticons_row'>{{{emoticons}}}</div>\
");

ips.templates.set('core.editor.emoticonItem', " \
	<div class='ipsEmoticons_item' data-emoticon='{{tag}}' data-src='{{src}}' title='{{tag}}'>{{{img}}}</div>\
");

ips.templates.set('core.editor.emoticonBlank', " \
	<div class='ipsEmoticons_item'>&nbsp;</div>\
");

ips.templates.set('core.editor.emoticonNoResults', " \
	<div class='ipsPad ipsType_center ipsType_light'>{{#lang}}no_results{{/lang}}</div>\
");

ips.templates.set('core.editor.citation', " \
	<div class='ipsQuote_citation ipsQuote_open'>\
		<a href='#' data-action='toggleQuote'>&nbsp;</a>\
		{{#contenturl}}\
			<a class='ipsPos_right' href='{{contenturl}}'><i class='fa fa-share'></i></a>\
		{{/contenturl}}\
		{{#timestamp}}\
			{{timestamp}},\
		{{/timestamp}}\
		{{#username}}\
			{{#userid}}\
				<a href='{{baseURL}}?app=core&module=members&controller=profile&id={{userid}}' data-ipsHover data-ipshover-target='{{baseURL}}?app=core&module=members&controller=profile&id={{userid}}&do=hovercard'>{{username}}</a> {{#lang}}editorSaid{{/lang}}\
			{{/userid}}\
			{{^userid}}\
				{{username}} {{#lang}}editorSaid{{/lang}}\
			{{/userid}}\
		{{/username}}\
		{{^username}}\
			{{#lang}}editorQuote{{/lang}}\
		{{/username}}\
	</div>\
");

/* ATTACHMENT TEMPLATES */
ips.templates.set('core.attachments.fileItemWrapper', " \
	<ul class='ipsDataList'>{{{content}}}</ul>\
");

ips.templates.set('core.attachments.fileItem', " \
	<li class='ipsDataItem ipsAttach ipsContained {{#done}}ipsAttach_done{{/done}}' id='{{id}}' data-role='file' data-fileid='{{id}}'>\
		<div class='ipsDataItem_generic ipsDataItem_size2 ipsResponsive_hidePhone ipsResponsive_block ipsType_center' data-role='preview' data-action='insertFile' {{#thumb}}style='background-image: url( {{thumbnail}} )'{{/thumb}}>\
			{{#thumb}}\
				{{{thumb}}}\
			{{/thumb}}\
			<i class='fa fa-file ipsType_large' {{#thumb}}style='display: none'{{/thumb}}></i>\
		</div>\
		<div class='ipsDataItem_main' data-action='insertFile'>\
			<h2 class='ipsDataItem_title ipsType_medium ipsType_reset ipsAttach_title' data-role='title'>{{title}}</h2>\
			<p class='ipsDataItem_meta ipsType_light'>\
				{{size}}\
			</p>\
		</div>\
		<div class='ipsDataItem_generic ipsDataItem_size5'>\
			{{#status}}<span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>{{/status}}\
			{{#statusText}}<span class='ipsType_light' data-role='status'>{{statusText}}</span>{{/statusText}}\
		</div>\
		<div class='ipsDataItem_generic ipsDataItem_size8 ipsType_right'>\
			<ul class='ipsList_inline'>\
				<li data-role='insert' {{#insertable}}style='display: none'{{/insertable}}>\
					<a href='#' data-action='insertFile' class='ipsAttach_selection' data-ipsTooltip title='{{#lang}}insertIntoPost{{/lang}}'>\
						<i class='fa fa-plus'></i>\
					</a>\
				</li>\
				<li data-role='deleteFileWrapper' {{#newUpload}}style='display: none'{{/newUpload}}>\
					<input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>\
					<a href='#' data-role='deleteFile' class='ipsType_warning' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'>\
						<i class='fa fa-trash-o'></i> {{#lang}}delete{{/lang}}\
					</a>\
				</li>\
			</ul>\
		</div>\
	</li>\
");

ips.templates.set('core.attachments.imageItem', " \
	<div class='ipsGrid_span3 ipsAttach ipsImageAttach ipsPad_half ipsAreaBackground_light {{#done}}ipsAttach_done{{/done}}' id='{{id}}' data-role='file' data-fileid='{{id}}' data-fullsizeurl='{{imagesrc}}' data-thumbnailurl='{{thumbnail}}' data-isImage='1'>\
		<ul class='ipsList_inline ipsImageAttach_controls'>\
			<li data-role='insert' {{#insertable}}style='display: none'{{/insertable}}><a href='#' data-action='insertFile' class='ipsAttach_selection' data-ipsTooltip title='{{#lang}}insertIntoPost{{/lang}}'><i class='fa fa-plus'></i></a></li>\
			</li>\
			<li class='ipsPos_right' {{#newUpload}}style='display: none'{{/newUpload}} data-role='deleteFileWrapper'>\
				<input type='hidden' name='{{field_name}}_keep[{{id}}]' value='1'>\
				<a href='#' data-role='deleteFile' class='ipsButton ipsButton_verySmall ipsButton_light' data-ipsTooltip title='{{#lang}}attachRemove{{/lang}}'><i class='fa fa-trash-o'></i></a>\
			</li>\
		</ul>\
		<div class='ipsImageAttach_thumb ipsType_center' data-role='preview' data-grid-ratio='65' data-action='insertFile' {{#thumb}}style='background-image: url( {{thumbnail}} )'{{/thumb}}>\
			{{#status}}\
				<span class='ipsImageAttach_status ipsType_light' data-role='status'>{{{status}}}</span>\
				<span class='ipsAttachment_progress'><span data-role='progressbar'></span></span>\
			{{/status}}\
			{{#thumb}}\
				{{{thumb}}}\
			{{/thumb}}\
		</div>\
		<h2 class='ipsType_reset ipsAttach_title ipsType_medium' data-role='title'>{{title}}</h2>\
		<p class='ipsType_light'>{{size}} {{#statusText}}&middot; <span data-role='status'>{{statusText}}</span>{{/statusText}}</p>\
	</div>\
");

ips.templates.set('core.attachments.imageItemWrapper', " \
	<div class='ipsGrid ipsGrid_collapsePhone' data-ipsGrid data-ipsGrid-minItemSize='150' data-ipsGrid-maxItemSize='250'>{{{content}}}</div>\
");

/* FORM TEMPLATES */
ips.templates.set('core.autocomplete.field', " \
	<div class='ipsField_autocomplete' id='{{id}}_wrapper' role='combobox' aria-autocomplete='list' aria-owns='{{id}}_results'>\
		<span class='ipsField_autocomplete_loading' style='display: none' id='{{id}}_loading'></span>\
		<ul class='ipsList_inline'><li id='{{id}}_inputItem'>{{content}}</li></ul>\
	</div>\
");

ips.templates.set('core.autocomplete.addToken', " \
	<a href='#' data-action='addToken'><i class='fa fa-plus'></i> {{text}}</a> \
");

ips.templates.set('core.autocomplete.resultWrapper', " \
	<ul class='ipsAutocompleteMenu ipsList_reset' id='{{id}}_results' aria-expanded='false' style='display: none'>\
	</ul>\
");

ips.templates.set('core.autocomplete.resultItem', " \
	<li class='ipsAutocompleteMenu_item' data-value='{{{value}}}' role='option' role='listitem'>\
		<div class='ipsClearfix'>\
			{{html}}\
		</div>\
	</li>\
");

ips.templates.set('core.autocomplete.token', " \
	<li class='cToken' data-value='{{value}}'>\
		{{title}} <span class='cToken_close' data-action='delete'>&times;</span>\
	</li>\
");

ips.templates.set('core.autocomplete.memberItem', " \
	<li class='ipsAutocompleteMenu_item ipsClearfix' data-value=\"{{value}}\" role='option' role='listitem'>\
		<div class='ipsPhotoPanel ipsPhotoPanel_tiny'>\
			<span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{{photo}}}'></span>\
			<div>\
				<strong>{{{name}}}</strong><br>\
				<span class='ipsType_light'>{{{extra}}}</span>\
			</div>\
		</div>\
	</li>\
");

ips.templates.set('core.forms.toggle', " \
	<span class='ipsToggle {{className}}' id='{{id}}' tabindex='0'>\
		<span data-role='status'>{{status}}</span>\
	</span>\
");

ips.templates.set('core.forms.validationWrapper', " \
	<ul id='{{id}}' class='ipsList_reset ipsType_small ipsForm_errorList'>{{content}}</ul>\
");

ips.templates.set('core.forms.validationItem', " \
	<li class='ipsType_warning'>{{message}}</li>\
");

/* TRUNCATE TEMPLATE */
ips.templates.set('core.truncate.expand', " \
	<a class='ipsTruncate_more ipsType_blendLinks' data-action='expandTruncate'><span>{{text}} &nbsp;<i class='fa fa-caret-down'></i></span></a>\
");

/* NODE SELECT */
ips.templates.set('core.selectTree.token', " \
<li><span class='ipsSelectTree_token cToken' data-nodeID='{{id}}'>{{title}}</span></li>\
");

/* ACCESSIBILITY KEYBOARD NAV TEMPLATES */
ips.templates.set('core.accessibility.border', " \
<div id='ipsAccessibility_border'></div>\
");

ips.templates.set('core.accessibility.arrow', " \
<div id='ipsAccessibility_arrow'></div>\
");

/* INFINITE SCROLL */
ips.templates.set('core.infScroll.loading', " \
	<li class='ipsPad ipsType_center' data-role='infScroll_loading'>\
		{{#lang}}loading{{/lang}}...\
	</li>\
");

ips.templates.set('core.infScroll.pageBreak', " \
	<li class='ipsPad_half ipsAreaBackground' data-role='infScroll_break'>\
		{{#lang}}page{{/lang}} {{page}}\
	</li>\
");

ips.templates.set('core.pageAction.actionMenuItem', " \
	<li data-role='actionMenu' data-action='{{action}}' id='{{id}}_{{action}}' data-ipsMenu data-ipsMenu-above='true' data-ipsMenu-appendTo='#{{id}}_bar' data-ipsMenu-activeClass='ipsPageAction_active' data-ipsTooltip title='{{title}}' class='ipsHide'>\
		{{#icon}}\
			<i class='fa fa-{{icon}} ipsPageAction_icon'></i> <i class='fa fa-caret-up'></i>\
		{{/icon}}\
		{{^icon}}\
			<span class='ipsPageAction_text'>{{title}} <i class='fa fa-caret-up'></i></span>\
		{{/icon}}\
		<ul id='{{id}}_{{action}}_menu' class='ipsMenu ipsMenu_auto' style='display: none'>\
			{{{menucontent}}}\
		</ul>\
	</li>\
");

ips.templates.set('core.pageAction.actionItem', " \
	<li data-role='actionButton' data-action='{{action}}' id='{{id}}_{{action}}' data-ipsTooltip title='{{title}}'>\
		{{#icon}}\
			<i class='fa fa-{{icon}} ipsPageAction_icon' data-ipsTooltip='{{title}}'></i></i>\
		{{/icon}}\
		{{^icon}}\
			<span class='ipsPageAction_text'>{{title}}</span>\
		{{/icon}}\
	</li>\
");

/* PAGE ACTIONS */
ips.templates.set('core.pageAction.wrapper', " \
	<div class='ipsPageAction' data-role='actionBar' id='{{id}}_bar'>\
		<ul class='ipsList_inline ipsList_reset' data-role='actionItems'>\
			<li>{{{selectedLang}}}</li>\
			{{{content}}}\
		</ul>\
	</div>\
");

/* CAROUSEL */
ips.templates.set('core.carousel.bulletWrapper', "\
	<ul class='ipsCarousel_bullets'>{{content}}</ul>\
");

ips.templates.set('core.carousel.bulletItem', "\
	<li><i class='fa fa-circle'></i></li>\
");

/* RATINGS */
ips.templates.set('core.rating.wrapper', "\
	<ul class='ipsList_inline ipsClearfix ipsRating'>\
		{{{content}}}\
	</ul>\
	<span data-role='ratingStatus' class='ipsType_light ipsType_medium'></span>\
")

ips.templates.set('core.rating.star', "\
	<li class='{{className}}' data-ratingValue='{{value}}'><a href='#'><i class='fa fa-star'></i></a></li>\
");

ips.templates.set('core.rating.loading', "\
	<i class='icon-spinner2 ipsLoading_tinyIcon'></span>\
");

/* SIDEBAR MANAGER */
ips.templates.set('core.sidebar.managerWrapper', " \
	<div id='elSidebarManager' data-role='manager' class='ipsToolbox ipsScrollbar ipsHide'>\
		<div class='ipsPad'>\
			<h3 class='ipsToolbox_title ipsType_reset'>{{#lang}}sidebarManager{{/lang}}</h3>\
			<p class='ipsType_light'>{{#lang}}sidebarManagerDesc{{/lang}}</p>\
			<p class='ipsType_light'>{{#lang}}sidebarManagerDesc2{{/lang}}</p>\
			<div data-role='availableBlocks' class='ipsLoading ipsLoading_dark'></div>\
		</div>\
		<div id='elSidebarManager_submit' class='ipsPad'>\
			<button class='ipsButton ipsButton_important ipsButton_medium ipsButton_fullWidth' data-action='closeSidebar'>{{#lang}}finishEditing{{/lang}}</button>\
		</div>\
	</div>\
");

ips.templates.set('core.sidebar.blockManage', " \
	<div class='cSidebarBlock_managing ipsType_center'>\
		<h4>{{title}}</h4>\
		<a href='#' data-action='removeBlock' data-ipsTooltip title='{{#lang}}removeBlock{{/lang}}'><i class='fa fa-times'></i></a>\
		<button	data-ipsMenu data-ipsMenu-closeOnClick='false' id='{{id}}_edit' data-action='manageBlock' class='ipsButton ipsButton_primary'>\
			<i class='fa fa-pencil'></i> &nbsp;{{#lang}}editBlock{{/lang}}\
		</button>\
		<div class='ipsMenu ipsMenu_wide ipsHide' id='{{id}}_edit_menu'>\
		</div>\
	</div>\
");

ips.templates.set('core.sidebar.blockManageNoConfig', " \
	<div class='cSidebarBlock_managing ipsType_center'>\
		<h4>{{title}}</h4>\
		<a href='#' data-action='removeBlock' data-ipsTooltip title='{{#lang}}removeBlock{{/lang}}'><i class='fa fa-times'></i></a>\
	</div>\
");

ips.templates.set('core.sidebar.blockIsEmpty', " \
	<div class='ipsWidgetBlank ipsPad'>\
		{{text}}\
	</div>\
");

/* FOLLOW BUTTON LOADING */
ips.templates.set('core.follow.loading', " \
<div class='ipsLoading ipsLoading_tiny'></div>\
");

/* STATUS TEMPLATES */
ips.templates.set('core.statuses.loadingComments', " \
	<i class='icon-spinner2 ipsLoading_tinyIcon'></i> &nbsp;<span class='ipsType_light'> &nbsp;Loading comments...</span>\
");


/* STACKS */
ips.templates.set('core.forms.stack', " \
	<li class='ipsField_stackItem' data-role='stackItem'>\
		<span class='ipsField_stackDrag ipsDrag' data-action='stackDrag'>\
			<i class='fa fa-bars ipsDrag_dragHandle'></i>\
		</span>\
		<a href='#' class='ipsField_stackDelete ipsCursor_pointer' data-action='stackDelete'>\
			<i class='fa fa-times'></i>\
		</a>\
		{{{field}}}\
	</li>\
");

/* POLLS */
ips.templates.set('core.pollEditor.question', " \
	<div class='ipsAreaBackground_light ipsBox ipsBox_transparent' data-role='question' data-questionID='{{questionID}}'>\
		<div class='ipsAreaBackground ipsPad'>\
			<input type='text' data-role='questionTitle' name='{{pollName}}[questions][{{questionID}}][title]' placeholder='{{#lang}}questionPlaceholder{{/lang}}' class='ipsField_fullWidth' value='{{question}}'>\
		</div>\
		<div class='ipsPad'>\
			<ul class='ipsDataList cPollChoices' data-role='choices'>\
				<li class='ipsDataItem ipsResponsive_hidePhone'>\
					<p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>\
					<p class='ipsDataItem_main'><strong>{{#lang}}choicesTitle{{/lang}}</strong></p>\
					{{#showCounts}}\
						<p class='ipsDataItem_generic ipsDataItem_size4'><strong>{{#lang}}votesTitle{{/lang}}</strong></p>\
					{{/showCounts}}\
					<p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>\
				</li>\
				{{{choices}}}\
			</ul>\
			<br>\
			<div class='ipsDataList'>\
				<p class='ipsDataItem_generic ipsDataItem_size1'>&nbsp;</p>\
				<ul class='ipsDataItem_main ipsList_inline'>\
					{{#removeQuestion}}<li class='ipsPos_right'><a href='#' data-action='removeQuestion' class='ipsButton ipsButton_verySmall ipsButton_light'>{{#lang}}removeQuestion{{/lang}}</a></li>{{/removeQuestion}}\
					<li><a href='#' data-action='addChoice' class='ipsButton ipsButton_verySmall ipsButton_normal'>{{#lang}}addChoice{{/lang}}</a></li>\
					<li><input type='checkbox' id='elPoll_{{pollName}}_{{questionID}}multi' name='{{pollName}}[questions][{{questionID}}][multichoice]' {{#multiChoice}}checked{{/multiChoice}}> <label for='elPoll_{{pollName}}_{{questionID}}multi'>{{#lang}}multipleChoiceQuestion{{/lang}}</label></li>\
				</ul>\
			</div>\
		</div>\
	</div>\
");

ips.templates.set('core.pollEditor.choice', " \
	<li class='ipsDataItem' data-choiceID='{{choiceID}}'>\
		<div class='ipsDataItem_generic ipsDataItem_size1 cPollChoiceNumber ipsType_right ipsType_normal'>\
			<strong data-role='choiceNumber'>{{choiceID}}</strong>\
		</div>\
		<div class='ipsDataItem_main'>\
			<input type='text' name='{{pollName}}[questions][{{questionID}}][answers][{{choiceID}}][value]' value='{{choiceTitle}}' class='ipsField_fullWidth'>\
		</div>\
		{{#showCounts}}\
			<div class='ipsDataItem_generic ipsDataItem_size4' data-voteText='{{#lang}}votesTitle{{/lang}}'>\
				<input type='number' name='{{pollName}}[questions][{{questionID}}][answers][{{choiceID}}][count]' value='{{count}}' min='0'>\
			</div>\
		{{/showCounts}}\
		<div class='ipsDataItem_generic ipsDataItem_size1'>\
			<a href='#' data-action='removeChoice' class='ipsButton ipsButton_verySmall ipsButton_light ipsButton_narrow'><i class='fa fa-times'></i></a>\
		</div>\
	</li>\
");

/* COVER PHOTOS */
ips.templates.set('core.coverPhoto.controls', " \
	<ul class='ipsList_inline' data-role='coverPhotoControls'>\
		<li><a href='#' class='ipsButton ipsButton_positive ipsButton_verySmall' data-action='savePosition'><i class='fa fa-check'></i> {{#lang}}save_position{{/lang}}</a></li>\
		<li><a href='#' class='ipsButton ipsButton_negative ipsButton_verySmall' data-action='cancelPosition'><i class='fa fa-times'></i> {{#lang}}cancel{{/lang}}</a></li>\
	</ul>\
");

/* PATCHWORK */
ips.templates.set('core.patchwork.imageList', " \
	{{#showThumb}}\
		<li class='cGalleryPatchwork_item' style='width: {{dims.width}}px; height: {{dims.height}}px; margin: {{dims.margin}}px {{dims.marginRight}}px {{dims.margin}}px {{dims.marginLeft}}px'>\
	{{/showThumb}}\
	{{^showThumb}}\
		<li class='cGalleryPatchwork_item ipsNoThumb ipsNoThumb_video' style='width: {{dims.width}}px; height: {{dims.height}}px; margin: {{dims.margin}}px {{dims.marginRight}}px {{dims.margin}}px {{dims.marginLeft}}px'>\
	{{/showThumb}}\
		<a href='{{image.url}}'>\
			{{#showThumb}}<img src='{{image.src}}' alt='{{image.title}}' class='cGalleryPatchwork_image'>{{/showThumb}}\
			<div class='ipsPhotoPanel ipsPhotoPanel_mini'>\
				<img src='{{image.author.photo}}' class='ipsUserPhoto ipsUserPhoto_mini'>\
				<div>\
					<span class='ipsType_normal ipsTruncate ipsTruncate_line'>{{image.caption}}</span>\
					<span class='ipsType_small ipsTruncate ipsTruncate_line'>{{#lang}}by{{/lang}} {{image.author.name}}</span>\
				</div>\
			</div>\
			<ul class='ipsList_inline cGalleryPatchwork_stats'>\
				{{#image.unread}}\
					<li class='ipsPos_left'>\
						<span class='ipsItemStatus ipsItemStatus_small' data-ipsTooltip title='{{image.unread}}'><i class='fa fa-circle'></i></span>\
					</li>\
				{{/image.unread}}\
				{{#image.hasState}}\
					<li class='ipsPos_left'>\
						{{#image.state.hidden}}\
							<span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning' data-ipsTooltip title='{{#lang}}hidden{{/lang}}'><i class='fa fa-eye-slash'></i></span>\
						{{/image.state.hidden}}\
						{{#image.state.pending}}\
							<span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_warning' data-ipsTooltip title='{{#lang}}pending{{/lang}}'><i class='fa fa-warning'></i></span>\
						{{/image.state.pending}}\
						{{#image.state.pinned}}\
							<span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive' data-ipsTooltip title='{{#lang}}pinned{{/lang}}'><i class='fa fa-thumb-tack'></i></span>\
						{{/image.state.pinned}}\
						{{#image.state.featured}}\
							<span class='ipsBadge ipsBadge_icon ipsBadge_small ipsBadge_positive' data-ipsTooltip title='{{#lang}}featured{{/lang}}'><i class='fa fa-star'></i></span>\
						{{/image.state.featured}}\
					</li>\
				{{/image.hasState}}\
				{{#image.allowComments}}\
					<li class='ipsPos_right' data-commentCount='{{image.comments}}'><i class='fa fa-comment'></i> {{image.comments}}</li>\
				{{/image.allowComments}}\
			</ul>\
		</a>\
		{{#image.modActions}}\
			<input type='checkbox' data-role='moderation' name='moderate[{{image.id}}]' data-actions='{{image.modActions}}' data-state='{{image.modStates}}'>\
		{{/image.modActions}}\
	</li>\
");

/* Editor preference */
ips.templates.set('core.editor.preferences', " \
	<div id='editorPreferencesPanel' class='ipsPad'>\
		<div class='ipsMessage ipsMessage_info'> \
			{{#lang}}papt_warning{{/lang}} \
		</div> \
		<br> \
		<ul class='ipsForm ipsForm_vertical'> \
			<li class='ipsFieldRow ipsClearfix'> \
				<div class='ipsFieldRow_content'> \
					<input type='checkbox' {{#checked}}checked{{/checked}} name='papt' id='papt'> \
					<label for='papt'>{{#lang}}papt_label{{/lang}}</label> \
				</div> \
			</li> \
		</ul> \
		<div class='ipsPad_top ipsType_center'> \
			<button role='button' class='ipsButton ipsButton_medium ipsButton_primary' id='papt_submit'>{{#lang}}save_preference{{/lang}}</button> \
		</div> \
	</div> \
");

/* Pagination */
ips.templates.set('core.pagination', " \
	<ul class='ipsPagination' data-ipsPagination data-ipsPagination-pages='{{pages}}'>\
		<li class='ipsPagination_prev'>\
			<a href='#' data-page='prev'><i class='fa fa-caret-left'></i> Previous Page</a>\
		</li>\
		<li class='ipsPagination_next'>\
			<a href='#' data-page='next'>Next Page <i class='fa fa-caret-right'></i></a>\
		</li>\
	</ul>\
");;
;(function($,_,undefined){"use strict";ips.createModule('ips.controller',function(){var _controllers={},_autoMixins={},_manualMixins={},_mixins={},_beingLoaded=[],_queue={},instanceID=1;var register=function(id,definition){_controllers[id]=definition;_checkQueue(id);},isRegistered=function(id){return!_.isUndefined(_controllers[id]);},init=function(){$(document).on('contentChange',function(e,newNode){initializeControllers(newNode);});initializeControllers();},mixin=function(mixinName,controller,auto,mixinFunc){if(_.isFunction(auto)){mixinFunc=auto;auto=false;}
var obj=(auto)?_autoMixins:_manualMixins;if(_.isUndefined(obj[controller])){obj[controller]={};}
obj[controller][mixinName]=mixinFunc;},initializeControllers=function(node){var controllers=_findControllers(node);var needsLoading={};for(var controller in controllers){if(isRegistered(controller)){for(var i=0;i<controllers[controller].length;i++){var elem=controllers[controller][i]['elem'];var mixins=controllers[controller][i]['mixins'];initControllerOnElem(elem,controller,mixins);}}else{needsLoading[controller]=controllers[controller];}}
if(_.size(needsLoading)){_loadControllers(needsLoading).done(function(){});}},_checkQueue=function(id){if(_queue[id]&&_queue[id].length){for(var i=0;i<_queue[id].length;i++){initControllerOnElem(_queue[id][i]['elem'],id,_queue[id][i]['mixins']);}
delete _queue[id];}
if(_.indexOf(_beingLoaded,id)){delete _beingLoaded[_.indexOf(_beingLoaded,id)];}},_loadControllers=function(needsLoading){var filePaths=[];var deferred=$.Deferred();for(var controller in needsLoading){if(_.indexOf(_beingLoaded,controller)!==-1){delete needsLoading[controller];continue;}
_beingLoaded.push(controller);filePaths.push(_buildFilePath(controller));}
if(!_.size(needsLoading)){deferred.resolve();return deferred.promise();}
_.extend(_queue,needsLoading);ips.loader.get(filePaths).then(function(){deferred.resolve();});return deferred.promise();},_buildFilePath=function(controllerName){var bits=controllerName.split('.');if(ips.getSetting('useCompiledFiles')===false){return bits[0]+'/'+bits[1]+'/controllers/'+bits[2]+'/ips.'+bits[2]+'.'+bits[3]+'.js';}else{try{return ipsJavascriptMap[bits[0]][bits[1]+'_'+bits[2]];}catch(err){return'';}}},_findControllers=function(node){if(!_.isElement(node)){node=document;}
var controllersToLoad={};$(node).find('[data-controller]').each(function(idx,elem){if(!$(elem).data('_controllers')){$(elem).data('_controllers',[]);}
var controllerString=$(elem).data('controller'),controllerList=$(elem).data('_controllers');if(controllerString)
{_getControllersAndMixins(controllerString);var controllers=_getControllersAndMixins(controllerString);if(_.size(controllers)){_.each(controllers,function(val,key){if(controllerList.length&&_.indexOf(controllerList,key)!==-1){return;}
if(controllersToLoad[key]){controllersToLoad[key].push({elem:elem,mixins:val});}else{controllersToLoad[key]=[{elem:elem,mixins:val}];}});}}});return controllersToLoad;},_getControllersAndMixins=function(controllerString){var controllers={};var pieces=controllerString.split(',');for(var i=0;i<pieces.length;i++){pieces[i]=$.trim(pieces[i]);if(pieces[i].indexOf('(')===-1){controllers[pieces[i]]=[];continue;}
var p=pieces[i].match(/([a-zA-Z0-9.]+)\((.+?)\)/i);var mixinPieces=[];_.each(p[2].split(';'),function(val){mixinPieces.push($.trim(val));});controllers[p[1]]=mixinPieces;}
return controllers;},getInstanceID=function(){return'ipscontroller'+(++instanceID);},initControllerOnElem=function(elem,controllerID,mixins){if(!_controllers[controllerID]){Debug.error("Controller '"+controllerID+"' has not been registered");return;}
if(_.isUndefined($(elem).data('_controllers'))){$(elem).data('_controllers',[]);}
$(elem).data('_controllers').push(controllerID);var Base=getBaseController();$.extend(true,Base.prototype,_controllers[controllerID]);if(_.isUndefined($(elem).data('_controllerObjs'))){$(elem).data('_controllerObjs',[]);}
var controllers=$(elem).data('_controllerObjs');var obj=new Base(elem,controllerID);controllers.push(obj);if(!_.isUndefined(_autoMixins[controllerID])&&_.size(_autoMixins[controllerID])){_.each(_autoMixins[controllerID],function(val,key){_autoMixins[controllerID][key].call(obj);});}
if(mixins.length){for(var i=0;i<mixins.length;i++){if(!_.isUndefined(_manualMixins[controllerID])&&!_.isUndefined(_manualMixins[controllerID][mixins[i]])){_manualMixins[controllerID][mixins[i]].call(obj);}}}
if(_.isFunction(obj.initialize)){obj.initialize.call(obj);}
$(elem).removeData('_controller'+controllerID);},_findSubControllers=function(controller,node){var results=[];node=(node&&(_.isElement(node)||node.jquery))?node:document;if(controller.indexOf('*')===-1){results=$(node).find('[data-controller*="'+controller+'"]');}else{var pieces=controller.split('.');if(pieces[0]=='*'){pieces.shift();results=$(node).find('[data-controller$="'+pieces.join('.')+'"]');}else if(pieces[pieces.length-1]=='*'){pieces.pop();results=$(node).find('[data-controller^="'+pieces.join('.')+'"]');}}
return results;},getBaseController=function(){var baseController=function(scope,type){this.controllerType=type;this.controllerID=getInstanceID();this.scope=$(scope);this._eventListeners=[];var self=this;var adviceFuncs={before:function(baseFn,newFn){return function(){newFn.apply(this,arguments);return baseFn.apply(this,arguments);};},after:function(baseFn,newFn){return function(){var toReturn=baseFn.apply(this,arguments);newFn.apply(this,arguments);return toReturn;}},around:function(baseFn,newFn){return function(){var args=ips.utils.argsToArray(arguments);args.unshift(baseFn.bind(this));return newFn.apply(this,args);}}}
_.each(['before','after','around'],_.bind(function(type){this[type]=function(base,fn){if(_.isUndefined(this[base])||!_.isFunction(this[base])){Debug.log("Method '"+base+'" is not present in controller '+this.controllerID);return;}
this[base]=adviceFuncs[type](this[base],fn);};},this));this.on('destroy',function(e){e.stopPropagation();if(self._eventListeners.length){for(var i=0;i<self._eventListeners.length;i++){var data=self._eventListeners[i];if(data['delegate']){data['elem'].off(data['ev'],data['delegate'],data['fn']);}else{data['elem'].off(data['ev'],data['fn']);}}}
if(_.isFunction(self.destroy)){self.destroy.call(self);}
self.scope=null;});Debug.info("Initialized "+this.controllerID+" of type "+this.controllerType);};baseController.method('cleanContents',function(){Debug.log('Cleaning contents of controller');this.scope.find('[data-controller]').each(function(){var loopController=$(this);var controllers=loopController.data('_controllerObjs')||[];if(controllers.length){loopController.trigger('destroy');for(var i=0;i<controllers.length;i++){delete controllers[i];}}});ips.ui.destructAllWidgets(this.scope);});baseController.method('trigger',function(elem,ev,data){var args=ips.utils.argsToArray(arguments);elem=(!_.isElement(elem)&&!elem.jquery)?this.scope:$(args.shift());ev=args[0];data=args[1]||{};if(!data.stack){data.stack=[];}
data.stack.push('controllers.'+this.controllerType+'.'+this.controllerID);elem.trigger(ev,data);});baseController.method('on',function(elem,ev,delegate,fn){var args=ips.utils.argsToArray(arguments);elem=(!_.isElement(elem)&&elem!=document&&elem!=window)?this.scope:$(args.shift());ev=args[0];fn=(args.length==3)?args[2]:args[1];delegate=(args.length==3)?args[1]:undefined;if(!_.isFunction(fn)){Debug.warn("Callback function for "+ev+" doesn't exist in "+this.controllerType
+" ("+this.controllerID+")");return;}
fn=_.bind(fn,this);if(delegate){elem.on(ev,delegate,fn);this._eventListeners.push({elem:elem,event:ev,delegate:delegate,fn:fn});}else{elem.on(ev,fn);this._eventListeners.push({elem:elem,event:ev,fn:fn});}});baseController.method('triggerOn',function(controller,ev,data){var toTrigger=_findSubControllers(controller,this.scope);if(!toTrigger.length){return;}
data=data||{};if(!data.stack){data.stack=[];}
data.stack.push('controllers.'+this.controllerType+'.'+this.controllerID);toTrigger.trigger(ev,data);});return baseController;};return{initControllerOnElem:initControllerOnElem,register:register,mixin:mixin,isRegistered:isRegistered,init:init};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.loader',function(){var _loadedScripts=[],_loadingScripts=[];var init=function(){var scripts=$('script[type="text/javascript"][src][data-ips]');scripts.each(function(){var scriptInfo=ips.utils.url.getURIObject($(this).attr('src'));if(scriptInfo.queryKey.src){var paths=_getPathScripts(scriptInfo.queryKey.src);_.each(paths,function(value){_loadedScripts.push(value);});}else if(scriptInfo.path.indexOf('interface/')!==-1){var interfaces=_getInterfaceScript(scriptInfo.path);if(interfaces){_loadedScripts.push(interfaces);}}else{var other=_getOtherScript(scriptInfo.source);if(other){_loadedScripts.push(other);}}});},_getOtherScript=function(path){path=path.replace(ips.getSetting('baseURL'),'');if(path.startsWith('/')){path=path.substring(1);}
if(path.startsWith('applications/')){path=path.replace(/^applications\//i,'')}
return path;},_getInterfaceScript=function(path){var pieces=_.compact(path.split('/').reverse());var path=[];for(var i=0;i<pieces.length;i++){if(pieces[i]=='interface'){path.push('interface');path.push(pieces[i+1]);break;}
path.push(pieces[i]);}
if(_.indexOf(path,'interface')!==-1){return path.reverse().join('/');}
return false;},_getPathScripts=function(src){return _.compact(src.split(','));},get=function(toLoad){return $.when(_doLoad(_.compact(_.uniq(toLoad))));},_doLoad=function(filePaths){var deferred=$.Deferred();if(!_.isArray(filePaths)){filePaths=[filePaths];}
var done=[];var loading=[];var toLoad=[];for(var i=0;i<filePaths.length;i++){if(_.indexOf(_loadedScripts,filePaths[i])!==-1){done.push(filePaths[i]);continue;}
if(_.indexOf(_loadingScripts,filePaths[i])!==-1){loading.push(filePaths[i]);continue;}
toLoad.push(filePaths[i]);}
if(done.length===filePaths.length){deferred.resolve();return deferred.promise();}
if(loading.length||toLoad.length){$(document).on('scriptLoaded',function(e,files){for(var i=0;i<files.length;i++){if(_.indexOf(filePaths,files[i])===-1){continue;}
done.push(files[i]);}
if(done.length===filePaths.length){setTimeout(function(){deferred.resolve();},100);}});}
if(toLoad.length){var localFiles=[];var remoteFiles=[]
for(var i=0;i<toLoad.length;i++){if(toLoad[i].match(/^(http|\/\/)/i)){remoteFiles.push(toLoad[i]);}else{localFiles.push(toLoad[i]);}}
if(localFiles.length){_insertScript(localFiles);}
if(remoteFiles.length){for(var i=0;i<remoteFiles.length;i++){_insertScript([remoteFiles[i]]);}}}
return deferred.promise();},_insertScript=function(toLoad,cached){for(var i=0;i<toLoad.length;i++){_loadingScripts.push(toLoad[i]);}
Debug.log("Loading: "+toLoad.join(', '));var url='';if(toLoad[0].match(/^(http|\/\/)/i)){url=toLoad[0];}else{url=ips.getSetting('jsURL')+'?src='+encodeURIComponent(toLoad.join(','));}
setTimeout(function(){$.ajax({dataType:'script',cache:(_.isUndefined(cached))?true:cached,url:url,data:{antiCache:ips.getSetting('antiCache')}}).fail(function(jqXHR,textStatus,errorThrown){Debug.error("Failed to load: "+toLoad.join(', '));Debug.log(textStatus);}).always(function(){for(var i=0;i<toLoad.length;i++){var index=_.indexOf(_loadingScripts,toLoad[i]);if(index!==-1){_loadingScripts.splice(index,1);}}}).done(function(){for(var i=0;i<toLoad.length;i++){_loadedScripts.push(toLoad[i]);}
$(document).trigger('scriptLoaded',[toLoad]);Debug.log("Loaded: "+toLoad.join(', '));})},500);};return{init:init,get:get}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.model',function(){var _models={};var register=function(id,definition){var Base=getBaseModel();$.extend(Base.prototype,definition);var obj=new Base(id);if(_.isFunction(obj.initialize)){obj.initialize.call(obj);}},getBaseModel=function(){var baseModel=function(id){this.modelID=id;};baseModel.method('trigger',function(elem,ev,data){var args=ips.utils.argsToArray(arguments);elem=(!_.isElement(elem))?$(document):$(args.shift());ev=args[0];data=args[1]||{};if(!data.stack){data.stack=[];}
data.stack.push('models.'+this.modelID);elem.trigger(ev,data);});baseModel.method('on',function(elem,ev,delegate,fn){var args=ips.utils.argsToArray(arguments);elem=(!_.isElement(elem)&&elem!=document)?$(document):$(args.shift());ev=args[0];fn=(args.length==3)?args[2]:args[1];delegate=(args.length==3)?args[1]:undefined;if(!_.isFunction(fn)){Debug.warn("Callback function for "+ev+" doesn't exist in "+this.modelID);return;}
fn=_.bind(fn,this);if(delegate){elem.on(ev,delegate,fn);}else{elem.on(ev,fn);}});baseModel.method('getData',function(data,eventData){var self=this;var ajaxObj=ips.getAjax();if(!data.url.startsWith('http')){data.url=ips.getSetting('baseURL')+'?'+data.url;}
if(data.events&&_.isString(data.events)){data.events={loading:data.events+'Loading',done:data.events+'Done',fail:data.events+'Error',always:data.events+'Finished'};}
if(data.namespace&&!data.namespace.startsWith('.')){data.namespace='.'+data.namespace;}
if(data.events.loading){this.trigger(data.events.loading+(data.namespace||''),eventData||{});}
ajaxObj(data.url,{data:data.data||{},dataType:data.dataType||'html',type:data.type||'get'}).done(function(response){if(data.events.done){if(data.dataType=='json'){var doneData=_.extend(eventData||{},response);}else{var doneData=_.extend(eventData||{},{response:response});}
self.trigger(data.events.done+(data.namespace||''),doneData);}}).fail(function(){if(data.events.fail){self.trigger(data.events.fail+(data.namespace||''),eventData)}}).always(function(){if(data.events.always){self.trigger(data.events.always+(data.namespace||''));}});});return baseModel;};return{register:register};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui',function(){var widgets={},doneInitialInit=false,ziCounter=ips.getSetting('zindex_start')||5000,ziIncrement=ips.getSetting('zindex_inc')||50;var key={BACKSPACE:8,ESCAPE:27,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,COMMA:188,SPACE:32};var registerWidget=function(widgetID,handler,acceptedOptions,widgetOptions,fnCallback){widgetOptions=_.defaults(widgetOptions||{},{'lazyLoad':false,'lazyEvents':'','makejQueryPlugin':true});if(widgets[widgetID]){Debug.warn("'"+widgetID+"' is already registered as a widget. Skipping...");}
widgets[widgetID]={handler:handler,callback:fnCallback,acceptedOptions:acceptedOptions||[],widgetOptions:widgetOptions||{}};if(widgetOptions.makejQueryPlugin!==false){buildjQueryPlugin(widgetID,handler,acceptedOptions,widgetOptions,fnCallback);}},buildjQueryPlugin=function(widgetID,handler,acceptedOptions,widgetOptions){var jQueryKey=widgetOptions.jQueryKey||'ips'+widgetID.charAt(0).toUpperCase()+widgetID.slice(1),dataID='ips'+widgetID;if($.fn[jQueryKey]){Debug.warn("jQuery plugin '"+jQueryKey+"' already exists.");return;}
$.fn[jQueryKey]=function(providedOptions){this.each(function(){var elem=$(this);if(elem.attr(dataID)){removeExistingWidget(widgetID,this);}
elem.attr('data-'+dataID,'');$.each(providedOptions,function(key,value){if(_.indexOf(acceptedOptions,key)!==false){elem.attr('data-'+dataID+'-'+key,value);}});if(widgetOptions.lazyLoad===false){_callWidget(widgetID,elem,_getWidgetOptions(widgetID,elem));}});};},_initializeWidgets=function(context){var immediateWidgets=[],lazyWidgets=[];if(!_.isElement(context)){context=document;}
_.each(widgets,function(item,key){if(_.isUndefined(item.widgetOptions.lazyLoad)||item.widgetOptions.lazyLoad===false){immediateWidgets.push(key);}else{lazyWidgets.push(key);}});_doImmediateWidgets(immediateWidgets,context);if(!doneInitialInit){_doLazyWidgets(lazyWidgets,context);doneInitialInit=true;}},destructAllWidgets=function(context){var widgetIDs=_.keys(widgets);var selector=_.map(widgetIDs,function(item){return"[data-ips"+item+"]";});var foundWidgets=$(context).find(selector.join(','));foundWidgets.each(function(idx,elem){elem=$(elem);for(var i=0;i<widgetIDs.length;i++){if(!_.isUndefined(elem.attr('data-ips'+widgetIDs[i]))){_destructWidget(widgetIDs[i],elem);}}});},_destructWidget=function(widgetID,elem){if(_.isFunction(widgets[widgetID].handler.destruct)){try{widgets[widgetID].handler.destruct.call(widgets[widgetID].handler,elem);}catch(err){Debug.error("Error calling destruct on "+widgetID);}}},_doImmediateWidgets=function(widgetsToLoad,context){if(!widgetsToLoad.length){return;}
var selector=_.map(widgetsToLoad,function(item){return"[data-ips"+item+"]";});var foundWidgets=$(context).find(selector.join(','));foundWidgets.each(function(idx,elem){elem=$(elem);for(var i=0;i<widgetsToLoad.length;i++){if(!_.isUndefined(elem.attr('data-ips'+widgetsToLoad[i]))){_callWidget(widgetsToLoad[i],elem,_getWidgetOptions(widgetsToLoad[i],elem));}}});},_doLazyWidgets=function(widgetsToLoad){if(!widgetsToLoad.length){return;}
for(var i=0;i<widgetsToLoad.length;i++){var lazyEvents=widgets[widgetsToLoad[i]].widgetOptions.lazyEvents;if(!lazyEvents){lazyEvents='click';}
$(document).on(lazyEvents,"[data-ips"+widgetsToLoad[i]+"]",_.partial(function(widgetKey,e){_callWidget(widgetKey,this,_getWidgetOptions(widgetKey,this),e);},widgetsToLoad[i]));}},_callWidget=function(widgetID,elem,options,e){if(_.isFunction(widgets[widgetID].callback)){widgets[widgetID].callback.call(widgets[widgetID].handler,elem,options,e);}else if(_.isFunction(widgets[widgetID].handler.respond)){widgets[widgetID].handler.respond.call(widgets[widgetID].handler,elem,options,e);}else{Debug.error("No callback method specified for "+widgetID);}},_getWidgetOptions=function(widgetID,elem){var options={},optionKeys=widgets[widgetID].acceptedOptions;elem=$(elem);try{if(elem.attr('data-ips'+widgetID+'-options')){var optionsObj=$.parseJSON(elem.attr('data-ips'+widgetID+'-options'));if(_.isObject(optionsObj)){return optionsObj;}}}catch(err){Debug.warn("Invalid options object passed in for a "+widgetID+" widget. Must be valid JSON.");}
if(optionKeys.length){for(var i=0;i<optionKeys.length;i++){var thisOption=elem.attr('data-ips'+widgetID+'-'+optionKeys[i]);if(!_.isUndefined(thisOption)){if(thisOption.match(/^[0-9]+$/g)){thisOption=parseInt(thisOption,10);}
if(thisOption==='true'){thisOption=true;}else if(thisOption==='false'){thisOption=false;}
if($.trim(thisOption)===''){thisOption=true;}
options[optionKeys[i]]=thisOption;}}}
return options;},zIndex=function(){ziCounter+=ziIncrement;return ziCounter;},getModal=function(){return $('<div/>').addClass('ipsModal').hide().appendTo($('body')).identify();},init=function(){$(document).on('contentChange',function(e,newContent){Debug.info("contentChange event, reinitializing widgets in "+newContent.identify().attr('id'));_initializeWidgets((_.isFunction(newContent.get)?newContent.get(0):newContent));});_initializeWidgets(document);};return{registerWidget:registerWidget,init:init,zIndex:zIndex,getModal:getModal,key:key,destructAllWidgets:destructAllWidgets};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.addressForm',function(){var defaults={minimize:false,country:""};var respond=function(elem,options,e){options=_.defaults(options,defaults);if(options.minimize){minimizeAddress(elem,options);}else{init(elem,options,e);}};var init=function(elem,options,e){elem.on('change','[data-role="countrySelect"]',_.bind(countryChange,e,elem));$(elem).find('[data-role="countrySelect"]').change();recalculateAddAddressLineButton(elem);};var googlePlacesCallback=function(){$(window).trigger('googlePlacesLoaded');};var minimizeAddress=function(elem,options){var tempInput=$('<input/>').attr('type','text').attr('data-role','minimizedVersion').attr('placeholder',ips.getString('specifyLocation')).on('focus',function(e){$(this).hide();if(options.country){$(elem).find('[data-role="countrySelect"]').val(options.country);}
init(elem,options,e);elem.show().find('input').first().focus();});var value=[];elem.find('input, select').each(function(addressPart){if($(this).val()){if($(this).is('select')){value.push($.trim($(this).find('option[value="'+$(this).val()+'"]').text()));}else{value.push($.trim($(this).val()));}}});if(value.length){tempInput.val(value.join(', '));}
elem.hide().after(tempInput);};var countryChange=function(elem,e){ips.getAjax()($('body').attr('data-baseurl')+'?app=core&module=system&controller=ajax&do=states&country='+$(e.target).val()).done(function(response){if(response.length){if(!$(elem).find('[data-role="regionSelect"]').length)
{var regionText=$(elem).find('[data-role="regionText"]');}
else
{var regionText=$(elem).find('[data-role="regionSelect"]');}
var regionSelect=$('<select data-role="regionSelect" />');regionSelect.attr('name',regionText.attr('name'));for(var i=0;i<response.length;i++){regionSelect.append($('<option />').attr('value',response[i]).html(response[i]));if(response[i].toLowerCase()==regionText.val().toLowerCase()){regionSelect.val(response[i]);}}
regionText.replaceWith(regionSelect);}else{if(!$(elem).find('[data-role="regionText"]').length){var regionSelect=$(elem).find('[data-role="regionSelect"]');var regionText=$('<input type="text" data-role="regionText" placeholder="'+ips.getString('address_region')+'" />');regionText.attr('name',regionSelect.attr('name')).val(regionSelect.val());regionSelect.replaceWith(regionText);}}});if(typeof elem.attr('data-ipsAddressForm-googlePlaces')!==typeof undefined&&elem.attr('data-ipsAddressForm-googlePlaces')!==false){if(typeof elem.attr('data-ipsAddressForm-googlePlaces')!==typeof undefined&&elem.attr('data-ipsAddressForm-googlePlaces')!==false){if(elem.attr('data-ipsAddressForm-googlePlaces')==='loaded'){googlePlacesInit(elem);}else{ips.loader.get(['http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&callback=ips.ui.addressForm.googlePlacesCallback']);$(window).on('googlePlacesLoaded',function(){elem.attr('data-ipsAddressForm-googlePlaces','loaded');googlePlacesInit(elem);});}}}};var addAddressLine=function(elem,value){var lastLine=elem.find('[data-role="addressLine"]').closest('li').last();var newLine=lastLine.clone();if(value){newLine.find('input').val(value);}
lastLine.after(newLine);};var recalculateAddAddressLineButton=function(elem){elem.find('[data-role="addAddressLine"]').remove();var button=$('<i class="fa fa-plus" style="cursor:pointer; margin-left: 4px" data-role="addAddressLine">');button.click(function(){addAddressLine(elem,'');recalculateAddAddressLineButton(elem);});elem.find('[data-role="addressLine"]').last().after(button);};var googlePlacesInit=function(elem){var googlePlacesInput=$(elem).find('[data-role="addressLine"]').first();var options={types:['geocode'],componentRestrictions:{country:$(elem).find('[data-role="countrySelect"]').val()}};var autocomplete=new google.maps.places.Autocomplete(googlePlacesInput.get(0),options);googlePlacesInput.on('focus',function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var geolocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);autocomplete.setBounds(new google.maps.LatLngBounds(geolocation,geolocation));});}});googlePlacesInput.on('keypress',function(e){if((e.which&&e.which==13)||(e.keyCode&&e.keyCode==13)){return false;}});google.maps.event.addListener(autocomplete,'place_changed',function(){var place=autocomplete.getPlace();var i;var streetNumber;var addressLines=[];for(i in place.address_components){switch(place.address_components[i].types[0]){case'street_number':streetNumber=place.address_components[i].long_name;break;case'street_address':case'route':case'sublocality':case'neighborhood':case'premise':case'subpremise':addressLines.push(place.address_components[i].long_name);break;case'administrative_area_level_1':case'administrative_area_level_2':elem.find('[data-role="regionSelect"]').val(place.address_components[i].long_name);elem.find('[data-role="regionText"]').val(place.address_components[i].long_name);break;case'locality':case'postal_town':elem.find('[data-role="city"]').val(place.address_components[i].long_name);break;case'postal_code':elem.find('[data-role="postalCode"]').val(place.address_components[i].long_name);break;}}
for(var i=0;i<$(elem).find('[data-role="addressLine"]').length;i++){$(elem).find('[data-role="addressLine"]').val('');}
setTimeout(function(){var existingAddressLines=$(elem).find('[data-role="addressLine"]').length;if(streetNumber&&addressLines[0]){addressLines[0]=streetNumber+' '+addressLines[0];}
for(var i=0;i<addressLines.length;i++){if(existingAddressLines){$(elem).find('[data-role="addressLine"]').slice(i,1).val(addressLines[i]);existingAddressLines--;}else{addAddressLine(elem,addressLines[i]);}}},50);});}
ips.ui.registerWidget('addressForm',ips.ui.addressForm,['minimize','country']);return{respond:respond,googlePlacesCallback:googlePlacesCallback};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.alert',function(){var respond=function(elem,options){alertObj(options,elem);},show=function(options){alertObj(options);};ips.ui.registerWidget('alert',ips.ui.alert,['message','type','icon']);return{respond:respond,show:show};});var alertObj=function(options){var alert=null,modal=null;var _defaults={type:'alert',message:'Are you sure?',buttons:{ok:ips.getString('ok'),cancel:ips.getString('cancel'),yes:ips.getString('yes'),no:ips.getString('no')},icon:'info',showIcon:true,callbacks:{}};var _icons={warn:'fa fa-exclamation-triangle',success:'fa fa-check-circle',info:'fa fa-info-circle',ok:'fa fa-check-circle',question:'fa fa-question-circle'};options=_.defaults(options||{},_defaults);var init=function(){_buildAlert();_setUpEvents();},_setUpEvents=function(){alert.on('click','[data-action]',_clickButton);$(document).on('keydown',function(e){switch(e.keyCode){case ips.ui.key.ESCAPE:if(options.type=='alert'){alert.find('[data-action="ok"]').click();}else{alert.find('[data-action="cancel"], [data-action="no"]').click();}
break;case ips.ui.key.ENTER:alert.find('[data-action="ok"], [data-action="yes"]').click();break;}});},_clickButton=function(e){var button=$(e.currentTarget);var action=button.attr('data-action');var value=null;if(options.type=='prompt'){value=alert.find('[data-role="promptValue"]').val();}
if(_.isFunction(options.callbacks[action])){options.callbacks[action](value);}
_remove();},_remove=function(){modal.remove();ips.utils.anim.go('fadeOutDown fast',alert).done(function(){alert.remove();});},_buildAlert=function(){var parts={},buttons=[];if(options.showIcon){parts.icon=ips.templates.render('core.alert.icon',{icon:_icons[options.icon]||options.icon});}
parts.id='alert_'+(Math.round(Math.random()*10000000));parts.text=options.message;if(options.subText){parts.subtext=ips.templates.render('core.alert.subText',{text:options.subText});}
switch(options.type){case'alert':buttons.push(ips.templates.render('core.alert.button',{action:'ok',title:options.buttons.ok,extra:'ipsButton_primary'}));break;case'confirm':case'prompt':buttons.push(ips.templates.render('core.alert.button',{action:'ok',title:options.buttons.ok,extra:'ipsButton_primary'}));buttons.push(ips.templates.render('core.alert.button',{action:'cancel',title:options.buttons.cancel,extra:'ipsButton_light'}));break;case'verify':buttons.push(ips.templates.render('core.alert.button',{action:'yes',title:options.buttons.yes,extra:'ipsButton_primary'}));buttons.push(ips.templates.render('core.alert.button',{action:'no',title:options.buttons.no,extra:'ipsButton_light'}));if(options.buttons.cancel){buttons.push(ips.templates.render('core.alert.button',{action:'cancel',title:options.buttons.cancel,extra:'ipsButton_light'}));}
break;}
parts.buttons=buttons.join('');if(options.type=='prompt'){parts.text+=ips.templates.render('core.alert.prompt');}
var tmpAlert=$.parseHTML($.trim(ips.templates.render('core.alert.box',parts)));alert=$(tmpAlert[0]);$('body').append(alert);modal=ips.ui.getModal();modal.css({zIndex:ips.ui.zIndex()}).show();alert.css({zIndex:ips.ui.zIndex()});ips.utils.anim.go('zoomIn fast',alert);if(options.type=='prompt'){alert.find('[data-role="promptValue"]').val(options.value||'').focus();}else{alert.find('[data-action="ok"], [data-action="yes"]').focus();}};init();};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.autoCheck',function(){var defaults={};var respond=function(elem,options){if(!$(elem).data('_autoCheck')){$(elem).data('_autoCheck',autoCheckObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_autoCheck')){return $(elem).data('_autoCheck');}
return undefined;};ips.ui.registerWidget('autoCheck',ips.ui.autoCheck,['context']);return{respond:respond,getObj:getObj,destruct:destruct};});var autoCheckObj=function(elem,options){var init=function(){if(options.context&&$(options.context).length){elem.on('menuItemSelected',clickedMenu);$(options.context).on('change','input[type="checkbox"][data-state]',_updateCount);}
elem.find('[data-role="autoCheckCount"]').hide();},destruct=function(){if(options.context){$(options.context).off('change','input[type="checkbox"][data-state]',_updateCount);}},clickedMenu=function(e,data){if(!_.isUndefined(data.originalEvent)){data.originalEvent.preventDefault();}
if(!data.selectedItemID){return;}
var checkboxes=$(options.context).find(':checkbox[data-state]');if(data.selectedItemID=='all'){checkboxes.prop('checked',true);}else if(data.selectedItemID=='none'){checkboxes.prop('checked',false);}else{checkboxes.prop('checked',false).filter('[data-state~="'+data.selectedItemID+'"]').prop('checked',true);}
checkboxes.trigger('change');var count=_updateCount();elem.trigger('autoChecked',{menu:elem,currentFilter:data.selectedItemID,count:count});},_updateCount=function(){var checkboxes=$(options.context).find(':checkbox[data-state]');var count=$(options.context).find(':checkbox[data-state]:checked');if(count.length==checkboxes.length){elem.find('.cAutoCheckIcon').html('<i class="fa fa-check-square"></i>');}else if(count.length===0){elem.find('.cAutoCheckIcon').html('<i class="fa fa-square-o"></i>');}else{elem.find('.cAutoCheckIcon').html('<i class="fa fa-minus-square"></i>');}
if(count.length){elem.find('[data-role="autoCheckCount"]').text(count.length).show();}else if(elem.find('[data-role="autoCheckCount"]').is(':visible')){ips.utils.anim.go('fadeOut',elem.find('[data-role="autoCheckCount"]'));}
return count.length;};init();return{destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.autocomplete',function(){var defaults={multiValues:true,freeChoice:true,itemSep:{chr:',',keycode:188},diallowedCharacters:["<",".","'","\""],unique:false,customValues:true,fieldTemplate:'core.autocomplete.field',resultsTemplate:'core.autocomplete.resultWrapper',resultItemTemplate:'core.autocomplete.resultItem',tokenTemplate:'core.autocomplete.token',addTokenTemplate:'core.autocomplete.addToken',addTokenText:ips.getString('add_tag'),queryParam:'q',forceLower:false,minLength:1};var respond=function(elem,options){if(!$(elem).data('_autocomplete')){$(elem).data('_autocomplete',autocompleteObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){elem=$(elem);if(elem.data('_autocomplete')){return elem.data('_autocomplete');}else if($('[name="'+elem.attr('name')+'_original'+'"]').length&&$('[name="'+elem.attr('name')+'_original'+'"]').data('_autocomplete')){return $('[name="'+elem.attr('name')+'_original'+'"]').data('_autocomplete');}
return undefined;};ips.ui.registerWidget('autocomplete',ips.ui.autocomplete,['multiValues','freeChoice','dataSource','maxItems','itemSep','resultsElem','unique','fieldTemplate','resultsTemplate','resultItemTemplate','tokenTemplate','addTokenTemplate','addTokenText','queryParam','minLength','maxLength','forceLower','diallowedCharacters']);return{respond:respond,destruct:destruct,getObj:getObj};});var autocompleteObj=function(elem,options,e){var timer,blurTimer,lastValue='',originalTextField,valueField,textField,dataSource,elemID=$(elem).identify().attr('id'),wrapper,inputItem,resultsElem,selectedToken,disabled=false,required=false,tooltip=null,tooltipTimer=null;var init=function(){if($(elem).is('input[type="text"], input[type="search"]')){originalTextField=$(elem);}else{originalTextField=$(elem).find('input[type="text"], input[type="search"]').first();}
_buildWrapper();_getDataSource();originalTextField.removeAttr('list');if(dataSource.type!='none'){_buildResultsList();}
if(originalTextField.is(':disabled')){disabled=true;}
if(originalTextField.is('[required]')){required=true;originalTextField.removeProp('required').removeAttr('aria-required');}
textField.prop('autocomplete','off').prop('spellcheck',false).prop('disabled',disabled).attr('aria-autocomplete','list').attr('aria-haspopup','true').attr('tabindex',originalTextField.attr('tabindex')||'');if(options.maxLength){textField.attr('maxlength',options.maxLength+1);}
$(document).on('click',_documentClick);wrapper.click(function(e){e.stopPropagation();return false;});textField.on('focus',_focusField).on('blur',_blurField).on('keydown',_keydownField).on('keyup',_keyupField);wrapper.on('click',_clickWrapper).on('click','[data-action="addToken"]',_clickAddToken).on('keydown',_keydownWrapper).on('propChanged',_propChanged).toggleClass('ipsField_autocompleteDisabled',disabled);_buildInitialTokens();elem.trigger('autoCompleteReady',{elemID:elemID,elem:elem,currentValues:tokens.getValues()});},destruct=function(){$(document).off('click',_documentClick);},_propChanged=function(e){disabled=originalTextField.is(':disabled');wrapper.toggleClass('ipsField_autocompleteDisabled',disabled);},_buildInitialTokens=function(){var value=originalTextField.val();if(!value){return;}
var splitValues=_.without(value.split(options.itemSep.chr),'');var itemCount=0;if(options.maxItems==undefined){itemCount=splitValues.length;}else{itemCount=Math.min(splitValues.length,options.maxItems);}
originalTextField.val('');if(splitValues.length){for(var i=0;i<itemCount;i++){_addToken(splitValues[i]);}}},_buildResultsList=function(){if(options.resultsElem&&$(options.resultsElem).length){resultsElem=$(options.resultsElem);return;}
var resultsList=ips.templates.render(options.resultsTemplate,{id:elemID});wrapper.append(resultsList);resultsElem=$('#'+elemID+'_results');resultsElem.on('mouseover','[data-value]',function(e){results.select($(e.currentTarget));}).on('click','[data-value]',function(e){_addToken($(e.currentTarget).attr('data-value'));textField.focus();}).attr('aria-busy','false');},_buildWrapper=function(){var existingClasses=elem[0].className;$(elem).after(ips.templates.render(options.fieldTemplate,{id:elemID})).removeClass(existingClasses);wrapper=$('#'+elemID+'_wrapper');inputItem=$('#'+elemID+'_inputItem');if(!options.freeChoice){var insertElem=ips.templates.render('core.autocomplete.addToken',{text:options.addTokenText});textField=elem;}else{var insertElem=$('<input/>').attr({type:'text',id:elemID+'_dummyInput'}).prop('autocomplete','off');textField=insertElem;}
var name=originalTextField.attr('name');originalTextField.attr('name',originalTextField.attr('name')+'_original');valueField=$('<input/>').attr('name',name).hide();originalTextField.hide();wrapper.addClass(existingClasses).append(elem).append(valueField).find('#'+elemID+'_inputItem').append(insertElem);wrapper.on('click','[data-value]',function(e){if(!disabled){tokens.select($(e.currentTarget));}}).on('click','[data-action="delete"]',function(e){_deleteToken($(e.currentTarget).parent('[data-value]'));});},_getDataSource=function(){if((options.dataSource&&options.dataSource.indexOf('#')===0&&$(options.dataSource).length)||originalTextField.is('[list]')){dataSource=localData(originalTextField.is('[list]')?$('#'+originalTextField.attr('list')):options.dataSource,options);}else if(ips.utils.validate.isUrl(options.dataSource)){dataSource=remoteData(options.dataSource,options);}else{dataSource=noData();}},_clickWrapper=function(e){if($(e.target).is('[data-token]')||$(e.target).parents('li[data-token]').length){var token=($(e.target));}else{if(!$(e.target).is(textField)&&(!resultsElem||!$.contains(resultsElem.get(0),e.target))){textField.focus();}}},_clickAddToken=function(e){e.preventDefault();if(resultsElem&&resultsElem.is(':visible')){_closeResults();}else{_loadResults('');}},_focusField=function(e){if(dataSource.type=='none'){return;}
timer=setInterval(_timerFocusField,400);},_blurField=function(e){clearInterval(timer);_.delay(_timerBlurField,300);},_timerBlurField=function(){if(textField.val()){_addTokenFromCurrentInput();}
_closeResults();},_timerFocusField=function(){if(dataSource.type=='none'){return;}
var currentValue=_getCurrentValue();if(currentValue==lastValue){return;}
lastValue=currentValue;_loadResults(currentValue);},_loadResults=function(value){_toggleLoading('show');resultsElem.attr('aria-busy','true');dataSource.getResults(value).done(function(results){_showResults(_processResults(results,value));}).fail(function(){}).always(function(){resultsElem.attr('aria-busy','false');_toggleLoading('hide');});},_toggleLoading=function(doWhat){if(doWhat=='show'){wrapper.addClass('ipsField_loading');}else{wrapper.removeClass('ipsField_loading');}},_closeResults=function(e){if(e){e.preventDefault();}
if(resultsElem&&resultsElem.length){resultsElem.hide().attr('aria-expanded','false');}
dataSource.stop();},_documentClick=function(){_closeResults();},_processResults=function(results,text){var existingTokens=tokens.getValues(),newResults={};if(options.unique){$.each(results,function(key,data){if(!data.value||_.indexOf(existingTokens,data.value)===-1){newResults[key]=data;}});return newResults;}
return results;},_showResults=function(results){var output='';$.each(results,function(idx,value){output+=ips.templates.render(options.resultItemTemplate,value);});if(resultsElem.attr('id')==(elemID+'_results')){_positionResults();}
resultsElem.show().html(output).attr('aria-expanded','true');},_positionResults=function(){resultsElem.css({width:wrapper.outerWidth()+'px',});var positionInfo={trigger:wrapper,targetContainer:wrapper,target:resultsElem,center:false};var resultsPosition=ips.utils.position.positionElem(positionInfo);$(resultsElem).css({left:'0px',top:resultsPosition.top+'px',position:(resultsPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});},_getCurrentValue=function(){var value=textField.val();if(options.multiValues){if(value.indexOf(options.itemSep.chr)===-1){return $.trim(value);}else{var pieces=value.split(options.itemSep.chr);return $.trim(pieces[pieces.length-1]);}}else{return value;}},_keydownWrapper=function(e){if(e.keyCode==ips.ui.key.ESCAPE){keyEvents.escape(e);}},_keydownField=function(e){_expandField();var ignoreKey=false;if(!_([options.itemSep.keycode,ips.ui.key.UP,ips.ui.key.DOWN,ips.ui.key.LEFT,ips.ui.key.RIGHT,ips.ui.key.ENTER,ips.ui.key.TAB,ips.ui.key.BACKSPACE,ips.ui.key.ESCAPE]).contains(e.keyCode)){ignoreKey=true;}
var value=$.trim(textField.val());if(options.maxLength&&value.length==options.maxLength&&ignoreKey){e.preventDefault();return;}
if(ignoreKey){return;}
if(_([options.itemSep.keycode,ips.ui.key.ENTER,ips.ui.key.TAB]).contains(e.keyCode)&&options.unique&&_duplicateValue(value)){e.preventDefault();_showTooltip(ips.getString('ac_dupes'));return;}
switch(e.keyCode){case ips.ui.key.BACKSPACE:keyEvents.backspace(e);break;case ips.ui.key.TAB:case ips.ui.key.ENTER:keyEvents.enter(e);break;case ips.ui.key.UP:keyEvents.up(e);break;case ips.ui.key.DOWN:keyEvents.down(e);break;case ips.ui.key.ESCAPE:keyEvents.escape(e);break;}},_addToken=function(value){tokens.add(value);textField.val('');lastValue='';_resetField();if(options.maxItems&&tokens.total()>=options.maxItems){inputItem.hide();}
if(options.unique&&options.freeChoice==false&&dataSource.totalItems()!==-1&&dataSource.totalItems()<=tokens.total()){wrapper.find('[data-action="addToken"]').hide();}},_deleteToken=function(token){if(disabled){return;}
tokens.remove(token);},keyEvents={backspace:function(e){if(!textField.val()){if(tokens.selected){tokens.remove(tokens.selected);}else{if(inputItem.prev().length){tokens.select(inputItem.prev());}}}},enter:function(e){if(e.keyCode==ips.ui.key.TAB&&textField.val()==''){return false;}
e.preventDefault();var currentResult=results.getCurrent();var value='';if(currentResult){value=currentResult.attr('data-value');}else{value=_stripHTML(textField.val().replace(options.itemSep.chr,''));}
if(!value){return false;}
_addToken(value);},up:function(e){if(!resultsElem||!resultsElem.is(':visible')){return;}
e.preventDefault();var selected=results.getCurrent();if(!selected){results.selectLast();}else{var prev=results.getPrevious(selected);if(prev){results.select(prev);}else{results.selectLast();}}},down:function(e){if(!resultsElem||!resultsElem.is(':visible')){return;}
e.preventDefault();var selected=results.getCurrent();if(!selected){results.selectFirst();}else{var next=results.getNext(selected);if(next){results.select(next);}else{results.selectFirst();}}},escape:function(e){if(resultsElem&&resultsElem.is(':visible')){_closeResults();}}},results={deselectAll:function(){resultsElem.find('[data-selected]').removeAttr('data-selected');},getCurrent:function(){if(dataSource.type=='none'){return;}
var cur=resultsElem.find('[data-selected]');if(cur.length&&resultsElem.is(':visible')){return cur;}
return false;},getPrevious:function(result){var prev=$(result).prev('[data-value]');if(prev.length){return prev;}
return false;},getNext:function(result){var next=$(result).next('[data-value]');if(next.length){return next;}
return false;},selectFirst:function(){results.select(resultsElem.find('[data-value]').first());},selectLast:function(){results.select(resultsElem.find('[data-value]').last());},select:function(result){results.deselectAll();result.attr('data-selected',true);}},tokens={selected:null,add:function(value){var html='';value=$.trim(value);if(options.minLength&&value.length<options.minLength){return false;}
if(options.maxLength&&value.length>options.maxLength){return false;}
if(options.forceLower){value=value.toLowerCase();}
tokens.deselectAll();inputItem.before(ips.templates.render(options.tokenTemplate,{id:elemID,value:value,title:value}));if(resultsElem){_closeResults();}
valueField.val(tokens.getValues().join(options.itemSep.chr));if(dataSource.type!='none'){html=resultsElem.find('[data-value="'+value+'"]').html();}else{html=value;}
elem.trigger('tokenAdded',{token:value,html:html,tokenList:tokens.getValues(),totalTokens:tokens.total()});return true;},remove:function(token){if(tokens.selected==token){tokens.selected=null;}
var value=$(token).attr('data-value');$(token).remove();if(options.maxItems&&tokens.total()<options.maxItems){inputItem.show();}
if(options.unique&&options.freeChoice==false&&(dataSource.totalItems()===-1||dataSource.totalItems()>tokens.total())){wrapper.find('[data-action="addToken"]').show();}
valueField.val(tokens.getValues().join(options.itemSep.chr));elem.trigger('tokenDeleted',{token:value,tokenList:tokens.getValues(),totalTokens:tokens.total()});},removeAll:function(){var allTokens=inputItem.siblings().filter('[data-value]');allTokens.each(function(){tokens.remove($(this));});},select:function(token){tokens.deselectAll();tokens.selected=$(token).addClass('cToken_selected');},total:function(){return inputItem.siblings().filter('[data-value]').length;},getValues:function(){var values=[];var allTokens=inputItem.siblings().filter('[data-value]');if(allTokens.length){values=_.map(allTokens,function(item){return $(item).attr('data-value');});}
return values;},getSelected:function(){return tokens.selected.attr('data-value');},deselectAll:function(){wrapper.find('[data-value]').removeClass('cToken_selected');tokens.selected=null;}},_keyupField=function(e){var i;for(i in options.diallowedCharacters)
{if($(e.target).val().indexOf(options.diallowedCharacters[i])!==-1){$(e.target).val($(e.target).val().replace(options.diallowedCharacters[i],''));_showTooltip(ips.getString('ac_prohibit_special'));return;}}
if(e.keyCode!=options.itemSep.keycode){return;}
if(textField.val().indexOf(options.itemSep.chr)===-1){return;}
_addTokenFromCurrentInput();e.preventDefault();},_addTokenFromCurrentInput=function(){var value=_stripHTML(textField.val().replace(options.itemSep.chr,''));if(options.minLength&&value.length<options.minLength||options.maxLength&&value.length>options.maxLength){textField.val(textField.val().replace(options.itemSep.chr,''));return;}
if(options.unique&&_duplicateValue(value)){_showTooltip(ips.getString('ac_dupes'));return;}
_addToken(value);},_duplicateValue=function(value){var values=tokens.getValues();if(values.indexOf(value)!==-1){return true;}
return false;},_stripHTML=function(text){return text.replace(/<|>|"|'/g,'');},_showTooltip=function(msg){if(!tooltip){_buildTooltip();}
if(tooltipTimer){clearTimeout(tooltipTimer);}
tooltip.hide().text(msg);_positionTooltip();tooltipTimer=setTimeout(function(){_hideTooltip();},2500);},_hideTooltip=function(){if(tooltip&&tooltip.is(':visible')){ips.utils.anim.go('fadeOut',tooltip);}},_positionTooltip=function(){var positionInfo={trigger:wrapper,target:tooltip,center:true,above:true};var tooltipPosition=ips.utils.position.positionElem(positionInfo);$(tooltip).css({left:tooltipPosition.left+'px',top:tooltipPosition.top+'px',position:(tooltipPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});if(tooltipPosition.location.vertical=='top'){tooltip.addClass('ipsTooltip_top');}else{tooltip.addClass('ipsTooltip_bottom');}
tooltip.show();},_buildTooltip=function(){var tooltipHTML=ips.templates.render('core.tooltip',{id:'elAutoCompleteTooltip'});ips.getContainer().append(tooltipHTML);tooltip=$('#elAutoCompleteTooltip');},_expandField=function(){var text=textField.val();var widthOfElem=wrapper.width();widthOfElem-=(parseInt(wrapper.css('padding-left'))+parseInt(wrapper.css('padding-right')));var span=$('<span/>').text(text).css({'font-size':textField.css('font-size'),'letter-spacing':textField.css('letter-spacing'),'position':'absolute','top':'-100px','left':'-300px','opacity':0.1});ips.getContainer().append(span);var width=span.width()+20;span.remove();textField.css({width:((width>=widthOfElem)?widthOfElem:width)+'px'});},_resetField=function(){textField.css({width:'15px'});};init();return{init:init,destruct:destruct,addToken:tokens.add,getTokens:tokens.getValues,removeToken:tokens.remove,removeAll:tokens.removeAll};};var localData=function(source){var items=$(source).find('option');var getResults=function(text){var deferred=$.Deferred(),output=[],text=text.toLowerCase();items.each(function(idx,item){if(item.innerHTML.toLowerCase().startsWith(text)){output.push({id:item.value,value:item.value,html:item.value});}});deferred.resolve(output);return deferred.promise();},totalItems=function(){return items.length;};return{type:'local',getResults:getResults,totalItems:totalItems,stop:$.noop};};var remoteData=function(source,options){var ajaxObj,loadedCache=false,cache={};var getResults=function(text){if(options.freeChoice){return _remoteSearch(text);}else{return _remoteFetch(text);}},totalItems=function(){if(!options.freeChoice&&loadedCache){return _.size(cache);}
return-1;},_remoteSearch=function(text){var deferred=$.Deferred();if(ajaxObj){ajaxObj.abort();}
if(cache[text]){deferred.resolve(cache[text]);}else{ajaxObj=ips.getAjax()(source+'&'+options.queryParam+'='+encodeURI(text),{dataType:'json'}).done(function(response){deferred.resolve(response);cache[text]=response;}).fail(function(jqXHR,status,errorThrown){if(status!='abort'){Debug.log('aborting');}
deferred.reject();});}
return deferred.promise();},_remoteFetch=function(text){var deferred=$.Deferred();if(!loadedCache){if(ajaxObj){return;}
ajaxObj=ips.getAjax()(source,{dataType:'json'}).done(function(response){loadedCache=true;cache=response;_remoteFetch(text);}).fail(function(jqXHR,status,errorThrown){if(status!='abort'){Debug.log('aborting');}
deferred.reject();});}
cache.each(function(idx,item){if(item.value.toLowerCase().startsWith(text)){output.push(item);}});return deferred.promise();},stop=function(){if(ajaxObj){ajaxObj.abort();}};return{type:'remote',getResults:getResults,totalItems:totalItems,stop:stop};};var noData=function(){return{type:'none',getResults:$.noop,totalItems:-1,stop:$.noop};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.captcha',function(){var defaults={lang:'en-US',theme:'white'};var respond=function(elem,options){options=_.defaults(options,defaults);if(options.service=='recaptcha'){_recaptcha(elem,options);}else if(options.service=='recaptcha2'){_recaptcha2(elem,options);}else if(options.service=='keycaptcha'){_keycaptcha(elem);}},_recaptcha=function(elem,options){ips.loader.get([document.location.protocol+'//www.google.com/recaptcha/api/js/recaptcha_ajax.js']).done(function(){var container=$('<div/>');var id=container.identify().attr('id');elem.append(container);Recaptcha.create(options.key,id,{theme:options.theme,lang:options.lang,callback:function(){Debug.log('done')}});});},_recaptcha2=function(elem,options){ips.loader.get(['https://www.google.com/recaptcha/api.js?hl='+$(elem).attr('data-ipsCaptcha-lang')+'&render=explicit']).done(function(){elem.children('[data-captchaContainer]').remove();var container=$('<div data-captchaContainer/>');var id=container.identify().attr('id');elem.append(container);grecaptcha.render(id,{sitekey:$(elem).attr('data-ipsCaptcha-key'),theme:$(elem).attr('data-ipsCaptcha-theme')});});},_keycaptcha=function(elem){ips.loader.get([document.location.protocol+'//backs.keycaptcha.com/swfs/cap.js']);};ips.ui.registerWidget('captcha',ips.ui.captcha,['service','key','lang','theme']);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.carousel',function(){var defaults={item:".ipsCarousel_item",shadows:true};var respond=function(elem,options){if(!$(elem).data('_carousel')){$(elem).data('_carousel',carouselObj(elem,_.defaults(options,defaults)));}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_carousel')){return $(elem).data('_carousel');}
return undefined;};var carouselObj=function(elem,options){var currentItemCount=0;var currentLeftPos=0;var currentFirstItem=null;var ui={};var slideshowTimer=null;var slideshowTimeout=4000;var init=function(){currentItemCount=elem.find(options.item);ui={itemList:elem.find('[data-role="carouselItems"]'),next:elem.find('[data-action="next"]'),prev:elem.find('[data-action="prev"]'),nextShadow:elem.find('.ipsCarousel_shadowRight'),prevShadow:elem.find('.ipsCarousel_shadowLeft')};if(!options.shadows){ui.nextShadow.hide();ui.prevShadow.hide();}
var leftPos=parseInt(ui.itemList.css('left'));if(!_.isNaN(leftPos)){currentLeftPos=leftPos;}
_build();_checkNav();var images=$(elem).find('img').length;$(elem).find('img').load(function(){images--;if(!images){_build();}});elem.on('click',"[data-action='next']",_navNext);elem.on('click',"[data-action='prev']",_navPrev);elem.on('contentTruncated',_updateHeight);if(options.slideshow){slideshowTimer=setTimeout(_slideshowNext,slideshowTimeout);elem.on('mouseenter',function(){clearTimeout(slideshowTimer);}).on('mouseleave',function(){clearTimeout(slideshowTimer);slideshowTimer=setTimeout(_slideshowNext,slideshowTimeout);});}
$(window).on('resize',_resize);},destruct=function(){$(window).off('resize',_resize);},_build=function(){var maxHeight=_getMaxHeight();var elemWidth=0;elem.css({height:maxHeight+(parseInt(elem.css('padding-top'))+parseInt(elem.css('padding-bottom')))+'px'});if(options.fullSizeItems){elemWidth=$(elem).outerWidth(true);}
elem.find(options.item).each(function(item){var height=$(this).outerHeight();var diff=maxHeight-height;if(options.fullSizeItems){$(this).css({width:elemWidth+'px'});}});currentFirstItem=elem.find(options.item).first();_buildNav();},_updateHeight=function(){var maxHeight=_getMaxHeight();elem.css({height:maxHeight+'px'});},_slideshowNext=function(){if(ui.next.not('[data-disabled]').length){_navNext().done(function(){slideshowTimer=setTimeout(_slideshowNext,slideshowTimeout);});}else if(ui.prev.not('[data-disabled]').length){_navPrev(null,true).done(function(){slideshowTimer=setTimeout(_slideshowNext,slideshowTimeout);});}},_navNext=function(e){if(e){e.preventDefault();}
var items=elem.find(options.item);var wrapperWidth=elem.outerWidth();var listWidth=_getCurrentWidth();var stayOnScreen=currentLeftPos+wrapperWidth;var forceNext=false;var deferred=$.Deferred();var nextFirst=_.find(items,function(item,idx){var left=$(item).position().left;var width=$(item).outerWidth();var margin=($('html').attr('dir')==='rtl')?parseInt($(item).css('marginLeft')):parseInt($(item).css('marginRight'));if(forceNext){return true;}
if(left<currentLeftPos){return false;}
if(stayOnScreen>=(left+width)&&stayOnScreen<=(left+width+margin)){forceNext=true;return false;}
if(left<stayOnScreen&&(left+width)>stayOnScreen){return true;}
return false;});var nextLeftPos=$(nextFirst).position().left;if((listWidth-nextLeftPos)<wrapperWidth){nextLeftPos=listWidth-wrapperWidth;}
currentLeftPos=nextLeftPos;ui.itemList.animate({left:(nextLeftPos*-1)+'px'},'slow',function(){_checkNav();deferred.resolve();});return deferred.promise();},_navPrev=function(e,backToBeginning){if(e){e.preventDefault();}
var items=elem.find(options.item).toArray();var wrapperWidth=elem.outerWidth();var listWidth=_getCurrentWidth();var deferred=$.Deferred();var idealLeft=(currentLeftPos*-1)+wrapperWidth;if(idealLeft>=0||backToBeginning){currentLeftPos=0;ui.itemList.animate({left:'0px'},'slow',function(){_checkNav();});deferred.resolve();return deferred.promise();}
items.reverse();idealLeft=(idealLeft*-1)+wrapperWidth;var prevFirst=_.find(items,function(item,idx){var left=$(item).position().left;var width=$(item).outerWidth();var right=left+width;if(left>idealLeft){return false;}
if(right>idealLeft&&left<=idealLeft){return true;}
return false;});prevFirst=$(prevFirst);prevFirst=$(prevFirst).next(options.item);currentFirstItem=prevFirst;if(prevFirst.position()!=null){currentLeftPos=prevFirst.position().left+prevFirst.outerWidth()-wrapperWidth;}else{currentLeftPos=prevFirst.outerWidth()+wrapperWidth;}
ui.itemList.animate({left:(currentLeftPos*-1)+'px'},'slow',function(){_checkNav();deferred.resolve();});return deferred.promise();},_getMaxHeight=function(){var items=elem.find(options.item);if(!items.length){return 0;}
var max=_.max(items,function(item){var item=$(item);return item.outerHeight();});return $(max).outerHeight();},_checkNav=function(){var currentWidth=_getCurrentWidth();if((currentWidth-currentLeftPos)<=elem.outerWidth()){ui.next.hide().attr('data-disabled',true);if(ui.nextShadow.is(':visible')&&options.shadows){ips.utils.anim.go('fadeOut fast',ui.nextShadow);}}else{ui.next.show().removeAttr('data-disabled');if(!ui.nextShadow.is(':visible')&&options.shadows){ips.utils.anim.go('fadeIn fast',ui.nextShadow);}}
if(currentLeftPos<=0){ui.prev.hide().attr('data-disabled',true);if(ui.prevShadow.is(':visible')&&options.shadows){ips.utils.anim.go('fadeOut fast',ui.prevShadow);}}else{ui.prev.show().removeAttr('data-disabled');if(!ui.prevShadow.is(':visible')&&options.shadows){ips.utils.anim.go('fadeIn fast',ui.prevShadow);}}},_getCurrentWidth=function(){var items=elem.find(options.item);var width=0;items.each(function(item){width+=$(this).outerWidth();width+=parseInt($(this).css('margin-left'));width+=parseInt($(this).css('margin-right'));});return width;},_buildNav=function(){elem.find('.ipsCarousel_nav').removeClass('ipsHide');},_resize=function(){if(options.fullSizeItems){var elemWidth=$(elem).outerWidth(true);elem.find(options.item).each(function(item){$(this).css({width:elemWidth+'px'});});}};init();return{destruct:destruct};};ips.ui.registerWidget('carousel',ips.ui.carousel,['showDots','fullSizeItems','slideshow','shadows']);return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.chart',function(){var defaults={};var respond=function(elem,options){var doInit=function(){if(!$(elem).data('_chart')){$(elem).data('_chart',chartObj(elem,_.defaults(options,defaults)));}};try{doInit();}catch(err){ips.loader.get(['https://www.google.com/jsapi']).then(function(){google.load('visualization','1.0',{'packages':['corechart','gauge'],'callback':doInit});});}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_chart')){return $(elem).data('_chart');}
return undefined;};var chartObj=function(elem,options){var data=new google.visualization.DataTable();var headerTypes={};var extraOptions={};var chartElem=$(elem).next();var chart=null;var init=function(){elem.find('thead th').each(function(idx){headerTypes[idx]=$(this).attr('data-colType');data.addColumn($(this).attr('data-colType'),$(this).text());});elem.find('tbody tr').each(function(){var row=[];$(this).find('td').each(function(idx){if(headerTypes[idx]=='number'){var val;if(val=$(this).text()){val=Number(val);}else{val=null;}}else if(headerTypes[idx]=='date'||headerTypes[idx]=='datetime'||headerTypes[idx]=='timeofday'){var val=new Date($(this).text());}else{var val=$(this).text();}
if(!_.isNaN(val)){row.push(val);}});data.addRow(row);});if(options.format){var formatter=new google.visualization.NumberFormat({pattern:'# '+options.format});formatter.format(data,1);}
extraOptions=$.parseJSON(options.extraOptions);if(!_.isUndefined(extraOptions.height)){chartElem.css({height:extraOptions.height+'px'});}else{chartElem.css({minHeight:'250px'});}
elem.hide().after(chartElem);$(window).on('resize',drawChart);drawChart();google.visualization.events.addListener(chart,'ready',function(){$(elem).trigger('chartInitialized');});$(document).on('tabShown',tabShown);},drawChart=function(e){chart=new google.visualization[options.type](chartElem.get(0));chart.draw(data,extraOptions);},destruct=function(){$(window).off('resize',drawChart);$(document).off('tabShown',tabShown);},tabShown=function(e,data){if($.contains(data.panel.get(0),elem.get(0))){drawChart();}};if(_.isUndefined(google.visualization)){google.setOnLoadCallback(init);}else{init();}
return{init:init,drawChart:drawChart};};ips.ui.registerWidget('chart',ips.ui.chart,['type','extraOptions','format']);return{respond:respond,destruct:destruct,getObj:getObj};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.dialog',function(){var defaults={modal:true,draggable:false,className:'ipsDialog',close:true,fixed:false,narrow:false,callback:null,forceReload:false,flashMessage:'',remoteVerify:true,remoteSubmit:false};var showStack=[];var respond=function(elem,options,e){e.preventDefault();if(!options.url&&!options.content&&$(elem).attr('href')){options.url=$(elem).attr('href');}
if(!$(elem).data('_dialog')){$(elem).data('_dialog',dialogObj(elem,_.defaults(options,defaults)));}
$(elem).data('_dialog').show();},getObj=function(elem){if($(elem).data('_dialog')){return $(elem).data('_dialog');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},create=function(options){return dialogObj(null,_.defaults(options,defaults));},_init=function(){$(document).on('keydown',function(e){if(e.keyCode==ips.ui.key.ESCAPE){$(document).trigger('closeDialog',{dialogID:showStack[showStack.length-1]});}}).on('openDialog',function(e,data){showStack.push(data.dialogID);}).on('hideDialog',function(e,data){showStack=_.without(showStack,data.dialogID);});};ips.ui.registerWidget('dialog',ips.ui.dialog,['url','modal','draggable','size','title','close','fixed','callback','content','forceReload','flashMessage','showFrom','remoteVerify','remoteSubmit'],{lazyLoad:true,lazyEvents:'click'});_init();return{respond:respond,destruct:destruct,getObj:getObj,create:create};});var dialogObj=function(elem,options){var modal,dialog,ajaxObj,dialogID='',elemID='',dialogBuilt=false,contentLoaded=false;var init=function(){if(elem===null){elemID='elem_'+(Math.round(Math.random()*10000000));}else{elemID=$(elem).identify().attr('id');}
dialogID=elemID+'_dialog';$(document).on('closeDialog',closeDialog);},destruct=function(){$(document).off('closeDialog',closeDialog);},closeDialog=function(e,data){if(data&&data.originalEvent){data.originalEvent.preventDefault();}
if(data&&data.dialogID==dialogID){hide();}},hide=function(){var deferred=$.Deferred();if(options.fixed){$('body').removeClass('ipsNoScroll');}
dialog.animationComplete(function(){if(options.forceReload){dialog.find('.'+options.className+'_content').html('');}
$(elem||document).trigger('hideDialog',{elemID:elemID,dialogID:dialogID,dialog:dialog});deferred.resolve();});ips.utils.anim.go('fadeOutDown fast',dialog);if(options.modal){ips.utils.anim.go('fadeOut fast',modal);}
return deferred.promise();},show=function(initOnly){if(options.url&&!contentLoaded){_remoteDialog(initOnly);}else if(!contentLoaded){_localDialog(initOnly);}else{if(initOnly){return;}
modal.css({zIndex:ips.ui.zIndex()});dialog.css({zIndex:ips.ui.zIndex()});_positionDialog();_showDialog();}},remove=function(hideFirst){var doRemove=function(){if(ajaxObj&&_.isFunction(ajaxObj.abort)){ajaxObj.abort();}
dialog.remove();modal.remove();dialog=null;modal=null;dialogBuilt=false;contentLoaded=false;ajaxObj=null;};if(hideFirst&&dialog.is(':visible')){hide().done(function(){doRemove();});}else{doRemove();}},setLoading=function(loading){if(loading){dialog.find('.'+options.className+'_loading').show().end().find('.'+options.className+'_content').hide();}else{dialog.find('.'+options.className+'_loading').hide().end().find('.'+options.className+'_content').show();}},updateContent=function(newContent){dialog.find('.'+options.className+'_content').html(newContent);$(document).trigger('contentChange',[dialog]);},_showDialog=function(){if(options.fixed){$('body').addClass('ipsNoScroll');}
if(options.modal){ips.utils.anim.go('fadeIn',modal);}
if(options.showFrom&&$(options.showFrom).is(':visible')){_showFrom(options.showFrom);}else{ips.utils.anim.go('fadeInDown',dialog);}
$(elem||document).trigger('openDialog',{elemID:elemID,dialogID:dialogID,dialog:dialog,contentLoaded:contentLoaded});},_showFrom=function(showFrom){dialog.show();var dialogBit=dialog.find('>div');var dialogPosition=ips.utils.position.getElemPosition(dialogBit);var dialogHeight=dialogBit.outerHeight();var dialogWidth=dialogBit.outerWidth();dialog.hide();var fromPosition=ips.utils.position.getElemPosition($(options.showFrom));var docSize=$(document).outerWidth();var widthOffset=dialogPosition.viewportOffset.left+(fromPosition.viewportOffset.left-(dialogWidth/2));var fromHalfpoint=(fromPosition.absPos.top+($(options.showForm).outerHeight()/2));var heightOffset=(fromHalfpoint-dialogPosition.absPos.top-(dialogHeight/2));if(dialogPosition.viewportOffset.left>fromPosition.viewportOffset.left){widthOffset=widthOffset*-1;}
$(dialog).show();$(dialogBit).css({transform:'translateY('+heightOffset+'px) translateX('+widthOffset+'px) scale(0.1)',opacity:1}).animate({transform:'translateY(0px) translateX(0px) scale(1)',opacity:1},{easing:'swing'});},_remoteDialog=function(initOnly){if(!dialogBuilt){if(options.modal){_buildModal();}
_buildDialog();}
if(initOnly){_fetchContent();}else{setLoading(true);_showDialog();_fetchContent();}
if(!options.forceReload){contentLoaded=true;}},_localDialog=function(initOnly){if(!options.content&&!$(options.content).length){Debug.warn("'content' option not specified for dialog, or element doesn't exist");return;}
if(!dialogBuilt){if(options.modal){_buildModal();}
_buildDialog();}
if(initOnly){return;}
dialog.find('.'+options.className+'_content').html($(options.content).first().show());_showDialog();if(!options.forceReload){contentLoaded=true;}},_fetchContent=function(){var deferred=$.Deferred();setLoading(true);ajaxObj=ips.getAjax()(options.url).done(function(response){setLoading(false);updateContent(response);deferred.resolve();if(options.callback!==null){options.callback(dialog);}
$(elem||document).trigger('dialogContentLoaded',{elemID:elemID,dialogID:dialogID,dialog:dialog,contentLoaded:true});}).fail(function(jqXHR,status,errorThrown){if(jqXHR.responseJSON){ips.ui.alert.show({message:jqXHR.responseJSON,});setLoading(false);contentLoaded=false;hide();}else if(Debug.isEnabled()){Debug.error("Ajax request failed ("+status+"): "+errorThrown);}else{window.location=elem.href;}
deferred.reject();}).always(function(){});return deferred.promise();},_buildDialog=function(){if(dialogBuilt){return;}
var offset=0;$('body').append(ips.templates.render('core.dialog.main',{'class':options.className,title:options.title||'',id:dialogID,fixed:options.fixed,size:options.size,close:options.close}));dialog=$('#'+dialogID);dialog.css({zIndex:ips.ui.zIndex(),});_positionDialog();dialog.on('click','[data-action="dialogClose"]',function(e){Debug.log('closing by close');$(dialog).trigger('closeDialog',{dialogID:dialogID,originalEvent:e});});$(dialog).on('closeDialog',function(){Debug.log('closing by event');hide();});if(options.close){dialog.on('click',function(e){if(dialog.find('> div').get(0)!=e.target&&!$.contains(dialog.find('> div').get(0),e.target)&&$.contains(document,e.target)){Debug.log(e.target);$(dialog).trigger('closeDialog',{dialogID:dialogID,originalEvent:e});}});}
if(options.remoteVerify||options.remoteSubmit){dialog.find('.'+options.className+'_content').on('submit','form',function(e){_ajaxFormSubmit(e,$(this));});}
dialogBuilt=true;},_positionDialog=function(){if(dialog&&!options.fixed){var win=$(window);var offset=win.scrollTop();dialog.css({top:offset+'px'});}},_buildModal=function(){modal=ips.ui.getModal();modal.css({zIndex:ips.ui.zIndex()});},_ajaxFormSubmit=function(e,form){if(form.attr('data-bypassValidation')){return false;}
e.preventDefault();setLoading(true);try{if(!_.isUndefined(CKEDITOR)&&CKEDITOR!=null){for(var instance in CKEDITOR.instances){CKEDITOR.instances[instance].updateElement();}}}catch(err){}
var url=form.attr('action');var ajaxUrl=url;if(options.remoteVerify){var joinWith='?';if(ajaxUrl.indexOf('?')!=-1)
{joinWith='&';}
ajaxUrl=ajaxUrl+joinWith+'ajaxValidate=1';}
ips.getAjax()(ajaxUrl,{data:form.serialize(),type:'post'}).done(function(response,status,jqXHR){if(options.remoteVerify&&!form.attr('data-bypassValidation')){if(jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormError: true')!==-1||jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormNoSubmit: true')!==-1){Debug.log('Validation failed');setLoading(false);updateContent(response);return;}}
if(options.remoteSubmit){var doneAfterSubmit=function(submitResponse){$(elem||document).trigger('submitDialog',{elemID:elemID,dialogID:dialogID,dialog:dialog,contentLoaded:contentLoaded,response:submitResponse});setLoading(false);hide();if(options.flashMessage){ips.ui.flashMsg.show(options.flashMessage);}};if(options.remoteVerify){ips.getAjax()(url,{data:form.serialize(),type:'post',bypassRedirect:true}).done(function(response,status,jqXHR){if(jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormError: true')!==-1||jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormNoSubmit: true')!==-1){form.attr('data-bypassValidation',true).submit();}else{doneAfterSubmit(response);}}).fail(function(jqXHR,status,errorThrown){form.attr('data-bypassValidation',true).submit();});}else{doneAfterSubmit(response);}}else if(jqXHR.getAllResponseHeaders().indexOf('X-IPS-FormNoSubmit: true')!==-1){setLoading(false);updateContent(response);}else{form.attr('data-bypassValidation',true).submit();}}).fail(function(){form.attr('data-bypassValidation',true).submit();});};init();return{init:init,show:show,hide:hide,remove:remove,setLoading:setLoading,updateContent:updateContent,dialogID:dialogID,destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.drawer',function(){var defaults={};var respond=function(elem,options,e){e.preventDefault();if(!$(elem).data('_drawer')){$(elem).data('_drawer',drawerObj(elem,_.defaults(options,defaults)));}
$(elem).data('_drawer').show();};ips.ui.registerWidget('drawer',ips.ui.drawer,['drawerElem'],{lazyLoad:true,lazyEvents:'click'});return{respond:respond};});var drawerObj=function(elem,options){var modal,drawerElem,drawerContent;var init=function(){modal=ips.ui.getModal().addClass('ipsDrawer_modal');drawerElem=$(options.drawerElem),drawerContent=drawerElem.find('.ipsDrawer_menu');drawerElem.on('click','[data-action="close"]',function(){hide();});drawerElem.on('click',function(e){if(!$.contains(drawerContent.get(0),e.target)){hide();}});drawerElem.on('click','.ipsDrawer_itemParent > h4',_showSubMenu).on('click','[data-action="back"]',_subMenuBack).find('.ipsDrawer_itemParent > ul').addClass('ipsDrawer_subMenu').hide();},_showSubMenu=function(e){e.preventDefault();var item=$(e.currentTarget);item.parents('.ipsDrawer_list').animate(($('html').attr('dir')==='rtl')?{marginRight:'-100%'}:{marginLeft:'-100%'}).end().siblings('.ipsDrawer_list').show();},_subMenuBack=function(e){e.preventDefault();var item=$(e.currentTarget),thisMenu=item.parent('.ipsDrawer_list');thisMenu.parents('.ipsDrawer_list').first().animate(($('html').attr('dir')==='rtl')?{marginRight:'0'}:{marginLeft:'0'},function(){thisMenu.hide();});},show=function(){window.scrollTo(0,-1);modal.css({zIndex:ips.ui.zIndex()});ips.utils.anim.go('fadeIn fast',modal);drawerElem.css({zIndex:ips.ui.zIndex()}).show();if($('html').attr('dir')==='rtl'){ips.utils.anim.go('slideRight fast',drawerElem);}else{ips.utils.anim.go('slideLeft fast',drawerElem);}
$('body').css({overflow:'hidden'});},hide=function(){ips.utils.anim.go('fadeOut fast',modal);drawerElem.hide();$('body').css({overflow:'auto'});};init();return{init:init,show:show,hide:hide};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.editor',function(){var defaults={allbuttons:false,postKey:'',toolbars:'',emoticons:'',extraPlugins:'',contentsCss:'',minimized:false,autoSaveKey:null,skin:'ips',autoGrow:true};var respond=function(elem,options){var loadTries=0;var bootEditor=function(){if((!CKEDITOR||_.isUndefined(CKEDITOR.on))&&loadTries<30){loadTries++;setTimeout(bootEditor,50);return;}
var init=function(){if(!$(elem).data('_editor')){var newElem=editorObj(elem,_.defaults(options,defaults));$(elem).data('_editor',newElem);newElem.init();}};if(CKEDITOR.status=='loaded'){init();}else{CKEDITOR.on('loaded',function(){init();});}};if(ips.getSetting('useCompiledFiles')!==true){ips.loader.get(['core/dev/ckeditor/ckeditor.js']).then(bootEditor);}else{ips.loader.get(['core/interface/ckeditor/ckeditor/ckeditor.js']).then(bootEditor);}},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},getObj=function(elem){if($(elem).data('_editor')){return $(elem).data('_editor');}
return undefined;};ips.ui.registerWidget('editor',ips.ui.editor,['allbuttons','postKey','toolbars','extraPlugins','autoGrow','contentsCss','minimized','autoSaveKey','skin','name','emoticons']);return{respond:respond,getObj:getObj,destruct:destruct};});var editorObj=function(elem,options){var id=$(elem).identify().attr('id'),progressTracked={},editor,editorName,config={},showing=false,showAfterInit=false;var init=function(){$(elem).find('textarea').removeClass('ipsHide');editorName=$(elem).find('textarea').attr('name');var language=$('html').attr('lang').toLowerCase();if(!CKEDITOR.lang.languages[language]){var language=language.substr(0,2);if(!CKEDITOR.lang.languages[language]){language=null;}}
config={allowedContent:true,contentsCss:[CKEDITOR.basePath+'contents.css?v='+ipsSettings.antiCache,CKEDITOR.basePath+'skins/'+options.skin+'/contents.css?v='+ipsSettings.antiCache],contentsLangDirection:$('html').attr('dir'),disableObjectResizing:true,extraPlugins:'ipsattach,ipsemoticon,ipslink,ipsimage,ipsmentions,ipsquote,ipsspoiler,ipsautolink,ipsprefs,ipspage,removeformat,pastetext,pbckcode,magicline',ipsPostKey:options.postKey,ipsEmoticons:$.parseJSON(options.emoticons),language:language,linkShowAdvancedTab:false,linkShowTargetTab:false,on:{instanceReady:function(){if(!options.allbuttons){var bottom=$('<div class="cke_bottom" />');bottom.appendTo($('[id="cke_'+this.name+'"]').children('.cke_inner'));$('[id="cke_'+this.name+'"]').find('.cke_toolbox').children().each(function(){if($(this).children('.cke_voice_label').html()=='bottom_row'){$(this).appendTo(bottom);}});}
try{if(options.minimized){$(CKEDITOR.instances[editorName].container.$).hide();$(elem).removeAttr('data-loading');}else{showing=true;}}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
if(showAfterInit){try{$(CKEDITOR.instances[editorName].container.$).show();_iPhoneFix();CKEDITOR.instances[editorName].focus();$(elem).removeAttr('data-loading');showAfterInit=false;}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}}
var i;var self=this;elem.find('iframe').contents().on('dragenter',function(e){$(this).find('body').addClass('ipsDragging');}).on('dragleave drop',function(e){$(this).find('body').removeClass('ipsDragging');}).on('dragover',function(e){e.preventDefault();}).on('drop',function(e){e.preventDefault();}).on('click',function(e){elem.trigger('click');});},key:function(e){if(e.data.keyCode===13&&this.getSelection().getStartElement().getParent().getName()=='div'&&this.getSelection().getRanges()[0].checkBoundaryOfElement(this.getSelection().getStartElement().getParent(),CKEDITOR.END)===true&&this.getSelection().getStartElement().getPrevious()!==null&&this.getSelection().getStartElement().getPrevious().getName()=='p'&&!this.getSelection().getStartElement().getPrevious().getText().trim())
{var para=this.document.createElement('p');para.setHtml('&nbsp;');para.insertAfter(this.getSelection().getStartElement().getParent());this.getSelection().selectElement(para);}}},disableNativeSpellChecker:false,pbckcode:{cls:'ipsCode prettyprint',modes:[['HTML','html'],['CSS','css'],['PHP','php'],['JS','javascript']],theme:'textmate',tab_size:'4',js:"//cdn.jsdelivr.net//ace/1.1.4/noconflict///"},removeButtons:'',removePlugins:'',skin:options.skin};$(elem).trigger('editorCompatibility',{compatible:CKEDITOR.env.isCompatible});var device=ips.utils.responsive.getCurrentKey();if(options.autoGrow){config.extraPlugins+=',autogrow';config.autoGrow_onStartup=true;if(device==='desktop'){config.autoGrow_maxHeight=$(window).height()-200;}}
if(options.extraPlugins!==true){config.extraPlugins+=','+options.extraPlugins;}
if(!options.allbuttons){var toolbars=$.parseJSON(options.toolbars);config.toolbar=toolbars[device];}else{config.removePlugins='sourcearea';}
if(options.minimized){$(elem).find('textarea').hide().end().find('.ipsComposeArea_dummy').show();$(elem).find('[data-ipsEditor-toolList]').hide().closest('.ipsComposeArea').find('[data-ipsEditor-toolList]').hide();}
initializeEditor();_initEvents();},destruct=function(){if(CKEDITOR.instances[editorName]){CKEDITOR.instances[editorName].destroy();}
$(document).off('panelUploadProgress',_progressCounter);$(document).off('insertEmoticon',_insertEmoticon);$(document).off('insertQuote',_insertQuote);$(document).off('insertText',_insertText);$(document).off('resetEditor',_resetEditor);$(document).off('fileDeleted',_deleteFile);$(document).off('initializeEditor',_initializeEditor);},showEditor=function(){$(elem).find('.ipsComposeArea_dummy').hide().off('focus click');$(elem).find('[data-ipsEditor-toolList]').show().closest('.ipsComposeArea').find('[data-ipsEditor-toolList]').show();var minimizedUploader=$(elem).find('[data-ipsEditor-toolListMinimized]');if(minimizedUploader.length){ips.getAjax()(elem.parentsUntil('','form').attr('action'),{'data':{'getUploader':minimizedUploader.attr('data-name')}}).done(function(response){minimizedUploader.replaceWith(response);$(document).trigger('contentChange',[elem]);});}
try{if(_.isUndefined(CKEDITOR.instances[editorName].container)){showAfterInit=true;}else{$(CKEDITOR.instances[editorName].container.$).show();_iPhoneFix();CKEDITOR.instances[editorName].focus();showing=true;}}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
_scrollToEditor();},initializeEditor=function(newConfig){if(options.minimized){$(elem).attr('data-loading',true);}
try{CKEDITOR.timestamp=ipsSettings.antiCache;editor=CKEDITOR.replace(editorName,_.extend(config,newConfig||{}));CKEDITOR.instances[editorName].on('instanceReady',function(){elem.trigger('editorWidgetInitialized',{id:options.name});});}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
if(ips.utils.db.enabled&&options.autoSaveKey){var autoSaveValue=ips.utils.db.get('editorSave',options.autoSaveKey);if(!editor.getData()&&autoSaveValue){editor.setData(autoSaveValue);}
var autoSaveInterval=setInterval(function(){ips.utils.db.set('editorSave',options.autoSaveKey,editor.getData());},2000);elem.closest('form').on('submit',function(e){if(editor.getSelection()&&editor.getSelection().getRanges()&&editor.getSelection().getRanges()[0]){editor.plugins.ipsautolink.replaceLinks(editor,editor.getSelection().getRanges()[0].getCommonAncestor().getParent().$,false);}
window.clearInterval(autoSaveInterval);ips.utils.db.remove('editorSave',options.autoSaveKey);});}
if(ips.utils.db.enabled&&ips.utils.db.get('editorPrefs','papt')){editor.config.forcePasteAsPlainText=true;}};var _initEvents=function(){$(document).on('panelUploadProgress',_progressCounter);$(document).on('insertEmoticon',_insertEmoticon);$(document).on('insertQuote',_insertQuote);$(document).on('insertText',_insertText);$(document).on('resetEditor',_resetEditor);$(document).on('fileDeleted',_deleteFile);Debug.log('init editor');if(options.minimized){$(elem).find('.ipsComposeArea_dummy').on('focus click',_focusDummy);$(document).on('initializeEditor',_initializeEditor);}},_resetEditor=function(e,data){if(!_belongsToThisEditor(data)){return;}
try{CKEDITOR.instances[data.editorID].setData('<p></p>');CKEDITOR.instances[data.editorID].execCommand('ipsImageReset');}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
$('body').find('[data-mentionMenu]').remove();$(elem).find('textarea').val('');elem.find('.cke_button__ipsimage .ipsNotificationCount').text(0).hide();elem.find('.cke_button__ipsattach .ipsNotificationCount').text(0).hide();elem.find('[data-role="progress"]').text(0);elem.find('.ipsAttachment_progress span').css({width:0+'%'});elem.find('#elEditor_'+data.editorID+'_uploadProgress');elem.find('[data-ipsUploader]').trigger('resetUploader');},_scrollToEditor=function(){var elemPosition=ips.utils.position.getElemPosition(elem);var windowScroll=$(window).scrollTop();var viewHeight=$(window).height();if(elemPosition.absPos.top<windowScroll||elemPosition.absPos.top>(windowScroll+viewHeight)){$('html, body').animate({scrollTop:elemPosition.absPos.top+'px'});}},_focusDummy=function(){setTimeout(function(){showEditor();},200);},_initializeEditor=function(e,data){if(!_belongsToThisEditor(data)){return;}
if(showing){_scrollToEditor();}else{showEditor();}},_insertQuote=function(e,data){if(!_belongsToThisEditor(data)){Debug.log(data);return;}
var doInsert=function(data){if(!_.isUndefined(data.quotes)){_.each(data.quotes,function(value){_doInsertQuote(value);});}else{_doInsertQuote(data);}};if(!showing){showEditor();}
doInsert(data);},_insertText=function(e,data){if(!_belongsToThisEditor(data)){return;}
var doInsert=function(){try{var editor=CKEDITOR.instances[data.editorID];editor.insertHtml(data.content);editor.focus();}catch(err){Debug.error("CKEditor instance could not be fetched");return;}};if(!showing){showEditor();}
doInsert();},_doInsertQuote=function(data){try{var editor=CKEDITOR.instances[editorName];}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
var citation='';if(data.username){if(data.timestamp){citation+=ips.utils.time.readable(data.timestamp)+', ';}
citation+=ips.getString('editorQuoteLine',{username:data.username});}else{citation+=ips.getString('editorQuote');}
var container=editor.document.createElement('div');var quote=editor.document.createElement('blockquote');quote.addClass('ipsQuote');quote.setAttributes({'data-cite':citation,'data-ipsQuote':'','data-ipsQuote-timestamp':data.timestamp,'data-ipsQuote-userid':data.userid,'data-ipsQuote-username':data.username,'data-ipsQuote-contapp':data.contentapp,'data-ipsQuote-contenttype':data.contenttype,'data-ipsQuote-contentclass':data.contentclass,'data-ipsQuote-contentid':data.contentid,'data-ipsQuote-contentcommentid':data.contentcommentid}).appendHtml(data.quoteHtml);container.append(quote);var appendText='<p>&#8203;</p>';if(/(iPad|iPhone|iPod|droid)/gi.test(window.navigator.userAgent))
{appendText='<p>&nbsp;</p>';}
editor.insertHtml('<div>'+container.getHtml()+'</div>'+appendText);_scrollToEditor();},_insertEmoticon=function(e,data){try{if(_belongsToThisEditor(data)){CKEDITOR.instances[editorName].insertHtml('<img src="'+data.src+'" title="'+data.text+'" alt="'+data.text+'">');CKEDITOR.instances[editorName].focus();}}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}},_deleteFile=function(e,data){try{var editor=CKEDITOR.instances[editorName];}catch(err){Debug.error("CKEditor instance couldn't be fetched");return;}
var links=editor.document.getElementsByTag('a');for(var i=0;i<links.count();++i){var link=links.getItem(i);if(link.$.getAttribute('data-fileid')==data.fileElem.attr('data-fileid')||link.$.getAttribute('href')==ips.getSetting('baseURL')+'applications/core/interface/file/attachment.php?id='+data.fileElem.attr('data-fileid')){link.remove();}}
var images=editor.document.getElementsByTag('img');for(var i=0;i<images.count();++i){var image=images.getItem(i);if(image.$.getAttribute('data-fileid')==data.fileElem.attr('data-fileid')){image.remove();}}},_belongsToThisEditor=function(data){if(_.isUndefined(data.editorID)||data.editorID!==options.name){return false;}
return true;},_progressCounter=function(e,data){if(!_belongsToThisEditor(data)){return;}
progressTracked[data.contentType]=data.percent;var sumPercent=0,totalPercent=0,timeout;for(var key in progressTracked){sumPercent+=progressTracked[key];}
totalPercent=Math.floor((sumPercent/(_.size(progressTracked)*100))*100);elem.find('[data-role="progress"]').text(totalPercent);elem.find('.ipsAttachment_progress span').animate({width:totalPercent+'%'},'fast');if(!elem.find('#elEditor_'+editorName+'_uploadProgress').is(':visible')){ips.utils.anim.go('fadeIn',elem.find('#elEditor_'+editorName+'_uploadProgress'));}
if(totalPercent===100&&!timeout){timeout=setTimeout(function(){ips.utils.anim.go('fadeOut',elem.find('#elEditor_'+editorName+'_uploadProgress'));timeout=null;},400);}},_iPhoneFix=function(){var iframe=elem.find('iframe');if(/(iPad|iPhone|iPod)/g.test(window.navigator.userAgent)){if(iframe.width()===0){iframe.css({width:'auto'});}}};return{init:init,initializeEditor:initializeEditor,destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.filterBar',function(){var defaults={on:'phone,tablet',viewDefault:'filterContent'};var respond=function(elem,options){if(!$(elem).data('_filterBar')){$(elem).data('_filterBar',filterBarObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_filterBar')){return $(elem).data('_filterBar');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};ips.ui.registerWidget('filterBar',ips.ui.filterBar,['on','default']);return{respond:respond,destruct:destruct,getObj:getObj};});var filterBarObj=function(elem,options){var filterBar=null;var filterContent=null;var workOn=[];var currentBreak;var currentlyShowing=null;var init=function(){if(!ips.utils.responsive.enabled()){return;}
filterBar=elem.find('[data-role="filterBar"]');filterContent=elem.find('[data-role="filterContent"]');workOn=options.on.split(',');currentBreak=ips.utils.responsive.getCurrentKey();$(document).on('breakpointChange',_breakpointChange);elem.on('switchTo.filterBar',function(e,data){if(_.indexOf(workOn,ips.utils.responsive.getCurrentKey())===-1){return;}
_switchView(data.switchTo);}).on('click','[data-action="filterBarSwitch"]',_switchToggle);if(_.indexOf(workOn,currentBreak)!==-1){_setUpBar();}},destruct=function(){$(document).off('breakpointChange',_breakpointChange);},_setUpBar=function(){if(options.viewDefault=='filterBar'){filterContent.addClass('ipsHide');currentlyShowing='filterBar';}else{filterBar.addClass('ipsHide');currentlyShowing='filterContent';}},_switchToggle=function(e){e.preventDefault();if(_.indexOf(workOn,ips.utils.responsive.getCurrentKey())===-1){return;}
_switchView($(e.currentTarget).attr('data-switchTo')=='filterBar'?'filterBar':'filterContent');},_switchView=function(switchTo){if(switchTo==currentlyShowing){return;}
elem.css({height:(currentlyShowing=='filterBar')?filterBar.outerHeight():filterContent.outerHeight()+'px'});filterBar.addClass('ipsFilter_layout');filterContent.addClass('ipsFilter_layout');var done=function(){filterBar.removeClass('ipsFilter_layout');filterContent.removeClass('ipsFilter_layout');elem.css({height:'auto'});currentlyShowing=switchTo;};if(switchTo=='filterBar'){filterBar.css({left:'-100%'}).removeClass('ipsHide').animate({left:'0%'},{duration:300});filterContent.css({left:'0%'}).animate({left:'100%'},{duration:300,complete:function(){$(this).addClass('ipsHide')
done();}});}else{filterBar.css({left:'0%'}).animate({left:'-100%'},{duration:300,complete:function(){$(this).addClass('ipsHide')
done();}});filterContent.css({left:'100%'}).removeClass('ipsHide').animate({left:'0%'},{duration:300});}},_cancel=function(){elem.find('[data-role="filterBar"], [data-role="filterContent"]').removeClass('ipsFilter_layout').css({left:'auto'}).removeClass('ipsHide');elem.css({height:'auto'});currentlyShowing=null;},_breakpointChange=function(e,data){currentBreak=data.curBreakName;if(_.indexOf(workOn,currentBreak)!==-1){_switchView(options.viewDefault);}else{_cancel();}};init();return{init:init,destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.flashMsg',function(){var _queue=[],_doneInit=false,_box,_content,_isShowing=false,_extraClasses=[];var defaults={timeout:2,extraClasses:'ipsPad',location:'top',sticky:false};var respond=function(elem,options){if(options.text){if(options.extraClasses){_extraClasses.push(options.extraClasses);}
show(options.text,options);}},init=function(){$(document).ready(function(){if($('body').attr('data-message')){show($('body').attr('data-message'));}
if(ips.utils.url.getParam('flmsg')){show(ips.utils.url.getParam('flmsg'));}
if(ips.utils.cookie.get('flmsg')){show(ips.utils.cookie.get('flmsg'));ips.utils.cookie.unset('flmsg');}});$(document).on('closeFlashMsg.flashMsg',hide);},show=function(message,options,update){if(!_doneInit){_initElement();}
options=_.defaults(options||{},defaults);if(_isShowing&&!update){_queue.push([message,options]);return;}
if(update&&_isShowing){_box.html(message);ips.utils.anim.go('pulseOnce',_box);if(!options.sticky){setTimeout(hide,options.timeout*1000);}
return;}
_isShowing=true;_box.css({zIndex:ips.ui.zIndex()}).html(message).removeClass(_extraClasses.join(' ')).addClass(options.extraClasses).removeClass('ipsFlashMsg_bottom ipsFlashMsg_top').addClass(options.position=='bottom'?'ipsFlashMsg_bottom':'ipsFlashMsg_top').on('click','a',function(){hide();}).animationComplete(function(){if(!options.sticky){setTimeout(hide,options.timeout*1000);}});ips.utils.anim.go('fadeInDown',_box);},hide=function(){if(_queue.length){var next=_queue.shift();show(next[0],next[1],true);}else{_box.animationComplete(function(){_isShowing=false;_box.hide();if(_queue.length){var next=_queue.shift();show(next[0],next[1]);}});ips.utils.anim.go('fadeOutDown',_box);}},_initElement=function(){$('body').append(ips.templates.render("core.general.flashMsg"));_box=$('#elFlashMessage').hide();_content=(_box.is('[data-role="flashMessage"]'))?_box:_box.find('[data-role="flashMessage"]');_doneInit=true;};ips.ui.registerWidget('flashMsg',ips.ui.flashMsg,['text','extraClasses','timeout','location']);init();return{respond:respond,show:show};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.form',function(){var _cmInstances={};var _support={};var formTypes={'number':'input[type="number"], input[type="range"], [data-control~="number"]','unlimited':'[data-control~="unlimited"]','selectDisable':'[data-control~="selectDisable"]','date':'input[type="date"], [data-control~="date"]','range':'input[type="range"], [data-control~="range"]','color':'input[type="color"], [data-control~="color"]','dimensions':'[data-control~="dimensions"]','dimensionsUnlimited':'[data-control~="dimensionsUnlimited"]','jsDisable':'input[data-control~="jsdisable"]','toggle':'[data-control~="toggle"]','codemirror':'[data-control~="codemirror"]'};var init=function(){$(document).on('contentChange',function(e,data){if($(data[0]).closest('[data-ipsForm]').length){respond($(data[0]));}});$(document).on('codeMirrorInsert',function(e,data){if(!_.isUndefined(_cmInstances[data.elemID])){_cmInstances[data.elemID].replaceRange(data.tag,_cmInstances[data.elemID].getCursor("end"));}});},respond=function(elem,options){var runControlMethod=function(i){_controlMethods[type]($(this),elem)||$.noop;};for(var type in formTypes){$(elem).find(formTypes[type]).each(runControlMethod);}
$(elem).find('select[data-sort]').each(function(){var value=$(this).val();$(this).children('optgroup').each(function(){$(this).append($(this).children('option').remove().sort(localeSort));});$(this).append($(this).children('optgroup').remove().sort(localeSort));$(this).append($(this).children('option').remove().sort(localeSort));$(this).val(value);});};var localeSort=function(a,b){if($(a).prop("tagName")=='OPTGROUP'){var aValue=$(a).attr('label');}else{if(!a.value){return-1;}
var aValue=a.innerHTML;}
if($(b).prop("tagName")=='OPTGROUP'){var bValue=$(b).attr('label');}else{if(!b.value){return 1;}
var bValue=b.innerHTML;}
try{return aValue.localeCompare(bValue);}catch(err){return(aValue>bValue)?1:-1;}};var _controlMethods={codemirror:function(elem){ips.loader.get(['core/interface/codemirror/codemirror.js']).then(function(){var elemId=$(elem).attr('id');if(!_.isUndefined(_cmInstances[elemId])){$(_cmInstances[elemId].getWrapperElement()).remove();delete _cmInstances[elemId];}
_cmInstances[elemId]=CodeMirror.fromTextArea(document.getElementById(elemId),{mode:$(elem).attr('data-mode'),lineWrapping:true,lineNumbers:false});$('#'+elemId).data('CodeMirrorInstance',_cmInstances[elemId]);$('[data-codemirrorcustomtag]').on('click',function(e){_cmInstances[elemId].replaceRange($(e.currentTarget).attr('data-codemirrorcustomtag'),_cmInstances[elemId].getCursor("end"));});});},number:function(elem){elem.on('blur',function(){_numberValidation(elem);});},range:function(elem){if(_.isUndefined(_support['range'])){var i=document.createElement("input");i.setAttribute("type","range");_support['range']=!(i.type==='text');}
if(!_support['range']){elem.siblings('[data-role="rangeBoundary"]').hide();}else{var valueElem=$('#'+elem.attr('name')+'_rangeValue');valueElem.text(elem.val());elem.on('change',function(){valueElem.text(elem.val());});}},unlimited:function(elem){elem.on('change',function(){_unlimitedCheck(elem);});_unlimitedCheck(elem);},selectDisable:function(elem){elem.on('change',function(){_selectDisable(elem);});_selectDisable(elem);},date:function(elem){if(_.isUndefined(_support['date'])){var i=document.createElement("input");i.setAttribute("type","date");_support['date']=!(i.type==='text');}
if(!_support['date']){if($(elem).attr('data-preferredFormat'))
{$(elem).val($(elem).attr('data-preferredFormat'));}
ips.loader.get(['core/interface/jquery/jquery-ui.js']).then(function(){var _buildDatepicker=function(){$.datepicker.regional['xx']={closeText:ips.getString('date_picker_done'),prevText:ips.getString('date_picker_prev'),nextText:ips.getString('date_picker_next'),currentText:ips.getString('date_picker_next'),monthNames:[ips.getString('month_0'),ips.getString('month_1'),ips.getString('month_2'),ips.getString('month_3'),ips.getString('month_4'),ips.getString('month_5'),ips.getString('month_6'),ips.getString('month_7'),ips.getString('month_8'),ips.getString('month_9'),ips.getString('month_10'),ips.getString('month_11')],monthNamesShort:[ips.getString('month_0'),ips.getString('month_1'),ips.getString('month_2'),ips.getString('month_3'),ips.getString('month_4'),ips.getString('month_5'),ips.getString('month_6'),ips.getString('month_7'),ips.getString('month_8'),ips.getString('month_9'),ips.getString('month_10'),ips.getString('month_11')],dayNames:[ips.getString('day_0'),ips.getString('day_1'),ips.getString('day_2'),ips.getString('day_3'),ips.getString('day_4'),ips.getString('day_5'),ips.getString('day_6')],dayNamesShort:[ips.getString('day_0_short'),ips.getString('day_1_short'),ips.getString('day_2_short'),ips.getString('day_3_short'),ips.getString('day_4_short'),ips.getString('day_5_short'),ips.getString('day_6_short')],dayNamesMin:[ips.getString('day_0_short'),ips.getString('day_1_short'),ips.getString('day_2_short'),ips.getString('day_3_short'),ips.getString('day_4_short'),ips.getString('day_5_short'),ips.getString('day_6_short')],weekHeader:ips.getString('date_picker_week'),dateFormat:ips.getSetting('date_format'),firstDay:ips.getSetting('date_first_day'),isRTL:$('html').attr('dir')=='rtl',showMonthAfterYear:false,yearSuffix:"",shortYearCutoff:10};$.datepicker.setDefaults($.datepicker.regional['xx']);elem.datepicker({changeMonth:true,changeYear:true,yearRange:"-120:+10",dateFormat:ips.getSetting('date_format'),firstDay:ips.getSetting('date_first_day'),});elem.datepicker('show');};elem.on('focus',function(){_buildDatepicker();});});}},color:function(elem){elem.addClass('color');ips.loader.get(['core/interface/jscolor/jscolor.js']).then(function(){jscolor.dir=ips.getSetting('baseURL')+'applications/core/interface/jscolor/';new jscolor.color(elem.get(0),{});});},toggle:function(elem,form){var togglesOn=(elem.attr('data-togglesOn')||elem.attr('data-toggles')||'').split(',');var togglesOff=(elem.attr('data-togglesOff')||'').split(',');if(togglesOn.length){_toggler(elem,form,togglesOn,true);}
if(togglesOff.length){_toggler(elem,form,togglesOff,false);}},dimensions:function(elem){var container=elem.closest('.ipsWidthHeight_container');elem.resizable({resize:function(event,ui){container.find('input.ipsWidthHeight_width').val(elem.width());container.find('input.ipsWidthHeight_height').val(elem.height());}});container.find('input.ipsWidthHeight_width').on('change',function(){elem.width($(this).val());});container.find('input.ipsWidthHeight_height').on('change',function(){elem.height($(this).val());});},dimensionsUnlimited:function(elem){elem.on('change',function(){_dimensionsUnlimitedCheck(elem);});_dimensionsUnlimitedCheck(elem);},jsDisable:function(elem){elem.prop('disabled',true);}},_toggler=function(elem,form,toggleList,toggleOn){var toCall;var triggerElem;var eventType='change';var selectorList=ips.utils.getIDsFromList(toggleList);if(!selectorList){return;}
if(elem.is('option')){toCall=_toggleSelect;triggerElem=elem.closest('select');}else if(elem.is('input[type="checkbox"]')){toCall=_toggleCheckbox;triggerElem=elem;}else if(elem.is('input[type="radio"]')){toCall=_toggleRadio;triggerElem=form.find('input[name="'+elem.attr('name')+'"]');}else if(elem.is('.ipsSelectTree_item')){toCall=_toggleNode;triggerElem=elem;eventType='nodeSelectedChanged';}else{toCall=_toggleGeneric;triggerElem=elem;}
var reverse=!toggleOn;triggerElem.on(eventType,function(){toCall.call(this,triggerElem,selectorList,elem,form,reverse);});if(triggerElem.is(':visible')||(triggerElem.attr('data-toggle-visibleCheck')&&$(triggerElem.attr('data-toggle-visibleCheck')).is(':visible'))){toCall.call(this,triggerElem,selectorList,elem,form,reverse);}},_dimensionsUnlimitedCheck=function(elem){var container=elem.closest('.ipsWidthHeight_container');if(elem.is(':checked')){container.find('[data-control="dimensions"]').hide().end().find('input.ipsWidthHeight_width, input.ipsWidthHeight_height').val('').prop('disabled',true);}else{container.find('[data-control="dimensions"]').show().end().find('input.ipsWidthHeight_width, input.ipsWidthHeight_height').change().prop('disabled',false);}},_toggleRadio=function(radioList,toggleList,thisElem,form){radioList.each(function(){var thisToggles=ips.utils.getIDsFromList($(this).attr('data-toggles'));if(thisToggles){_hideFormRows(thisToggles,form);}});radioList.each(function(){if($(this).is(':checked')){var thisToggles=ips.utils.getIDsFromList($(this).attr('data-toggles'));if(thisToggles){_showFormRows(thisToggles,form);}}});},_toggleSelect=function(selectElem,toggleList,thisElem,form){selectElem.find('option').each(function(idx,elem){if($(this).attr('data-toggles')){_hideFormRows(ips.utils.getIDsFromList($(this).attr('data-toggles')),form);}});selectElem.find('option:selected').each(function(i,elem){if($(elem).attr('data-toggles')){_showFormRows(ips.utils.getIDsFromList($(this).attr('data-toggles')),form);}});},_toggleCheckbox=function(elem,toggleList,thisElem,form,reverse){var show=elem.is(':checked');if(reverse){show=!show;}
if(show){_showFormRows(toggleList,form);}else{_hideFormRows(toggleList,form);}},_toggleNode=function(elem,toggleList,thisElem,form){var selectedItems=elem.closest('[data-ipsSelectTree]').find('[data-role="nodeValue"]').val().split(',');var show=(selectedItems!=elem.data('id')&&selectedItems.indexOf(elem.data('id'))==-1)?false:true;if(show){_showFormRows(toggleList,form);}else{_hideFormRows(toggleList,form);}},_toggleGeneric=function(elem,toggleList,thisElem,form){var show=elem.val()==0?false:true;if(!_.isUndefined(elem.attr('data-togglereverse'))){show=!show;}
if(show){_showFormRows(toggleList,form);}else{_hideFormRows(toggleList,form);}},_hideFormRows=function(hide,form){if(_.isArray(hide)){hide=hide.join(',');}
$(form||document).find(hide).hide().addClass('ipsHide').find('[data-toggles],[data-togglesOn],[data-togglesOff]').each(function(i,elem){_hideFormRows(ips.utils.getIDsFromList($(elem).attr('data-toggles')),form);_hideFormRows(ips.utils.getIDsFromList($(elem).attr('data-togglesOn')),form);_hideFormRows(ips.utils.getIDsFromList($(elem).attr('data-togglesOff')),form);});},_showFormRows=function(show,form){if(_.isArray(show)){show=show.join(',');}
$(form||document).find(show).not('[data-ipsToggle]').show().end().removeClass('ipsHide').find('[data-toggles],[data-togglesOn]').each(function(i,elem){_controlMethods.toggle($(elem),form);});},_selectDisable=function(elem){var option=elem.find('[data-disable]');if(!option.length){return;}
var disable=option.attr('data-disable');if(!option.is(':selected')){$(disable).prop('disabled',false);}else{$(disable).prop('disabled',true);}},_unlimitedCheck=function(checkbox){if(!checkbox.is(':disabled')){if(checkbox.is(':checked')){checkbox.closest('.ipsFieldRow_content,[data-role="unlimitedCatch"]').find('input:not([type="checkbox"]),select,textarea').each(function(){var thisInput=$(this);thisInput.attr('data-previousvalue',thisInput.val());thisInput.val('');thisInput.prop('disabled',true);}).find('[data-role="rangeBoundary"]').css({opacity:0.5});}else{checkbox.closest('.ipsFieldRow_content,[data-role="unlimitedCatch"]').find('input:not([type="checkbox"]),select,textarea').each(function(){var thisInput=$(this);thisInput.prop('disabled',false);if(thisInput.attr('data-previousvalue')){thisInput.val(thisInput.attr('data-previousvalue'));}}).find('[data-role="rangeBoundary"]').css({opacity:1});}}
var toggles=checkbox.closest('.ipsFieldRow_content').find('[data-control="toggle"]');var form=checkbox.closest('[data-ipsForm]');if(toggles.length){toggles.each(function(){_controlMethods.toggle($(this),form);});}},_numberValidation=function(elem){var val=$.trim(elem.val()).toString();var field=elem.parent();var thousandsSep=$.trim(elem.attr('data-thousandsseparator')||'');if(!val){val='0';}
val=val.replace(elem.attr('data-thousandsseparator')||'','');if(val.startsWith(elem.attr('data-decpoint'))){val='0'+val;}
if(!val.match('^[0-9]+([\.'+elem.attr('data-decpoint')+'][0-9]+)?$')){_validationError(field,ips.getString('validation_invalid'));return;}
val=val.replace(/^0+(0\.)?(\d+)$/,'$1$2');if(!_.isUndefined(elem.attr('min'))&&parseFloat(val)<parseFloat(elem.attr('min'))){_validationError(field,ips.getString('validation_min',[elem.attr('min')]));return;}
if(!_.isUndefined(elem.attr('max'))&&parseFloat(val)>parseFloat(elem.attr('max'))){_validationError(field,ips.getString('validation_max',[elem.attr('max')]));return;}
field.closest('.ipsFieldRow').find('.ipsFieldRow_title').removeClass('error').end().find('.ipsType_warning').html('');if(_.isUndefined(elem.attr('data-decimals-any'))){if(!_.isUndefined(elem.attr('data-decimals'))&&elem.attr('data-decimals')>0){val=(Math.round(val*Math.pow(10,elem.attr('data-decimals')))/Math.pow(10,elem.attr('data-decimals'))).toString();if(val.indexOf('.')>0){var decimals=val.substr(val.indexOf('.')+1).length;for(var i=0;i<(elem.attr('data-decimals')-decimals);i++){val+='0';}}}else{val=parseInt(val,10);}}
if(elem.type==='text'){val=val.toString().replace(/^\d+(?=\.|$)/,function(int){return int.replace(/(?=(?:\d{3})+$)(?!^)/g,thousandsSep);});}
elem.val(val);},_validationError=function(field,error){field.closest('.ipsFieldRow').find('.ipsFieldRow_title').addClass('error').end().find('.ipsType_warning').html(error);};ips.ui.registerWidget('form',ips.ui.form);return{respond:respond,init:init};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.grid',function(){var defaults={patchwork:false,items:'[data-role="gridItem"]',equalHeights:false};var respond=function(elem,options){if(!$(elem).data('_grid')){$(elem).data('_grid',gridObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_grid')){return $(elem).data('_grid');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};var gridObj=function(elem,options){var originalSpan=3;var currentSpan=3;var possibleSizes=[1,2,3,4,6,12];var deferInit=false;var init=function(){if(!elem.is(':visible')){deferInit=true;Debug.log('ui.ipsGrid is not visible; deferring init...');}
if(!deferInit){_initWhenVisible();}
$(window).on('resize',redrawGrid);$(document).on('tabShown',_tabShown);$(elem).on('newItem',function(e,data){data=$(data);_removeSpans(data);_addSpan(data,currentSpan);_checkDeferredInit();if(!deferInit){_scaleProportions(data);_equalHeights();}});},destruct=function(){$(window).off('resize',redrawGrid);$(document).off('tabShown',_tabShown);},redrawGrid=function(){_checkDeferredInit();if(!deferInit){if(options.minItemSize||options.maxItemSize){_checkItemWidth(0);}
_scaleProportions(_getAll());_equalHeights();}},_tabShown=function(e,data){if($.contains(data.panel.get(0),elem.get(0))){redrawGrid();}},_initWhenVisible=function(){var firstItem=_getFirst();var allItems=_getAll();if(!options.defaultSpan){for(var i=1;i<=12;i++){if(firstItem.hasClass('ipsGrid_span'+i)){originalSpan=currentSpan=i;break;}}}else{originalSpan=currentSpan=options.defaultSpan;}
_changeSpan(currentSpan,0);_scaleProportions(_getAll());_equalHeights();},_checkDeferredInit=function(){if(deferInit&&elem.is(':visible')){Debug.log('ui.ipsGrid is visible; now running init...');deferInit=false;_initWhenVisible();}},_scaleProportions=function(item){var width=_getFirst().outerWidth();item.addBack().find('[data-grid-ratio]').each(function(){var item=$(this);var newHeight=(width/100)*parseInt(item.attr('data-grid-ratio'));item.css({height:Math.ceil(newHeight)+'px'});});},_equalHeights=function(){if(!options.equalHeights){return;}
var items=_getAll();if(options.equalHeights=='row'){var numPerRow=12/currentSpan;var loops=Math.ceil(items.length/numPerRow);var idx=0;if(elem.hasClass('ipsGrid_collapsePhone')&&ips.utils.responsive.currentIs('phone')){items.css({height:'auto'});return;}
for(var i=0;i<loops;i++){var rowItems=items.slice(idx,idx+numPerRow);idx=idx+numPerRow;var max=_.max(rowItems,function(item){return $(item).outerHeight();});rowItems.css({height:$(max).outerHeight()+'px'});}}else{var max=_.max(items,function(item){return $(item).outerHeight();});items.css({height:$(max).outerHeight()+'px'});}},_checkItemWidth=function(iteration){iteration++;if(iteration>=6){return;}
var firstItem=_getFirst();if(options.minItemSize&&firstItem.outerWidth()<parseInt(options.minItemSize)){_changeSpan(possibleSizes[_.indexOf(possibleSizes,currentSpan)+1]||possibleSizes[1],iteration);}else if(options.maxItemSize&&firstItem.outerWidth()>=parseInt(options.maxItemSize)){_changeSpan(possibleSizes[_.indexOf(possibleSizes,currentSpan)-1]||possibleSizes[possibleSizes.length-1],iteration);}},_getFirst=function(){return elem.find('> [class*="ipsGrid_span"]').first()},_getAll=function(){return elem.find('> [class*="ipsGrid_span"]');},_removeSpans=function(items){for(var i=1;i<=12;i++){items.removeClass('ipsGrid_span'+i);}},_addSpan=function(items,size){items.addClass('ipsGrid_span'+size);},_changeSpan=function(newSize,iteration){if(newSize<=1){return;}
var items=_getAll();_removeSpans(items);_addSpan(items,newSize);currentSpan=newSize;_checkItemWidth(iteration);};init();return{init:init,destruct:destruct};};ips.ui.registerWidget('grid',ips.ui.grid,['minItemSize','maxItemSize','items','equalHeights']);return{respond:respond,getObj:getObj,destruct:destruct};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.hovercard',function(){var defaults={timeout:0.75,showLoading:true,width:450,className:'ipsHovercard',onClick:false,target:null,cache:true};var cache={};var respond=function(elem,options){if(!$(elem).data('_hover')){$(elem).data('_hover',hoverCardObj(elem,_.defaults(options,defaults)));}
if(options.onClick){$(elem).off('.hovercard').on('click.hovercard',function(e){e.preventDefault();$(elem).data('_hover').start();});}else{if(ips.utils.events.isTouchDevice()&&(ips.utils.responsive.currentIs('phone')||ips.utils.responsive.currentIs('tablet'))){return;}
$(elem).data('_hover').start();}},getObj=function(elem){if($(elem).data('_hover')){return $(elem).data('_hover');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},setCache=function(url,content){cache[url]=content;},unCache=function(url){delete cache[url];},getCache=function(url){return cache[url];};ips.ui.registerWidget('hover',ips.ui.hovercard,['timeout','attach','content','width','onClick','target','cache'],{lazyLoad:true,lazyEvents:'mouseover'});return{respond:respond,destruct:destruct,setCache:setCache,getCache:getCache};});var hoverCardObj=function(elem,options){var onTimeout=null,offTimeout=null,ajaxObj,content,target,loading,card,working=false,elemID='';var init=function(){elemID=$(elem).identify().attr('id');},destruct=function(){clearTimeout(offTimeout);$(document).off('click.'+elemID);_removeLoadingWidget();if(card){card.remove();}},start=function(){if(working!==false&&options.onClick){return;}
working=true;target=($(options.attach).length)?$(options.attach):$(elem);clearTimeout(offTimeout);if(!options.onClick){onTimeout=setTimeout(_startShow,(options.timeout*1000));$(elem).on('mouseout.hovercard',_mouseOut);$(elem).on('click',_elemClick);}else{$(document).off('click.'+elemID).on('click.'+elemID,_documentClick);_startShow();}},_elemClick=function(e){if(onTimeout){clearTimeout(onTimeout);}
if(offTimeout){clearTimeout(offTimeout);}
if(ajaxObj&&_.isFunction(ajaxObj.abort)){ajaxObj.abort();}
_removeLoadingWidget();_hideCard();},_documentClick=function(e){if(!$(card).is(':visible')){return;}
if(e.target!=elem&&!$.contains(elem,e.target)&&e.target!=card.get(0)&&!$.contains(card.get(0),e.target)){_hideCard();$(document).off('click.'+elemID);}},_startShow=function(){if(card&&card.length&&_.isElement(card.get(0))){_positionCard();working=false;return;}
if(options.content&&$(options.content).length){_buildLocalContent();_buildCard();_positionCard();working=false;}else{_buildRemoteContent().done(function(){_buildCard();_positionCard(true);}).fail(function(){}).always(function(){working=false;});}},_hideCard=function(){ips.utils.anim.go('fadeOut',card);},_positionCard=function(showImmediate){if(!card.length){Debug.warn("_positionCard called before a card element exists");return;}
if(!target.is(':visible')){Debug.info("Can't show hovercard when target isn't visible");return;}
card.css({left:'auto',top:'auto',position:'static'});if(card.attr('data-originalWidth')){card.css({width:card.attr('data-originalWidth')+'px'});}
var elemPos=ips.utils.position.getElemPosition(target);var tooWide=false;var elemHeight=$(target).height();var elemWidth=$(target).width();var actualWidth=$(card).width();var actualHeight=$(card).height();var win=$(window);var positionInfo={trigger:elem,target:card,above:true,stemOffset:{left:20,top:0}};var location=ips.utils.position.positionElem(positionInfo);card.css({left:location.left+'px',top:location.top+'px',position:(location.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});var newElemPosition=ips.utils.position.getElemPosition(card);if((actualWidth>$(document).width())||newElemPosition.viewportOffset.left<0){options.noStem=true;card.attr('data-originalWidth',actualWidth).css({left:'10px',width:($(document).width()-20)+'px'});var newLocation=ips.utils.position.positionElem(positionInfo);card.css({top:newLocation.top+'px'});}
card.find('.ipsHovercard_stem').remove();_.each(['Top','Bottom','Left','Right'],function(type){card.removeClass('ipsHovercard_stem'+type);});var stem=$('<span/>').addClass('ipsHovercard_stem');card.append(stem).addClass(options.className+'_stem'+(location.location.vertical.charAt(0).toUpperCase()+location.location.vertical.slice(1)));if(tooWide){stem.css({left:(elemPos.viewportOffset.left-10)+'px'});}else{card.addClass(options.className+'_stem'+(location.location.horizontal.charAt(0).toUpperCase()+location.location.horizontal.slice(1)));}
if(showImmediate){card.show();}else{ips.utils.anim.go('fadeIn',card);}},_buildCard=function(){var cardId=$(elem).identify().attr('id')+'_hovercard',actualWidth=options.width||300;card=$('<div/>');card.attr({id:cardId}).addClass(options.className).css({width:actualWidth+'px',zIndex:ips.ui.zIndex()});if(_.isString(content)){card.append($('<div/>').html(content));}else{card.append(content.show());}
ips.getContainer().append(card);if(!options.onClick){card.on('mouseenter',_cardMouseOver).on('mouseleave',_cardMouseOut);}
$(document).trigger('contentChange',[card]);},_buildLocalContent=function(){content=$(options.content);},_buildRemoteContent=function(){var deferred=$.Deferred();if(!elem.href){deferred.reject();return deferred.promise();}
if(options.cache&&ips.ui.hovercard.getCache(elem.href)){content=ips.ui.hovercard.getCache(elem.href);deferred.resolve();return deferred.promise();}
_buildLoadingWidget();if(options.target){var target=options.target;}else{var target=elem.href;}
ajaxObj=ips.getAjax()(target).done(function(response){content=response;deferred.resolve();if(options.cache){ips.ui.hovercard.setCache(target,content);}}).fail(function(jqXHR,status,errorThrown){if(Debug.isEnabled()){if(status!='abort'){Debug.error("Ajax request failed ("+status+"): "+errorThrown);}else{Debug.warn("Ajax request aborted");}
_removeLoadingWidget();deferred.reject();}else{if(status!='abort'){content=$('<div/>').addClass('ipsPad_half ipsType_light').html(ips.getString('errorLoadingContent'));deferred.resolve();}else{deferred.reject();}}}).always(function(){_removeLoadingWidget();});return deferred.promise();},_buildLoadingWidget=function(){if(!options.showLoading){return;}
loading=$('<div/>').addClass('ipsHovercard_loading').html(ips.templates.render('core.hovercard.loading'));ips.getContainer().append(loading);var loadingDims={width:loading.width(),height:loading.height()};loading.hide();var elemPos=ips.utils.position.getElemPosition(target),dimsToUse=(elemPos.fixed)?'fixedPos':'absPos';loading.css({left:elemPos[dimsToUse].left+'px',top:(elemPos[dimsToUse].top-loadingDims.height-10)+'px',position:(elemPos.fixed)?'fixed':'absolute',zIndex:50000});ips.utils.anim.go('fadeIn',loading);},_removeLoadingWidget=function(){if(loading&&loading.length){loading.remove();}},_mouseOut=function(){clearTimeout(onTimeout);if(ajaxObj){ajaxObj.abort();}
_removeLoadingWidget();if(card&&card.is(':visible')){offTimeout=setTimeout(_hideCard,options.timeout*1000);}
$(elem).off('.hovercard',_mouseOut);},_cardMouseOver=function(){clearTimeout(offTimeout);},_cardMouseOut=function(){clearTimeout(offTimeout);offTimeout=setTimeout(_hideCard,options.timeout*1000);};init();return{init:init,destruct:destruct,start:start};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.infiniteScroll',function(){var defaults={distance:50,loadingTpl:'core.infScroll.loading',scrollScope:'body',pageParam:'page',pageBreakTpl:'core.infScroll.pageBreak',totalPages:null};var respond=function(elem,options){if(!$(elem).data('_infinite')){$(elem).data('_infinite',infiniteScrollObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_infinite')){return $(elem).data('_infinite');}
return undefined;};ips.ui.registerWidget('infScroll',ips.ui.infiniteScroll,['container','scrollScope','distance','url','pageParam','loadingTpl','pageBreakTpl']);var infiniteScrollObj=function(elem,options){var state='ready',scrollScope=null,container=null,ajaxObj=null,currentPage=1;var init=function(){container=$(options.container);scrollScope=$(options.scrollScope);scrollScope.on('scroll',_scrollEvent);if(_.isString(options.distance)&&options.distance.indexOf('%')!==-1){var percent=parseInt(options.distance);options.distance=(scrollScope.height()/100)*percent;}
if(options.totalPages==null){options.totalPages=_getTotalPages();}
currentPage=_getStartPage();},_scrollEvent=function(e){if(state=='loading'||state=='done'){return;}
if(currentPage>=_getTotalPages()){return;}
var distanceFromBottom=_getDistance();if(distanceFromBottom<=options.distance){state='loading';_loadMoreResults();}},_loadMoreResults=function(){_showLoadingElem();if(ajaxObj&&ajaxObj.abort){ajaxObj.abort();}
ajaxObj=ips.getAjax()(_getPageURL(currentPage+1)).done(function(response){currentPage++;_insertNewResults(response);state='ready';$(elem).trigger('infScrollPageLoaded',{page:currentPage});}).fail(function(){}).always(function(){_removeLoadingElem();});},_insertNewResults=function(response){var output='';if(options.pageBreakTpl){output+=ips.templates.render(options.pageBreakTpl,{page:currentPage});}
output+=response;container.append(output);$(document).trigger('contentChange',[container]);},_showLoadingElem=function(){container.append(ips.templates.render(options.loadingTpl));},_removeLoadingElem=function(){container.find('[data-role="infScroll_loading"]').remove();},_getDistance=function(){if(options.scrollScope=='body'){var scrollHeight=$(document).height();var distanceFromBottom=scrollHeight-$(window).height()-$(window).scrollTop();}else{var scrollHeight=scrollScope[0].scrollHeight;var distanceFromBottom=scrollHeight-scrollScope.height()-scrollScope.scrollTop();}
return distanceFromBottom;},_getPageURL=function(pageNo){return options.url+'&'+options.pageParam+'='+parseInt(pageNo);},_getStartPage=function(){var paginationElem=elem.find('.ipsPagination').first();if(!paginationElem.length){return 1;}
var activePage=paginationElem.find('.ipsPagination_active').attr('data-page');if(!activePage){return 1;}else{return parseInt(activePage);}},_getTotalPages=function(){Debug.log(elem.find('noscript'));var paginationElem=elem.find('.ipsPagination').first();if(!paginationElem.length){return 1;}
var totalPages=paginationElem.attr('data-pages');if(!totalPages){return 1;}else{return parseInt(totalPages);}};init();return{init:init};};return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.lightbox',function(){var defaults={className:'ipsLightbox'};var currentLightbox;var respond=function(elem,options,e){options=_.defaults(options,defaults);currentLightbox=new lightboxObj(elem,options,e);},destruct=function(elem){if(currentLightbox){currentLightbox.destruct();}};ips.ui.registerWidget('lightbox',ips.ui.lightbox,['group','commentsURL','className','preload'],{lazyLoad:true,lazyEvents:'click'});return{respond:respond,destruct:destruct};});var lightboxObj=function(elem,options,e){if(e){e.preventDefault();}
var imageCollection=[],commentsAjax,modal,pieces,currentImage,phoneBreakpoint=false;var init=function(){elem.blur();_getAllImages();_buildModal();_buildWrapper();_setUpEvents();_show();_loadFirstImage();},destruct=function(){$(window).off('resize',_resize);$(document).off('keydown',_keyPress);modal.off('click',close);},_setUpEvents=function(){pieces.lightbox.on('click','.'+options.className+'_next',nextImage).on('click','.'+options.className+'_prev',prevImage).on('click','.'+options.className+'_close',close).on('click',clickedLightbox);modal.on('click',close);$(window).on('resize',_resize);$(document).on('keydown',_keyPress)},_resize=function(e){if(pieces.lightbox&&pieces.imagePanel){if(pieces.imagePanel.find('.'+options.className+'_image').length){_positionCenter(pieces.imagePanel.find('.'+options.className+'_image:visible'));}}},_keyPress=function(e){switch(e.keyCode){case ips.ui.key.ESCAPE:close(e);break;case ips.ui.key.RIGHT:nextImage(e);break;case ips.ui.key.LEFT:prevImage(e);break;}},_loadFirstImage=function(){var firstImage=function(){for(var i=0;i<imageCollection.length;i++){if(imageCollection[i].elem==elem){return imageCollection[i];}}}();currentImage=firstImage;_showImage(firstImage);},_showImage=function(image){_setLoading(true);pieces.imagePanel.find('.'+options.className+'_image ').hide();if(image.imageElem){pieces.imagePanel.find('.'+options.className+'_image ').hide()
var thisImage=image.imageElem.css({opacity:0}).show();_imageLoaded(thisImage);}else{var thisImage=image.imageElem=$('<img/>').attr('src',image.largeImage).addClass(options.className+'_image').css({opacity:0}).imagesLoaded(function(images){_imageLoaded($(images[0]));});pieces.imagePanel.find('.'+options.className+'_image ').hide().end().append(thisImage);}
pieces.fullSize.attr('href',image.largeImage);if(image.commentsURL){_loadComments(image);}else{_hideCommentsPanel();}
if(image.meta){pieces.metaPanel.show().html(ips.templates.render('core.lightbox.meta',{title:image.largeImage}));}else{pieces.metaPanel.hide();}
$(elem).trigger('lightboxImageShown',{image:image,triggerElem:elem});},_loadComments=function(image){if(commentsAjax){Debug.warn("Aborting comment load");commentsAjax.abort();}
pieces.commentsPanel.html('').show().addClass('ipsLoading');pieces.imagePanel.addClass(options.className+'_withComments');commentsAjax=ips.getAjax()(image.commentsURL).done(function(response){pieces.commentsPanel.html(response).removeClass('ipsLoading');$(document).trigger('contentChange',[pieces.commentsPanel]);$(elem).trigger('lightboxCommentsLoaded',{image:image,triggerElem:elem,commentsArea:pieces.commentsPanel});});},_hideCommentsPanel=function(){pieces.commentsPanel.hide();pieces.imagePanel.removeClass(options.className+'_withComments');},_setLoading=function(status){if(status===true){pieces.imagePanel.addClass('ipsLoading ipsLoading_dark');}else{pieces.imagePanel.removeClass('ipsLoading ipsLoading_dark');}},_imageLoaded=function(image){image.css({opacity:1});_positionCenter(image);_setLoading(false);if(imageCollection.length<2){pieces.next.hide();pieces.prev.hide();}else{var curPos=_.indexOf(imageCollection,currentImage);pieces.next.show();pieces.prev.show();if(curPos==0){pieces.prev.hide();}
if(curPos==(imageCollection.length-1)){pieces.next.hide();}}},_positionCenter=function(image){var imageSize={width:image.width(),height:image.height()},panelSize={width:pieces.imagePanel.width(),height:pieces.imagePanel.height()};Debug.log("Dimensions: "+imageSize.width+" x "+imageSize.height);image.css({left:'50%',marginLeft:'-'+Math.max((imageSize.width/2),0)+'px',top:'50%',marginTop:'-'+Math.max((imageSize.height/2),0)+'px'});},clickedLightbox=function(e){if($(e.target).closest('a').length){return;}
var width=$(document).width();var halfPos=width/2;if(e.pageX>=halfPos&&pieces.next.is(':visible')){pieces.next.click();}else if(e.pageX<halfPos&&pieces.prev.is(':visible')){pieces.prev.click();}else{close();}},nextImage=function(e){e.preventDefault();e.stopPropagation();currentImage=_getNextImage();_showImage(currentImage);},prevImage=function(e){e.preventDefault();e.stopPropagation();currentImage=_getPrevImage();_showImage(currentImage);},_getPrevImage=function(e){var curPos=_.indexOf(imageCollection,currentImage);if(curPos===0){return imageCollection[imageCollection.length-1];}
return imageCollection[curPos-1];},_getNextImage=function(){var curPos=_.indexOf(imageCollection,currentImage);if(curPos==(imageCollection.length-1)){return imageCollection[0];}
return imageCollection[curPos+1];},close=function(e){if(e){e.preventDefault();e.stopPropagation();}
modal.hide();pieces.lightbox.hide();},_show=function(){ips.utils.anim.go('fadeIn fast',modal);ips.utils.anim.go('fadeIn fast',pieces.lightbox);},_buildWrapper=function(){pieces={lightbox:$('<div/>').addClass(options.className).css({zIndex:ips.ui.zIndex()}),imagePanel:$('<div/>').addClass(options.className+'_imagePanel'),commentsPanel:$('<div/>').addClass(options.className+'_commentsPanel').html('').hide(),next:$('<a/>').addClass(options.className+'_next').html("<i class='fa fa-angle-right'></i>"),prev:$('<a/>').addClass(options.className+'_prev').html("<i class='fa fa-angle-left'></i>"),close:$('<a/>').addClass(options.className+'_close').html("&times;"),fullSize:$('<a/>').attr('href','#').attr('target','_blank').addClass(options.className+'_fullSize').addClass('ipsButton ipsButton_verySmall ipsButton_overlaid').html(ips.getString('fullSize')),metaPanel:$('<div/>').addClass(options.className+'_meta').hide()};pieces.lightbox.append(pieces.imagePanel.append(pieces.next).append(pieces.prev)).append(pieces.metaPanel).append(pieces.commentsPanel).append(pieces.close).append(pieces.fullSize);$('body').append(pieces.lightbox);},_getAllImages=function(){if(options.group){var images=$('[data-ipslightbox-group="'+options.group+'"]');}else{var images=$(elem);}
$.each(images,function(i,thisElem){imageCollection.push(_returnImageData(thisElem));});},_returnImageData=function(thisElem){var origImage,largeImage;if(thisElem.tagName!='IMG'){origImage=$(thisElem).find('img').attr('src');}else{origImage=$(thisElem).attr('src');}
if($(thisElem).attr('data-fullURL')){largeImage=$(thisElem).attr('data-fullURL');}else if(thisElem.tagName=='A'&&$(thisElem).attr('href')){largeImage=$(thisElem).attr('href');}
return{elem:thisElem,originalImage:origImage,largeImage:largeImage||origImage,meta:$(thisElem).attr('data-ipsLightbox-meta'),commentsURL:$(thisElem).attr('data-ipsLightbox-commentURL')};},_buildModal=function(){modal=ips.ui.getModal();modal.css({zIndex:ips.ui.zIndex()});};init();return{destruct:destruct};};}(jQuery,_));;
;(function($,_,undefined){ips.createModule('ips.ui.menu',function(){var defaults={className:'ipsMenu',activeClass:'',closeOnClick:true,closeOnBlur:true,selectable:false,withStem:true,stemOffset:25,stopLinks:false,above:false};var stems=['topLeft','topRight','topCenter','bottomLeft','bottomRight','bottomCenter'];if(!defaults.withStem){defaults.stemOffset=0;}
var _menuRegistry={};var respond=function(elem,options,e){e.preventDefault();var elemID=$(elem).identify().attr('id'),options=_.defaults(options,defaults);if($(elem).attr('data-disabled')||$(elem).is(':disabled')){return;}
if(!$(elem).data('_menuBody')){var menu=_getMenu(elem,elemID,options);$(elem).data('_menuBody',menu);}else{var menu=$(elem).data('_menuBody');}
if(!menu.length){Debug.warn("Couldn't find or build a menu for "+elemID);return;}
$(window).on('resize',function(e){if(menu.is(':visible')){menu.hide();_positionMenu(elem,elemID,options,menu);menu.show();}});if(!menu.is(':visible')){_showMenu(elem,elemID,options,menu,e);}else{_hideMenu(elem,elemID,options,menu,false);}},_showMenu=function(elem,elemID,options,menu,e){if(options.closeOnBlur){$(document).on('click.'+elemID,_.partial(_closeOnBlur,elem,menu));}
$(menu).on('closeMenu',_.partial(_hideMenu,elem,elemID,options,menu,false)).on('mouseenter','.ipsMenu_subItems',_.bind(_showSubMenu,this,elem,elemID,options,menu));$(elem).on('closeMenu',_.partial(_hideMenu,elem,elemID,options,menu,false));_positionMenu(elem,elemID,options,menu);menu.show();$(elem).addClass(options.activeClass);$(elem).trigger('menuOpened',{elemID:elemID,originalEvent:e,menu:menu});},_showSubMenu=function(elem,elemID,options,menu,e){var menuItem=$(e.currentTarget).find('> a');var subMenu=menuItem.next('.ipsMenu');$(e.currentTarget).on('mouseleave',_.bind(_hideSubMenu,this,elem,elemID,options,menu));var itemPosition=ips.utils.position.getElemPosition(menuItem);var itemSize=ips.utils.position.getElemDims(menuItem);var subMenuSize=ips.utils.position.getElemDims(subMenu);if($('html').attr('dir')=='rtl'){var right=(itemSize.outerWidth-5);if((itemPosition.viewportOffset.right+itemSize.outerWidth+subMenuSize.outerWidth-5)>$(window).width()){if((itemPosition.viewportOffset.right+5-subMenuSize.outerWidth)>=0){right=((subMenuSize.outerWidth*-1)+5);}}
subMenu.css({right:right+'px',top:(menuItem.position()['top']-5)+'px'}).show();}else{var left=(itemSize.outerWidth-5);if((itemPosition.viewportOffset.left+itemSize.outerWidth+subMenuSize.outerWidth-5)>$(window).width()){if((itemPosition.viewportOffset.left+5-subMenuSize.outerWidth)>=0){left=((subMenuSize.outerWidth*-1)+5);}}
subMenu.css({left:left+'px',top:(menuItem.position()['top']-5)+'px'}).show();}},_hideSubMenu=function(elem,elemID,options,menu,e){var subMenus=$(e.currentTarget).closest('.ipsMenu_item').find('.ipsMenu');subMenus.hide();},_hideMenu=function(elem,elemID,options,menu,immediate){if(options.closeOnBlur){$(document).off('click.'+elemID);}
$(elem).off('closeMenu');$(menu).off('closeMenu');$(elem).removeClass(options.activeClass);if(!immediate){ips.utils.anim.go('fadeOut fast',menu);}else{menu.hide();}
$(elem).trigger('menuClosed',{elemID:elemID});},_positionMenu=function(elem,elemID,options,menu){var positionInfo={trigger:elem,target:menu,center:true,above:options.above,stemOffset:{left:options.stemOffset,top:0}};menu.css({left:'auto',top:'auto',position:'static'});if(menu.attr('data-originalWidth')){menu.css({width:menu.attr('data-originalWidth')+'px'});}
if(options.appendTo){var appendTo=_getAppendContainer(elem,options.appendTo);if(appendTo.length){_.extend(positionInfo,{targetContainer:appendTo});}}
var menuPosition=ips.utils.position.positionElem(positionInfo);var menuDims=ips.utils.position.getElemDims(menu);var triggerPosition=ips.utils.position.getElemPosition($(elem));menu.css({left:menuPosition.left+'px',top:menuPosition.top+'px',position:(menuPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});var newMenuPosition=ips.utils.position.getElemPosition(menu);if((menuDims.width>$(document).width())||newMenuPosition.viewportOffset.left<0){options.noStem=true;menu.attr('data-originalWidth',menuDims.width).css({left:'10px',width:($(document).width()-20)+'px'});}
_removeExistingStems(menu,options);if(!menu.hasClass(options.className+'_noStem')&&!options.noStem){var stemClass='';stemClass+=menuPosition.location.vertical;stemClass+=menuPosition.location.horizontal.charAt(0).toUpperCase();stemClass+=menuPosition.location.horizontal.slice(1);menu.addClass(options.className+'_'+stemClass);}},_removeExistingStems=function(menu,options){var stemClasses=[];$.each(stems,function(idx,value){stemClasses[idx]=options.className+'_'+value;});menu.removeClass(stemClasses.join(' '));},_getMenu=function(elem,elemID,options){if($('#'+options.menuID).length){var menu=$('#'+options.menuID);}else if($('#'+elemID+'_menu').length){var menu=$('#'+elemID+'_menu');}else if(options.menuContent){var menu=buildMenuFromJSON(elem,elemID,options.menuContent);}else{return false;}
if(options.appendTo){var appendTo=_getAppendContainer(elem,options.appendTo);if(appendTo.length){appendTo.append(menu);}}else{ips.getContainer().append(menu);}
$(menu).on('click.'+elemID,_.partial(_menuClicked,elem,elemID,options,menu));$(menu).data('_owner',elem);_menuRegistry[elemID]={elem:elem,options:options,menu:menu};return $(menu);},_closeOnBlur=function(elem,menu,e){var clickedOnTrigger=function(){if($(e.target).is('[data-ipsMenu]')){return e.target;}else if($(e.target).parent('[data-ipsMenu]')){return $(e.target).parent('[data-ipsMenu]').get(0);}}();$.each(_menuRegistry,function(key,value){var clickInMenu=_clickIsChildOfMenu(e.target,value.elem,value.menu.get(0));if(value.elem){if(clickInMenu||value.elem==clickedOnTrigger||$.contains(value.elem,e.target)){return;}}
if(value.menu.is(':visible')){_hideMenu(value.elem,key,value.options,value.menu,!!clickedOnTrigger);}});},_clickIsChildOfMenu=function(clickTarget,triggerElem,menuElem){if(clickTarget==menuElem||$.contains(menuElem,clickTarget)){return true;}
return false;},_menuClicked=function(elem,elemID,options,menu,e){if($(e.target).hasClass(options.className+'_item')){var itemClicked=$(e.target);}else{var itemClicked=$(e.target).parents('.'+options.className+'_item');}
if(options.stopLinks){e.preventDefault();}
if(options.closeOnClick){if(itemClicked.find('[data-action="ipsMenu_ping"]').length){e.preventDefault();itemClicked.find('[data-action="ipsMenu_ping"]').each(function(){ips.getAjax()($(this).attr('href')).done(function(){$(elem).trigger('menuPingSuccessful',{});});});}
var addItemClicked=function(){itemClicked.addClass(options.className+'_itemClicked');};var removeItemClicked=function(){itemClicked.removeClass(options.className+'_itemClicked');};if(e.button!==1){_.delay(addItemClicked,100);_.delay(removeItemClicked,200);_.delay(_hideMenu,300,elem,elemID,options,menu,false);}}
if(itemClicked.find('[data-role="ipsMenu_selectedText"]').length){$(elem).find('[data-role="ipsMenu_selectedText"]').html(itemClicked.find('[data-role="ipsMenu_selectedText"]').html());}
if(itemClicked.find('[data-role="ipsMenu_selectedIcon"]').length){$(elem).find('[data-role="ipsMenu_selectedIcon"]').replaceWith(itemClicked.find('[data-role="ipsMenu_selectedIcon"]').clone());}
var data={triggerElem:elem,triggerID:elemID,menuElem:$(menu[0]),originalEvent:e};if(options.selectable){_.extend(data,_handleSelectableClick(elem,elemID,options,menu,e));}
if(!_.isUndefined(itemClicked.attr('data-ipsmenuvalue'))){_.extend(data,{selectedItemID:itemClicked.attr('data-ipsmenuvalue')});}
$(elem).trigger('menuItemSelected',data);},_handleSelectableClick=function(elem,elemID,options,menu,e){var thisItem=$(e.target).parent('.'+options.className+'_item');if(thisItem.attr('data-noselect')){return;}
if(options.selectable=='radio'){menu.find('.'+options.className+'_itemChecked').removeClass(options.className+'_itemChecked');}
if(thisItem.hasClass(options.className+'_itemChecked')){thisItem.removeClass(options.className+'_itemChecked');}else{thisItem.addClass(options.className+'_itemChecked');}
var selectedItems=menu.find('.'+options.className+'_itemChecked'),selected={};$.each(selectedItems,function(idx,item){selected[$(item).identify().attr('id')]=item;});return{selectedItems:selected};},_getAppendContainer=function(elem,appendTo){var appends=appendTo.split(',');var elem=$(elem);for(var i=0;i<appends.length;i++){var selector=$.trim(appends[i]);if(selector.startsWith('#')){if($(selector).length){return $(selector);}}else{if(elem.closest(selector).length){return elem.closest(selector);}}};};ips.ui.registerWidget('menu',ips.ui.menu,['className','menuID','closeOnClick','closeOnBlur','menuContent','appendTo','activeClass','selectable','withStem','stemOffset','stopLinks','above'],{lazyLoad:true,lazyEvents:'click'});return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.pageAction',function(){var defaults={};var respond=function(elem,options){if(!$(elem).data('_pageAction')){$(elem).data('_pageAction',pageActionObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_pageAction')){return $(elem).data('_pageAction');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};var pageActionObj=function(elem,options){var wrapper=null,initialized=false,id='',_checkedItems={};var init=function(){elem.find('[data-role="pageActionOptions"]').hide();_buildActionBar();_setUpEvents();_updateBar(true);initialized=true;},destruct=function(){$(document).off('click','[data-role="actionButton"]',_selectItem);$(document).off('menuItemSelected','[data-role="actionMenu"]',_selectMenuItem);},refresh=function(){_updateBar();},_setUpEvents=function(){elem.on('change','input[type="checkbox"]',_toggleCheckbox);elem.on('refresh.pageAction',_refreshPageAction);elem.on('addManualItem.pageAction',_addManualItem);$(document).on('click','[data-role="actionButton"]',_selectItem);$(document).on('menuItemSelected','[data-role="actionMenu"]',_selectMenuItem);},_addManualItem=function(e,data){_checkedItems[data.id]=data.actions;_updateBar(true);},_refreshPageAction=function(){_.each(_checkedItems,function(val,key){if(elem.find('input[type="checkbox"][name="'+key+'"]').length){elem.find('input[type="checkbox"][name="'+key+'"]').attr('checked',true).trigger('change');}});},_toggleCheckbox=function(e){var checkbox=$(e.currentTarget);if(checkbox.is(':checked')){_checkedItems[checkbox.attr('name')]=checkbox.attr('data-actions');}else{delete _checkedItems[checkbox.attr('name')];}
_updateBar(true);},_updateBar=function(doImmediate){var possibleValues=_getActionValues();var size=_.size(_checkedItems);_showCorrectButtons(possibleValues);_positionBar();wrapper.find('[data-role="count"]').text(ips.pluralize(ips.getString('pageActionText_number'),size));if(!size){if(doImmediate){wrapper.hide();}else{ips.utils.anim.go('fadeOut fast',wrapper);}}else if(initialized){if(wrapper.is(':visible')){ips.utils.anim.go('pulseOnce fast',wrapper);}else{if(doImmediate){wrapper.show();}else{ips.utils.anim.go('fadeIn',wrapper);}}}},_positionBar=function(){var width=wrapper.outerWidth();var newLeft=width/2;wrapper.css({marginLeft:(newLeft*-1)+'px'});},_showCorrectButtons=function(possibleValues){wrapper.find('[data-role="actionMenu"], [data-role="actionButton"]').each(function(){var show=false;var action=$(this).attr('data-action');if($(this).is('[data-role="actionButton"]')){if(_.indexOf(possibleValues,action)!==-1){show=true;}}else{var menuID=id+'_'+action+'_menu';$('#'+menuID).find('[data-ipsMenuValue]').each(function(){var menuAction=$(this).attr('data-ipsMenuValue');if(_.indexOf(possibleValues,menuAction)!==-1){show=true;$(this).removeClass('ipsMenu_itemDisabled');}else{$(this).addClass('ipsMenu_itemDisabled');}});}
if(show&&!$(this).is(':visible')){$(this).removeClass('ipsHide');}else if(!show&&$(this).is(':visible')){$(this).addClass('ipsHide');}});},_selectItem=function(e){e.preventDefault();_triggerAction($(e.currentTarget).attr('data-action'));},_selectMenuItem=function(e,data){e.preventDefault();_triggerAction(data.selectedItemID);},_triggerAction=function(action){var tools=elem.find('[data-role="pageActionOptions"]');tools.find('select').val(action);_.each(_checkedItems,function(val,key){if(!elem.find('input[type="checkbox"][name="'+key+'"]').length){elem.append($('<input/>').attr('type','hidden').attr('name',key).val(1));}});tools.find('[type="submit"]').click();},_buildActionBar=function(){var content='';var select=elem.find('[data-role="pageActionOptions"] select');id=select.identify().attr('id');select.children().each(function(){if($(this).is('optgroup')){content+=_buildOptGroup($(this),id);}else{content+=_buildOption($(this),id);}});var bar=ips.templates.render('core.pageAction.wrapper',{content:content,id:id,selectedLang:ips.getString('pageActionText')});elem.after(bar);wrapper=elem.next();$(document).trigger('contentChange',[wrapper]);},_buildOptGroup=function(optgroup,id){var content='';var options=optgroup.find('option');options.each(function(){content+=ips.templates.render('core.menus.menuItem',{value:$(this).attr('value'),title:$(this).html(),link:'#',});});return ips.templates.render('core.pageAction.actionMenuItem',{icon:optgroup.attr('data-icon'),title:optgroup.attr('label'),id:id,action:optgroup.attr('data-action'),menucontent:content});},_buildOption=function(option,id){return ips.templates.render('core.pageAction.actionItem',{icon:option.attr('data-icon'),id:id,title:option.html(),action:option.attr('value')});},_getActionValues=function(){var values=[];_.each(_checkedItems,function(val,key){var splitValues=val.split(' ');values=_.union(values,splitValues);});return values;},_getCheckedBoxes=function(){return elem.find('input[type="checkbox"][data-actions]:checked');};init();return{refresh:refresh,destruct:destruct,bar:wrapper};};ips.ui.registerWidget('pageAction',ips.ui.pageAction,[]);return{respond:respond,destruct:destruct,getObj:getObj};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.pagination',function(){var defaults={ajaxEnabled:true,perPage:25,pageParam:'page'};var respond=function(elem,options){options=_.defaults(options,defaults);if(!$(elem).data('_pagination')){$(elem).data('_pagination',paginationObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('pagination',ips.ui.pagination,['ajaxEnabled','perPage','pages','pageParam']);return{respond:respond};});var paginationObj=function(elem,options){var init=function(){if(!options.ajaxEnabled){return;}
elem.on('click','[data-page]',function(e){var targetElem=$(e.currentTarget);$(elem).trigger('paginationClicked',{href:targetElem.attr('href')||'#',hrefTitle:targetElem.attr('title')||'',paginationElem:$(elem),pageElem:targetElem,perPage:options.perPage,pageParam:options.pageParam,pageNo:targetElem.attr('data-page'),lastPage:(parseInt(targetElem.attr('data-page'))===parseInt(options.pages)),originalEvent:e||null});});elem.on('menuOpened',function(e,data){$(elem).find('input[type="number"]').focus();});elem.on('submit','[data-role="pageJump"]',function(e){var value=parseInt($(e.currentTarget).find('input[type="number"]').val());var href=$(e.currentTarget).closest('[data-baseURL]').attr('href');if(value<1||value>options.pages){ips.ui.alert.show({type:'alert',icon:'warning',message:ips.getString('not_valid_page',[options.pages]),callbacks:{}});return;}
$(elem).trigger('paginationJump',{originalEvent:e||null,href:href||'#',pageNo:value,perPage:options.perPage,pageParam:options.pageParam,lastPage:(parseInt(value)===parseInt(options.pages))});});};init();return{init:init};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.patchwork',function(){var defaults={items:'[data-role="patchworkItem"]',minColSize:300,maxColSize:600};var respond=function(elem,options){if(!$(elem).data('_patchwork')){$(elem).data('_patchwork',patchWorkObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_patchwork')){return $(elem).data('_patchwork');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};var patchWorkObj=function(elem,options){var currentColCount=1;var possibleSizes=[1,2,3,4,6,12];var containerList=null;var itemList=null;var items=null;var init=function(){itemList=elem.find('[data-role="patchworkList"]');items=itemList.find(options.items);items.each(function(idx){$(this).attr('data-position',idx);});_buildList();$(window).on('resize',_checkItemWidth);},destruct=function(){$(window).off('resize',_checkItemWidth);},_redrawLayout=function(force){var columnElems=containerList.find('[class*="ipsGrid_span"]').hide();var elemSize=elem.outerWidth();var columns=Math.ceil(elemSize/options.maxColSize);if(possibleSizes.indexOf(columns)===-1){columns=_getCorrectColumnCount(columns);}
if(currentColCount===columns&&force!==true){columnElems.show();return;}
var spanClass=_getSpanFromCount(columns);for(var i=0;i<columns;i++){containerList.append($('<li/>').addClass('ipsGrid_span'+spanClass).attr('data-working',true));}
currentColCount=columns;var currentItems=_.sortBy(items,function(item){return parseInt($(item).attr('data-position'));});_distributeItems(currentItems);containerList.find('[class*="ipsGrid_span"]:not( [data-working] )').remove();containerList.find('[data-working]').removeAttr('data-working');},_distributeItems=function(currentItems){var columns=containerList.find('> [class*="ipsGrid_span"][data-working]');var itemCount=currentItems.length;var heights=[];var isLastRow=false;columns.each(function(){heights.push({column:$(this),height:0});});_.each(currentItems,function(item,idx){if(((itemCount-(idx+1))%columns.length===0)&&(idx>=itemCount-columns.length)){isLastRow=true;}
var shortest=_.min(heights,function(value){return value.height;});if(shortest){shortest.column.append($(item));shortest.height+=$(item).outerHeight();}});},_buildList=function(){var elemSize=elem.outerWidth();containerList=$('<ul/>').addClass('ipsGrid ipsGrid_collapsePhone ipsPatchwork');itemList.after(containerList);_redrawLayout(true);},_getSpanFromCount=function(columns){return possibleSizes[(possibleSizes.length-1)-possibleSizes.indexOf(columns)];},_getCorrectColumnCount=function(columns){if(columns>12){return 12;}
for(var i=0;i<=possibleSizes.length;i++){if(columns==possibleSizes[i]){return possibleSizes[i];}
if(columns>i&&columns<=possibleSizes[i+1]){var diffA=columns-i;var diffB=possibleSizes[i+1]-columns;if(diffA>diffB){return possibleSizes[i+1];}else{return possibleSizes[i];}}}},_getFirst=function(){return elem.find('[data-role="patchwordGrid"] > [class*="ipsGrid_span"]').first();},_checkItemWidth=function(){var firstItem=_getFirst();if(options.minColSize&&firstItem.outerWidth()<parseInt(options.minColSize)||options.maxItemSize&&firstItem.outerWidth()>=parseInt(options.maxItemSize)){_redrawLayout();}};init();return{init:init,destruct:destruct};};ips.ui.registerWidget('patchwork',ips.ui.patchwork,['minColSize','maxColSize','items']);return{respond:respond,destruct:destruct,getObj:getObj};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.photoLayout',function(){var defaults={minHeight:250,gap:4,itemTemplate:'core.patchwork.imageList'};var respond=function(elem,options,e){options=_.defaults(options,defaults);if(!$(elem).data('_photoLayout')){$(elem).data('_photoLayout',photoLayoutObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_photoLayout')){return $(elem).data('_photoLayout');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};ips.ui.registerWidget('photoLayout',ips.ui.photoLayout,['minHeight','maxRows','gap','data','itemTemplate']);return{respond:respond,destruct:destruct,getObj:getObj};});var photoLayoutObj=function(elem,options){var currentWidth=0;var imageData;var noOfPhotos=0;var dataStore=$('<div/>');var init=function(){currentWidth=elem.width();imageData=_getData();noOfPhotos=imageData.length;elem.empty();run(imageData);$(window).on('resize',_resizeWindow);$(document).trigger('contentChange',[elem]);},destruct=function(){$(window).off('resize',_resizeWindow);},refresh=function(){imageData=_getData();noOfPhotos=imageData.length;elem.empty();run(imageData);},run=function(data){var initialHeight=Math.max(options.minHeight,Math.floor(currentWidth/5));var relativeSizes=[];_.each(data,function(image){var w=0;var h=0;if(!_.isString(image.filenames.small[0])){w=options.minHeight;h=options.minHeight;}else{w=parseInt(image.filenames.small[1],10);h=parseInt(image.filenames.small[2],10);}
if(h!=initialHeight){w=Math.floor(w*(initialHeight/h));}
relativeSizes.push(w);});var imagesSoFar=0;var rowNum=0;while(imagesSoFar<noOfPhotos){rowNum++;if(options.maxRows&&rowNum>options.maxRows){return;}
var imagesInRow=0;var widthOfRow=0;while((widthOfRow*1.1<currentWidth)&&(imagesSoFar+imagesInRow<noOfPhotos)){var gap=options.gap*2;if(imagesInRow===0){gap=options.gap;}
widthOfRow+=relativeSizes[imagesSoFar+imagesInRow++]+gap;}
widthOfRow-=options.gap;var row=_getRow();var ratio=currentWidth/widthOfRow;var lastRowNotFit=false;var i=0;widthOfRow=0;var rowHeight=Math.floor(initialHeight*ratio);row.height(rowHeight+(options.gap*2));while(i<imagesInRow){var thisImage=data[imagesSoFar+i];var newWidth=Math.floor(relativeSizes[imagesSoFar+i]*ratio);var thisWidth=(!_.isNull(thisImage.filenames.small[1]))?thisImage.filenames.small[1]:options.minHeight;var thisHeight=(!_.isNull(thisImage.filenames.small[2]))?thisImage.filenames.small[2]:options.minHeight;if(imagesSoFar+imagesInRow>=noOfPhotos&&rowHeight>=initialHeight){rowHeight=initialHeight;row.height(rowHeight+(options.gap*2));newWidth=Math.floor(thisWidth*(initialHeight/thisHeight));lastRowNotFit=true;}
widthOfRow+=newWidth+(options.gap*2);var item=_buildItem(thisImage,{width:newWidth,height:rowHeight,margin:options.gap,marginLeft:(i===0)?0:options.gap,marginRight:(i+1===imagesInRow)?0:options.gap});row.append(item);i++;}
widthOfRow-=(options.gap*2);imagesSoFar+=imagesInRow;if(!lastRowNotFit){var smWidth=0;while(widthOfRow<currentWidth){var item=row.find('.cGalleryPatchwork_item:nth-child('+(smWidth+1)+")");item.css({width:(item.width()+1)+'px'});smWidth=(smWidth+1)%imagesInRow;widthOfRow++;}
var bigWidth=0;while(widthOfRow>currentWidth){var item=row.find('.cGalleryPatchwork_item:nth-child('+(bigWidth+1)+")");item.css({width:(item.width()-1)+'px'});bigWidth=(bigWidth+1)%imagesInRow;widthOfRow--;}}}
elem.find('.cGalleryPatchwork_row').width(currentWidth);},_buildItem=function(imageData,extra){var multipliedWidth=extra.width*window.devicePixelRatio;var multipliedHeight=extra.height*window.devicePixelRatio;var showThumb=true;if(!_.isString(imageData.filenames.small[0])){showThumb=false}else{if(multipliedWidth<=imageData.filenames.small[1]&&multipliedHeight<=imageData.filenames.small[2]){imageData.src=imageData.filenames.small[0];}else{imageData.src=imageData.filenames.medium[0];}}
return ips.templates.render(options.itemTemplate,{showThumb:showThumb,image:imageData,dims:extra});},_getRow=function(){var row=$('<div/>').addClass('cGalleryPatchwork_row ipsClearfix');elem.append(row);return row;},_getData=function(){if(options.data){return $.parseJSON(options.data);}
var data=[];elem.find('[data-role="patchworkImage"][data-json]').each(function(){try{var _data=$.parseJSON($(this).attr('data-json'));}catch(err){return;}
data.push(_data);});return data;},_resizeWindow=function(e){currentWidth=elem.width();noOfPhotos=imageData.length;elem.empty();run(imageData);};init();return{init:init,destruct:destruct,refresh:refresh};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.productZoom',function(){var defaults={};var respond=function(elem,options){if(!$(elem).data('_productZoom')){$(elem).data('_productZoom',productZoomObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('productZoom',ips.ui.productZoom,['largeURL']);return{respond:respond};});var productZoomObj=function(elem,options){var initialized=false,wrapper=null,imageElem=null,zoomArea=null,currentlyOver=false,ratio=0,zoomerSize=0,thumbW=0,thumbH=0,wrapperW=0,wrapperH=0,fullW=0,fullH=0;var init=function(){elem.on('mouseenter',_enterElem);elem.on('mouseleave',_leaveElem);elem.on('mousemove',_moveElem);},_enterElem=function(e){currentlyOver=true;if(!initialized){_setUpZoomer();return;}
_showZoomer();},_leaveElem=function(e){currentlyOver=false;wrapper.fadeOut('fast');zoomArea.hide();},_moveElem=function(e){if(!initialized||!currentlyOver){return;}
var cursorPos=_cursorPos(e);var halfZoomer=(zoomerSize/2);var halfWrapper=wrapper.width()/2;var tLeft=0;var tTop=0;var fLeft=0;var fTop=0;if(cursorPos.left-halfZoomer<0){tLeft=0;}else if(cursorPos.left+halfZoomer>thumbW){tLeft=thumbW-zoomerSize;}else{tLeft=cursorPos.left-halfZoomer;}
if(cursorPos.top-halfZoomer<0){tTop=0;}else if(cursorPos.top+halfZoomer>thumbH){tTop=thumbH-zoomerSize;}else{tTop=cursorPos.top-halfZoomer;}
zoomArea.css({left:tLeft+'px',top:tTop+'px'});var reciprocal=1/ratio;var cursorPosLarge={left:cursorPos.left*reciprocal,top:cursorPos.top*reciprocal};if(cursorPosLarge.left-halfWrapper<0){fLeft=0;}else if(cursorPosLarge.left+halfWrapper>fullW){fLeft=fullW-wrapperW;}else{fLeft=cursorPosLarge.left-halfWrapper;}
if(cursorPosLarge.top-halfWrapper<0){fTop=0;}else if(cursorPosLarge.top+halfWrapper>fullH){fTop=fullH-wrapperH;}else{fTop=cursorPosLarge.top-halfWrapper;}
imageElem.css({left:(fLeft*-1)+'px',top:(fTop*-1)+'px',});},_imageLoaded=function(){wrapper.removeClass('ipsLoading');if(currentlyOver){_showZoomer();}},_showZoomer=function(){wrapper.show();zoomArea.show();thumbW=elem.width();thumbH=elem.height();wrapperW=wrapper.width();wrapperH=wrapper.height();fullW=imageElem.width();fullH=imageElem.height();ratio=thumbW/fullW;zoomArea.css({width:(thumbW*ratio)+'px',height:(thumbW*ratio)+'px',});zoomerSize=zoomArea.width();},_setUpZoomer=function(){$('#ipsZoomer, #ipsZoomer_area').remove();var elemPosition=ips.utils.position.getElemPosition(elem);var elemSize=ips.utils.position.getElemDims(elem);var imgURL=(options.largeURL)?options.largeURL:elem.find('img').attr('src');wrapper=$('<div/>').attr('id','ipsZoomer');zoomArea=$('<div/>').attr('id','ipsZoomer_area').hide();imageElem=$('<img/>').attr('src',imgURL).css({position:'absolute'});$('body').append(wrapper.append(imageElem));elem.append(zoomArea).css({position:'relative'});wrapper.css({width:elemSize.outerHeight+'px',height:elemSize.outerHeight+'px',left:elemPosition.absPos.left+elemSize.outerWidth+20+'px',top:elemPosition.absPos.top+'px',zIndex:ips.ui.zIndex()}).addClass('ipsLoading');imageElem.imagesLoaded(_imageLoaded);initialized=true;},_cursorPos=function(e){var offset=elem.offset();return{left:e.pageX-offset.left,top:e.pageY-offset.top};};init();return{};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.quote',function(){var defaults={timestamp:'',userid:0,username:'',contenttype:'',contentclass:'',contentid:0};var respond=function(elem,options){var data={};if(elem.data('quoteBuilt')){return;}
options=_.defaults(options,defaults);if(options.contentid){_.extend(data,{contentid:options.contentid,contenttype:options.contenttype,contenturl:ips.getSetting('baseURL')+"?app=core&module=system&controller=content&do=find&content_class="+options.contentclass+"&content_id="+options.contentid+"&content_commentid="+options.contentcommentid});}
_.extend(data,{userid:options.userid,username:options.username,timestamp:(options.timestamp)?ips.utils.time.readable(options.timestamp):false});var citation=ips.templates.render('core.editor.citation',data);elem.data('quoteBuilt',true).prepend(citation);if(elem.is('blockquote.ipsQuote > blockquote.ipsQuote')){elem.find('> *:not( .ipsQuote_citation )').hide().end().find('> .ipsQuote_citation').removeClass('ipsQuote_open').addClass('ipsQuote_closed');}
elem.find('> .ipsQuote_citation').on('click',_toggleQuote);},_toggleQuote=function(e){var cite=$(e.currentTarget);var target=$(e.target);if(target.is('a:not( [data-action="toggleQuote"] )')||(target.closest('a').length&&!target.closest('a').is('[data-action="toggleQuote"]'))){return;}
e.preventDefault();if(cite.hasClass('ipsQuote_closed')){ips.utils.anim.go('fadeIn',cite.siblings());cite.removeClass('ipsQuote_closed').addClass('ipsQuote_open');}else{cite.siblings().hide();cite.removeClass('ipsQuote_open').addClass('ipsQuote_closed');}
e.stopPropagation();};ips.ui.registerWidget('quote',ips.ui.quote,['timestamp','userid','username','contentapp','contenttype','contentclass','contentid','contentcommentid']);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.rating',function(){var defaults={changeRate:true,canRate:true};var respond=function(elem,options){if(!$(elem).data('_rating')){$(elem).data('_rating',ratingObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('rating',ips.ui.rating,['url','changeRate','canRate','size']);var ratingObj=function(elem,options){var selected=null,max=0,ratingElem=null,userRated=false,loading=false;var init=function(){elem.children().hide();selected=elem.find('input[type="radio"]:checked').val();var maxElem=_.max(elem.find('input[type="radio"]'),function(value){return parseInt($(value).attr('value'));});max=$(maxElem).attr('value');_buildRatingElem();ratingElem.on('mouseenter','li',_enterStar);ratingElem.on('mouseleave','li',_leaveStar);ratingElem.on('click','li',_clickStar);},_buildRatingElem=function(){var content='';for(var i=1;i<=max;i++){content+=ips.templates.render('core.rating.star',{value:i,className:(i<=selected)?'ipsRating_on':'ipsRating_off'});}
content=ips.templates.render('core.rating.wrapper',{content:content});elem.append(content);ratingElem=elem.find('.ipsRating');if(options.size){ratingElem.addClass('ipsRating_'+options.size);}},_enterStar=function(e){if((selected!=null&&!options.changeRate)||!options.canRate||loading){return;}
_starActive($(e.currentTarget).attr('data-ratingValue'),true);},_leaveStar=function(e){if((selected!=null&&!options.changeRate)||!options.canRate||loading){return;}
_starActive(selected,false);},_clickStar=function(e){e.preventDefault();if((selected!=null&&!options.changeRate)||!options.canRate||loading){return;}
var value=$(e.currentTarget).attr('data-ratingValue');selected=value;userRated=true;_starActive(value);ips.utils.anim.go('pulseOnce',$(e.currentTarget));if(options.url){_remoteRating(value);return;}
elem.find('input[type="radio"]').prop('checked',false).filter('input[type="radio"][value="'+value+'"]').prop('checked',true);elem.trigger('ratingSaved',{value:value});},_starActive=function(value,hover){ratingElem.find('li').removeClass('ipsRating_on').removeClass('ipsRating_hover').addClass('ipsRating_off').end().find('li[data-ratingValue="'+value+'"]').prevAll('li').andSelf().removeClass('ipsRating_off').toggleClass('ipsRating_on',!userRated&&!hover).toggleClass('ipsRating_hover',userRated||hover);},_remoteRating=function(value){_setLoading(true);var statusElem=elem.find('[data-role="ratingStatus"]');statusElem.html(ips.templates.render('core.rating.loading'));ips.getAjax()(options.url,{data:{rating:parseInt(value)}}).done(function(response){statusElem.text(ips.getString('rating_saved'));elem.trigger('ratingSaved',{value:value});}).fail(function(jqXHR){statusElem.text(ips.getString('rating_failed'));elem.trigger('ratingFailed',{value:value});}).always(function(){});},_setLoading=function(isLoading){loading=isLoading;ratingElem.toggleClass('ipsRating_loading',isLoading);};init();return{};};return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.selectTree',function(){var defaults={multiple:false,selected:false,searchable:true,placeholder:ips.getString('select')};var respond=function(elem,options){if(!$(elem).data('_selecttree')){$(elem).data('_selecttree',selectTreeObj($(elem),_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_selecttree')){return $(elem).data('_selecttree');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};var selectTreeObj=function(elem,options){var results=null,elemID=null,selectedItems=[],name='';var init=function(){elemID=elem.identify().attr('id');results=elem.find('.ipsSelectTree_nodes');name=elem.attr('data-name');elem.on('click',_toggleResults);elem.on('click','[data-action="getChildren"]',_toggleChildren);elem.on('click','[data-action="nodeSelect"]',_toggleNodeSelection);if($('input[name="'+name+'-zeroVal"]')){$('input[name="'+name+'-zeroVal"]').on('change',_zeroValChange);}
if(options.selected){try{var preSelected=$.parseJSON(options.selected);}catch(err){}
if(preSelected&&_.isObject(preSelected)&&_.size(preSelected)){_buildPreSelected(preSelected);return;}}
elem.find('.ipsSelectTree_value').addClass('ipsSelectTree_placeholder').text((options.placeholder)?options.placeholder:ips.getString('select'));_zeroValChange();},destruct=function(){$(document).off('click.'+elemID);},_buildPreSelected=function(preSelected){if(_.size(preSelected)){_.each(preSelected,function(val,key){selectedItems.push(key);if(options.multiple){var id=key;if(val.id){id=val.id;}
_addToken(val.title,id);}else{_setValue(val.title);}
if(results.find('[data-id="'+key+'"]').length){results.find('[data-id="'+key+'"]').addClass('ipsSelectTree_selected');}});_updateSelectedValues();}},_zeroValChange=function(e){elem.toggleClass('ipsSelectTree_disabled',$('input[name="'+name+'-zeroVal"]').is(':checked'));if(!$('input[name="'+name+'-zeroVal"]').is(':checked')&&results.is(':visible')){_closeResults();}},_toggleChildren=function(e,ignoreClosed){e.preventDefault();e.stopPropagation();var item=$(e.currentTarget).closest('.ipsSelectTree_item');var listItem=item.closest('li');var id=item.attr('data-id');var url=options.url+'&_nodeSelect=children&_nodeId='+id;if(!item.hasClass('ipsSelectTree_withChildren')){return;}
if(item.hasClass('ipsSelectTree_itemOpen')){if(ignoreClosed!==true){item.removeClass('ipsSelectTree_itemOpen')
listItem.find('> [data-role="childWrapper"]').hide();}}else{item.addClass('ipsSelectTree_itemOpen');if(item.attr('data-childrenLoaded')){ips.utils.anim.go('fadeIn fast',listItem.find('> [data-role="childWrapper"]'));}else{listItem.append($('<div/>').attr('data-role','childWrapper').html(ips.templates.render('core.general.loading',{text:ips.getString('loading')})));ips.getAjax()(url).done(function(response){item.attr('data-childrenLoaded',true);listItem.find('[data-role="childWrapper"]').html(response.output);});}}},_toggleNodeSelection=function(e){var node=$(e.currentTarget);if(node.hasClass('ipsSelectTree_selected')){_unselectNode(node,e);}else{_selectNode(node,e);}
_updateSelectedValues();},_selectNode=function(node,e){if(!options.multiple){elem.find('.ipsSelectTree_selected').removeClass('ipsSelectTree_selected');}
node.addClass('ipsSelectTree_selected');var title=node.find('[data-role="nodeTitle"]').text();var id=node.attr('data-id');if(!options.multiple){_setValue(title);}else{_addToken(title,id);}
if(options.multiple){selectedItems.push(node.attr('data-id'));}else{selectedItems=[node.attr('data-id')];}
if(e){_toggleChildren(e,true);}
elem.find('.ipsSelectTree_item').trigger('nodeItemSelected',{title:title,id:id});if(!options.multiple&&!node.hasClass('ipsSelectTree_withChildren')){setTimeout(function(){_closeResults();},200);}},_unselectNode=function(node,e){node.removeClass('ipsSelectTree_selected');selectedItems=_.without(selectedItems,node.attr('data-id'));if(!options.multiple){_setValue();}else{_removeToken(node);}},_addToken=function(title,id){var valueElem=elem.find('.ipsSelectTree_value');var elemHeight=elem.outerHeight();if(!elem.find('[data-role="tokenList"]').length){valueElem.html($('<ul/>').addClass('ipsList_inline').attr('data-role','tokenList'));}
elem.find('[data-role="tokenList"]').append(ips.templates.render('core.selectTree.token',{title:title,id:id}));if(elemHeight!=elem.outerHeight()){_positionResults();}},_removeToken=function(node){var id=node.attr('data-id');var tokenList=elem.find('[data-role="tokenList"]');var elemHeight=elem.outerHeight();var token=tokenList.find('[data-nodeId="'+id+'"]').closest('li').remove();if(!tokenList.find('[data-nodeId]').length){tokenList.remove();_setValue();}
if(elemHeight!=elem.outerHeight()){_positionResults();}},_updateSelectedValues=function(){elem.find('[data-role="nodeValue"]').val(_.uniq(selectedItems).join(','));elem.find('.ipsSelectTree_item').trigger('nodeSelectedChanged',{selectedItems:selectedItems});},_setValue=function(value){if(value){elem.find('.ipsSelectTree_value').text(value).removeClass('ipsSelectTree_placeholder');}else{elem.find('.ipsSelectTree_value').text((options.placeholder)?options.placeholder:ips.getString('select')).addClass('ipsSelectTree_placeholder');}},_toggleResults=function(e){if(results.is(':visible')){_maybeHideResults(e);}else{_showResults(e);}},_maybeHideResults=function(e){var rawResults=results.get(0);if((!$.contains(rawResults,e.target)&&rawResults!=e.target)){_closeResults();}},_closeResults=function(){ips.utils.anim.go('fadeOut fast',results);$(document).off('click.'+elemID);elem.removeClass('ipsSelectTree_active');elem.trigger('nodeSelectionClosed');},_showResults=function(){$(document).on('click.'+elemID,_closeResultsOnBlur);_positionResults();results.show();elem.addClass('ipsSelectTree_active');if(elem.find('[data-role="nodeSearch"]')){elem.find('[data-role="nodeSearch"]').focus();}},_positionResults=function(){var positionInfo={trigger:elem,target:results,targetContainer:elem};var selectWidth=elem.outerWidth();var resultsPosition=ips.utils.position.positionElem(positionInfo);results.css({left:'0px',position:(resultsPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex(),minWidth:selectWidth+'px'});},_closeResultsOnBlur=function(e){if(!_clickIsInElem(e.target)){_closeResults();}},_clickIsInElem=function(target){var rawElem=elem.get(0);var rawResults=results.get(0);if(target==rawElem||target==rawResults||$.contains(rawResults,target)||$.contains(rawElem,target)){return true;}
return false;};init();return{};};ips.ui.registerWidget('selectTree',ips.ui.selectTree,['placeholder','multiple','selected','url','searchable']);return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.sideMenu',function(){var defaults={type:'radio',responsive:true,group:false};var respond=function(elem,options){if(!$(elem).data('_sidemenu')){$(elem).data('_sidemenu',sideMenuObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('sideMenu',ips.ui.sideMenu,['responsive','type','group']);var sideMenuObj=function(elem,options){var init=function(){if(options.responsive&&ips.utils.responsive.enabled()){$(elem).on('click','[data-action="openSideMenu"]',_toggleSideMenu);$(elem).find('.ipsSideMenu_mainTitle').after($('<div/>')).end().find('.ipsSideMenu_mainTitle + div').append($(elem).find('.ipsSideMenu_title, .ipsSideMenu_subTitle, .ipsSideMenu_list'));}
$(elem).on('click','.ipsSideMenu_item',_clickEvent);$(elem).on('selectItem.sideMenu',_selectItem);},_clickEvent=function(e){_doSelectItem($(e.currentTarget),e);},_selectItem=function(e,data){_doSelectItem(elem.find('[data-ipsMenuValue="'+data.value+'"]'),e);},_doSelectItem=function(item,e){if((_.isUndefined(item.attr('data-ipsMenuValue'))&&!item.find('input[type="radio"], input[type="checkbox"]').length)||!item.length){return;}
if(e){e.preventDefault();}
if(item.hasClass('ipsSideMenu_itemDisabled')){return;}
var workingItems;if(!options.group){workingItems=$(elem).find('.ipsSideMenu_item');}else{workingItems=item.closest('.ipsSideMenu_list').find('.ipsSideMenu_item');}
if(options.type=='check'){item.toggleClass('ipsSideMenu_itemActive').find('input[type="radio"], input[type="checkbox"]').prop("checked",function(i,val){return!val;});}else{workingItems.removeClass('ipsSideMenu_itemActive').find('input[type="radio"], input[type="checkbox"]').prop("checked",false);item.addClass('ipsSideMenu_itemActive').find('input[type="radio"], input[type="checkbox"]').prop("checked",true);}
var selectedItems=[];workingItems.filter('.ipsSideMenu_itemActive').each(function(){selectedItems.push($(this).attr('data-ipsMenuValue'));});$(elem).trigger('itemClicked.sideMenu',{id:$(elem).identify().attr('id'),menuElem:$(elem),selectedElem:item,selectedItemID:item.attr('data-ipsMenuValue'),selectedItems:selectedItems});},_toggleSideMenu=function(e){e.preventDefault();var menuContainer=$(elem).find('.ipsSideMenu_mainTitle + div');if($(elem).hasClass('ipsSideMenu_open')){$(elem).removeClass('ipsSideMenu_open');}else{$(elem).addClass('ipsSideMenu_open');ips.utils.anim.go('fadeIn',menuContainer);}};init();return{};};return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.spoiler',function(){var respond=function(elem,options,e){_setUpSpoiler(elem);$(elem).on('click','.ipsStyle_spoilerFancy_text',_toggleSpoiler).on('keypress',_spoilerKeypress);},_spoilerKeypress=function(e){switch(e.keyCode){case ips.ui.key.SPACE:case ips.ui.key.ENTER:_toggleSpoiler(e);}},_setUpSpoiler=function(elem){$(elem).removeClass('ipsStyle_spoiler').addClass('ipsStyle_spoilerFancy').attr('tabindex','0').append($('<div/>').addClass('ipsStyle_spoilerFancy_inner')).append(ips.templates.render('core.posts.spoiler'));},_toggleSpoiler=function(e){var spoiler=$(e.currentTarget).closest('.ipsStyle_spoilerFancy');if(spoiler.hasClass('ipsStyle_spoilerFancy_open')){spoiler.removeClass('ipsStyle_spoilerFancy_open').attr('tabindex','0').trigger('spoilerHidden').find('.ipsStyle_spoilerFancy_text').replaceWith(ips.templates.render('core.posts.spoiler'));}else{spoiler.addClass('ipsStyle_spoilerFancy_open').removeAttr('tabindex').blur().trigger('spoilerRevealed').find('.ipsStyle_spoilerFancy_text').replaceWith(ips.templates.render('core.posts.spoilerOpen'));}};ips.ui.registerWidget('spoiler',ips.ui.spoiler);return{respond:respond}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.stack',function(){var defaults={sortable:true,itemTemplate:'core.forms.stack'};var respond=function(elem,options){if(!$(elem).data('_stack')){$(elem).data('_stack',stackObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('stack',ips.ui.stack,['sortable','maxItems','itemTemplate']);return{respond:respond};});var stackObj=function(elem,options){var stack=null;var init=function(){if(!elem.attr('data-initiated')){stack=elem.find('[data-role="stack"]');elem.on('click','[data-action="stackAdd"]',_addItem);elem.on('click','[data-action="stackDelete"]',_deleteItem);elem.on('keydown','[data-role="stackItem"] input[type="text"]',_keyDown);if(options.sortable){ips.loader.get(['core/interface/jquery/jquery-ui.js']).then(function(){stack.sortable({handle:'[data-action="stackDrag"]'});});}
elem.attr('data-initiated','true');$(elem).trigger('stackInitialized',{count:_getItemCount()});}},_keyDown=function(e){if(e.keyCode==ips.ui.key.ENTER){e.preventDefault();_addItem(null,$(e.currentTarget).closest('[data-role="stackItem"]'));}},_addItem=function(e,after){if(e){e.preventDefault();}
if(options.maxItems&&_getItemCount()>=options.maxItems){return;}
var field=stack.find('[data-ipsStack-wrapper]').first().html().replace(/(name=['"][a-zA-Z0-9\-_]+?)\[([^\]]+?)?\]/g,'$1['+_getItemCount()+']').replace(/id=['"](.+?)['"]/g,'id="$1_'+_getItemCount()+'"').replace(/data-toggles=['"](.+?)['"]/g,function(match,p1){var pieces=p1.split(',');var newPieces=[];_.each(pieces,function(val){if(val.match(/_[0-9]+$/g)){newPieces.push(val+'_'+_getItemCount());}else{newPieces.push(val);}});return'data-toggles="'+newPieces.join(',')+'"';});if(!stack.find('select').length){field=field.replace(/value=['"](.+?)['"]$/g,'value="" ');}
var html=ips.templates.render(options.itemTemplate,{field:field});if(after){after.after(html).next('[data-role="stackItem"]').find('input,textarea').focus();}else{stack.append(html).find('[data-role="stackItem"] input,[data-role="stackItem"] textarea').last().focus();}
if(options.maxItems&&_getItemCount()>=options.maxItems){elem.find('[data-action="stackAdd"]').hide();}
$(document).trigger('contentChange',[elem]);$(elem).trigger('stackRowAdded',{count:_getItemCount()});},_deleteItem=function(e){e.preventDefault();var row=$(e.currentTarget).closest('[data-role="stackItem"]');if(_getItemCount()===1){row.find('input,textarea').val('');return;}
ips.utils.anim.go('fadeOutDown',row).done(function(){row.hide();setTimeout(function(){row.remove();},100);});if(options.maxItems&&_getItemCount()<options.maxItems){elem.find('[data-action="stackAdd"]').show();}},_getItemCount=function(){return stack.find('[data-role="stackItem"]').length;};init();};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.sticky',function(){var defaults={stickyClass:'ipsSticky',stickTo:'top',spacing:0};var respond=function(elem,options){$(elem).data('_sticky',stickyObj(elem,_.defaults(options,defaults)));},getObj=function(elem){if($(elem).data('_sticky')){return $(elem).data('_sticky');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}};ips.ui.registerWidget('sticky',ips.ui.sticky,['stickyClass','relativeTo','spacing','stickTo','width','disableIn']);var stickyObj=function(elem,options){var relativeTo,originalStyles={},originalOffsetTop,status,dummyElem,locked=false;var _init=function(){if(!$(elem).is(':visible')){Debug.warn("Can't set up a sticky element if the element is hidden when init is called.");return;}
$(document).on('scroll',_scrollDocument).on('breakpointChange',_breakpointChange);$(window).on('resize',_windowResize);relativeTo=$(options.relativeTo||'');if(!$(relativeTo).length){relativeTo=$(elem).parent();}
if(options.disableIn){options.disableIn=_.map(options.disableIn.split(','),function(item){return $.trim(item)});}
originalStyles={top:$(elem).css('top'),bottom:$(elem).css('bottom'),position:$(elem).css('position'),width:$(elem).get(0).style.width};status='normal';originalOffsetTop=$(elem).offset().top;_scrollDocument();$(elem).trigger('stickyInit',{id:$(elem).identify().attr('id'),status:status});},destruct=function(){$(document).off('scroll',_scrollDocument).off('breakpointChange',_breakpointChange);$(window).off('resize',_windowResize);},_breakpointChange=function(e,data){if(!ips.utils.responsive.enabled){return;}
if(_.indexOf(options.disableIn,data.curBreakName)!==-1){_makeNormal();locked=true;}else{locked=false;}},_windowResize=function(){_makeNormal();originalOffsetTop=$(elem).offset().top;_scrollDocument();},_scrollDocument=function(){var bodyScroll=$(document).scrollTop();var elemSize=$(elem).outerHeight();var originalBottom=originalOffsetTop+elemSize;var wrapperSize=$(elem).outerHeight();var viewportHeight=$(window).height();if(_.indexOf(options.disableIn,ips.utils.responsive.getCurrentKey())!==-1){_makeNormal();locked=true;}else{locked=false;}
if(options.stickTo=='bottom'){if(((viewportHeight+bodyScroll)<=(originalBottom+options.spacing))&&status=='normal'){_makeFixed();}else if(((viewportHeight+bodyScroll)>=(originalBottom+options.spacing))&&status=='fixed'){_makeNormal();}}else{if(bodyScroll>=(originalOffsetTop-options.spacing)&&status=='normal'){_makeFixed();}else if(bodyScroll<=(originalOffsetTop-options.spacing)&&status=='fixed'){_makeNormal();}}},_makeFixed=function(){if(locked){return;}
var width;if(!dummyElem){_makeDummyElem();}
var bottomSpacing=$(document).height()-$(window).height()-$(document).scrollTop()-10;if(options.stickTo=='top'&&bottomSpacing<$(elem).outerHeight()){_makeBottomSpacer(bottomSpacing);}
if(options.width&&(options.width.indexOf('#')===0||options.width.indexOf('.')===0)){width=$(options.width).first().outerWidth();}else if(options.width){width=parseInt(options.width);}else{width=$(elem).css('width');}
$(elem).css({position:'fixed',width:width,zIndex:ips.ui.zIndex()}).addClass(options.stickyClass);if(options.stickTo=='bottom'){$(elem).css({bottom:options.spacing+'px'}).addClass(options.stickyClass+'_bottom');}else{$(elem).css({top:options.spacing+'px'}).addClass(options.stickyClass+'_top');}
dummyElem.css({width:$(elem).width(),height:$(elem).outerHeight()}).show();status='fixed';},_makeNormal=function(){$(elem).css({position:originalStyles.position,width:originalStyles.width}).removeClass(options.stickyClass).removeClass(options.stickyClass+'_top')
if(options.stickTo=='bottom'){$(elem).css({bottom:originalStyles.bottom}).removeClass(options.stickyClass+'_bottom');}else{$(elem).css({top:originalStyles.bottom}).removeClass(options.stickyClass+'_top');}
if(dummyElem){dummyElem.hide();}
_makeBottomSpacer(0);status='normal';},_makeDummyElem=function(){dummyElem=$('<div/>').insertAfter(elem).hide();},_makeBottomSpacer=function(size){if(!$('#ipsStickySpacer').length){$('<div/>').attr('id','ipsStickySpacer').appendTo('body');}
$('#ipsStickySpacer').css({height:(size+10)+'px'});};_init();return{destruct:destruct};};return{respond:respond,destruct:destruct};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.tabbar',function(){var defaults={itemSelector:'.ipsTabs_item',activeClass:'ipsTabs_activeItem',loadingClass:'ipsLoading ipsTabs_loadingContent',panelClass:'ipsTabs_panel',panelPrefix:'ipsTabs',stretch:false,updateURL:true,updateTitle:false};var respond=function(elem,options){$(elem).data('_tabbar',tabBarObj(elem,_.defaults(options,defaults)));};ips.ui.registerWidget('tabbar',ips.ui.tabbar,['contentArea','itemSelector','activeClass','loadingClass','panelClass','updateURL','updateTitle','panelPrefix','defaultTab','stretch']);return{respond:respond};});var tabBarObj=function(elem,options){var rawElem=elem.get(0),barId=rawElem.id,tabs=$(elem).find(options.itemSelector),active,ajaxObj,loadPanel;var init=function(){if(!barId){barId=$(rawElem).identify().attr('id');}
if(!options.contentArea||!$(options.contentArea).length){options.contentArea='#'+$(rawElem).next().identify().attr('id');}
if(!tabs.length){Debug.warn("No tabs found in tab bar"+barId);return;}
if(options.stretch){var width=(100/tabs.length);tabs.css('width',width+'%');}
active=_getActiveTab();_initializeActive();$(elem).on('click',options.itemSelector,_handleTabClick);$(elem).on('click',"[data-action='expandTabs']",_expandMenu);},_handleTabClick=function(e){e.preventDefault();_tabClickPhone(e);if($(this).hasClass(options.activeClass)){return;}
var thisId=$(this).identify().attr('id'),thisContent=$('#'+options.panelPrefix+'_'+barId+'_'+thisId+'_panel');if(!thisContent.length){thisContent=_createTabPanel(thisId);_loadContent(this,thisContent).done(function(){_switchTab(thisId);}).fail(function(){Debug.log('failed');});}else{_hideAllPanels();_switchTab(thisId);}
_updateURL(thisId);},_expandMenu=function(e){e.preventDefault();if($(elem).find('.ipsTabs_item').length>1){if($(elem).hasClass('ipsTabs_showMenu')){$(elem).removeClass('ipsTabs_showMenu');}else{$(elem).addClass('ipsTabs_showMenu');}}},_tabClickPhone=function(e){$(elem).removeClass('ipsTabs_showMenu');},_switchTab=function(tabId,immediate){_hideAllPanels();var thisContent=$('#'+options.panelPrefix+'_'+barId+'_'+tabId+'_panel');if(!immediate){ips.utils.anim.go('fadeIn',thisContent).done(function(){thisContent.attr('aria-hidden','false');$(elem).trigger('tabShown',{barID:barId,tabID:tabId,tab:active,panel:thisContent});});}else{thisContent.show().attr('aria-hidden','false');$(elem).trigger('tabShown',{barID:barId,tabID:tabId,tab:active,panel:thisContent});}
$(document).trigger('contentChange',[thisContent]);active=$('#'+tabId);_makeTabActive(active);$(elem).trigger('tabChanged',{barID:barId,tabID:tabId,tab:active});},_updateURL=function(tabId){if(!options.updateURL){return;}
var href=$('#'+tabId).attr('href'),title=(options.updateTitle&&$('#'+tabId).attr('title'))?$('#'+tabId).attr('title'):document.title;if(!_.isEmpty(href)&&!href.startsWith('#')){History.replaceState({},title,href);}},_getActiveTab=function(){var activeTab=elem.find('.'+options.activeClass);if(activeTab.length){return activeTab.get(0);}
if(options.defaultTab&&$(elem).find(options.defaultTab)){return $(elem).find(options.defaultTab).get(0);}
return $(elem).find(options.itemSelector).first();},_initializeActive=function(){var activeId=$(active).identify().attr('id');if(!$('#'+options.panelPrefix+'_'+barId+'_'+activeId+'_panel').length){if($(options.contentArea).children().length){$(options.contentArea).wrapInner(_createTabPanel(activeId,true));_switchTab(activeId,true);}else{var newPanel=_createTabPanel(activeId);_loadContent(active,newPanel).done(function(){_switchTab(activeId);});}}else{_switchTab(activeId,true);}},_makeTabActive=function(activeTab){$(elem).find(options.itemSelector).removeClass(options.activeClass).removeAttr('aria-selected');$(activeTab).addClass(options.activeClass).attr('aria-selected','true');},_loadContent=function(tab,container){var deferred=$.Deferred();_hideAllPanels();if($(tab).attr('data-tabURL')){var url=$(tab).attr('data-tabURL');}else{var url=$(tab).attr('href');}
$(options.contentArea).addClass(options.loadingClass);ajaxObj=ips.getAjax();ajaxObj(url).done(function(response){container.html(response);deferred.resolve();}).fail(function(jqXHR,status,errorThrown){window.location=tab.href;}).always(function(){$(options.contentArea).removeClass(options.loadingClass);});return deferred.promise();},_hideAllPanels=function(){$(options.contentArea).find('.'+options.panelClass).hide().attr('aria-hidden','true');},_createTabPanel=function(tabId,noAppend){var newPanel=$('<div/>').attr({'id':options.panelPrefix+'_'+barId+'_'+tabId+'_panel'}).addClass(options.panelClass).attr({'aria-labelledby':tabId});if(!noAppend){$(options.contentArea).append(newPanel);}
return newPanel;};init();return{init:init}};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.toggle',function(){var defaults={template:'core.forms.toggle'};var respond=function(elem,options){if(!$(elem).data('_toggle')){$(elem).data('_toggle',toggleObj(elem,_.defaults(options,defaults)));}};ips.ui.registerWidget('toggle',ips.ui.toggle,['template']);return{respond:respond};});var toggleObj=function(elem,options,e){var checkID=$(elem).identify().attr('id'),wrapper;var init=function(){var status=$(elem).prop('checked'),lang=(status)?ips.getString('toggleOn'):ips.getString('toggleOff'),className=(status)?'ipsToggle_on':'ipsToggle_off';$(elem).after(ips.templates.render(options.template,{id:checkID+'_wrapper',status:lang,className:className})).hide();wrapper=$('#'+checkID+'_wrapper');wrapper.on('click',function(e){if(!$(elem).is(':disabled')){if($(elem).prop('checked')){_doToggle('off');}else{_doToggle('on');}
$(elem).change();}
e.preventDefault();}).on('keypress',_keyPress);if($(elem).is('[data-ipstooltip]')){wrapper.attr('data-ipsTooltip','').attr('title',$(elem).attr('title'));$(document).trigger('contentChange',[wrapper]);}
if($(elem).is(':disabled')){wrapper.addClass('ipsToggle_disabled');}
$(elem).on('change',function(e){if($(elem).is(':checked')){_doToggle('on');}else{_doToggle('off');}});},_doToggle=function(type){if(type=='off'){wrapper.removeClass('ipsToggle_on').addClass('ipsToggle_off').find('[data-role="status"]').text(ips.getString('toggleOff'));elem.get(0).checked=false;}else{wrapper.removeClass('ipsToggle_off').addClass('ipsToggle_on').find('[data-role="status"]').text(ips.getString('toggleOn'));elem.get(0).checked=true;}},_keyPress=function(e){if(e.keyCode==ips.ui.key.SPACE||e.keyCode==ips.ui.key.ENTER){e.preventDefault();if($(elem).prop('checked')){_doToggle('off');}else{_doToggle('on');}}};init();return{init:init}};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.tooltip',function(){var _animating=false,_tooltip=null,_timer=null;var respond=function(elem,options,e){if(ips.utils.events.isTouchDevice()){return;}
if(!_tooltip){_createTooltipElement();}
var content=_getContent(elem,options);if(e.type=='mouseleave'||e.type=='blur'||e.type=='focusout'){_hide();}else{if(content){_show(elem,options,content);}}},_show=function(elem,options,content){elem=$(elem);ips.utils.anim.cancel(_tooltip);if(options.safe){_tooltip.hide().html(content);}else{_tooltip.hide().text(content);}
if(elem.attr('title')){elem.attr('_title',elem.attr('title')).removeAttr('title');}
var positionInfo={trigger:elem,target:_tooltip,center:true,above:true,stemOffset:{left:10,top:0}};var tooltipPosition=ips.utils.position.positionElem(positionInfo);$(_tooltip).css({left:tooltipPosition.left+'px',top:tooltipPosition.top+'px',position:(tooltipPosition.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});if(tooltipPosition.location.vertical=='top'){_tooltip.addClass('ipsTooltip_top').removeClass('ipsTooltip_bottom');}else{_tooltip.addClass('ipsTooltip_bottom').removeClass('ipsTooltip_top');}
_tooltip.removeClass('ipsTooltip_left').removeClass('ipsTooltip_right');if(tooltipPosition.location.horizontal=='left'){_tooltip.addClass('ipsTooltip_left');}else if(tooltipPosition.location.horizontal=='right'){_tooltip.addClass('ipsTooltip_right');}
_tooltip.show();_timer=setInterval(function(){if(!$(elem).length||!$(elem).is(':visible')){_hide();}},100);$(elem).trigger('tooltipShown');},_hide=function(){ips.utils.anim.go('fadeOut',_tooltip);if(_timer){clearInterval(_timer);}},_getContent=function(elem,options){elem=$(elem);if(options.label){return options.label;}else if(elem.attr('aria-label')){return elem.attr('aria-label');}else if(elem.attr('_title')){return elem.attr('_title');}else if(elem.attr('title')){return elem.attr('title');}},_createTooltipElement=function(){var tooltip=ips.templates.render('core.tooltip',{id:'ipsTooltip'});ips.getContainer().append(tooltip);_tooltip=$('#ipsTooltip');};ips.ui.registerWidget('tooltip',ips.ui.tooltip,['label','extraClass','safe'],{lazyLoad:true,lazyEvents:'mouseenter mouseleave focus blur'});return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.truncate',function(){var defaults={type:'remove',size:100,expandText:ips.getString('show_more')};var respond=function(elem,options){if(options.type=='remove'){_removeTruncate(elem,_.defaults(options,defaults));}else{_hideTruncate(elem,_.defaults(options,defaults));}},_removeTruncate=function(elem,options){if(elem.children().first().prop('tagName')=='P'){elem.html(elem.children().first().html());}
var size=_getSizeValue(options.size,elem);var clampTo=(size.lines)?size.lines:size.pixels+'px';elem.dotdotdot({height:size.pixels,watch:true});elem.trigger('contentTruncated',{type:'remove'});},_hideTruncate=function(elem,options){var size=_getSizeValue(options.size,elem);var originalSize=elem.outerHeight();var originalPos=$(elem).css('position');if(originalSize<=size.pixels){Debug.log('Smaller than the specified size, finishing...');return;}
if(originalPos=='static'){$(elem).css('position','relative');}
$(elem).css({height:size.pixels+'px'}).addClass('ipsTruncate');var showMore=ips.templates.render('core.truncate.expand',{text:options.expandText});$(elem).append(showMore);var expander=elem.find("[data-action='expandTruncate']");elem.trigger('contentTruncated',{type:'hide'});expander.on('click',function(e){ips.utils.anim.go('fadeOutDown fast',expander);$(elem).animate({height:originalSize+'px'},function(){$(this).css('position',originalPos);expander.remove();$(elem).trigger('truncateExpanded');});});},_getSizeValue=function(value,elem){try{if($(value).length){return{pixels:$(value).first().outerHeight()};}}catch(err){}
if(String(value).indexOf('lines')!==-1){var lines=parseInt(value.replace('lines',''));var number=lines*_getLineHeight(elem);return{lines:lines,pixels:number};}else{return{pixels:parseInt(value)};}},_getLineHeight=function(elem){var lH=$(elem).css('line-height');return parseInt(lH);};ips.ui.registerWidget('truncate',ips.ui.truncate,['type','size','expandText']);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.uploader',function(){var defaults={multiple:false,allowedFileTypes:null,maxFileSize:null,maxTotalSize:null,maxChunkSize:null,action:null,name:'upload',button:'.ipsButton_primary',key:null,autoStart:true,insertable:false,template:'core.attachments.fileItem',postkey:''};var respond=function(elem,options,e){if(!$(elem).data('_uploader')){$(elem).show();$(elem).data('_uploader',uploadObj(elem,_.defaults(options,defaults)));}},getObj=function(elem){if($(elem).data('_uploader')){return $(elem).data('_uploader');}
return undefined;};ips.ui.registerWidget('uploader',ips.ui.uploader,['multiple','allowedFileTypes','maxFileSize','maxTotalSize','maxChunkSize','action','name','button','key','dropTarget','listContainer','autoStart','insertable','template','existingFiles','postkey']);return{respond:respond,getObj:getObj};});var uploadObj=function(elem,options,e){var pluploadObj,listContainer,uploadCount=0,inject=false,uploaderID='';var init=function(){uploaderID=$(elem).identify().attr('id');if(options.listContainer){listContainer=$(options.listContainer);}else if($(elem).find('[data-role="fileList"]').length){listContainer=$(elem).find('[data-role="fileList"]');}else{listContainer=$(elem);}
if(ips.templates.get(options.template+'Wrapper')){listContainer.prepend(ips.templates.render(options.template+'Wrapper'));var firstItem=listContainer.children().first();firstItem.append(listContainer.children().not(firstItem));listContainer=firstItem;$(document).trigger('contentChange',[listContainer.parent()]);}
$(document).on('addUploaderFile',_addUploaderFile);$(document).on('removeAllFiles',_removeAllFiles);if(options.existingFiles){try{var files=$.parseJSON(options.existingFiles);if(files.length){_buildExistingFiles(files);}}catch(err){Debug.error("Couldn't build existing files: "+err);}}
if(_supportsDraggable()){$(elem).find('.ipsAttachment_supportDrag').show().end().find('.ipsAttachment_nonDrag').hide();}
_setUpUploader();_initUploader();_postInitEvents();_setUpFormEvents();},_setUpFormEvents=function(){if(!elem.closest('form').length){return;}
elem.closest('form').on('submit',function(e){if(pluploadObj.state!=plupload.STOPPED){e.preventDefault();e.stopPropagation();ips.ui.alert.show({type:'alert',message:ips.getString('filesStillUploading'),subText:ips.getString('filesStillUploadingDesc'),icon:'warn'});}});},_addUploaderFile=function(e,data){if(data.uploaderID==uploaderID){listContainer.append(ips.templates.render(options.template,data));}},_removeAllFiles=function(e,data){listContainer.find('[data-role="file"]').remove();},_buildExistingFiles=function(files){if(!files.length){return;}
for(var i=0;i<files.length;i++){var data={id:files[i].id,imagesrc:files[i].imagesrc,thumbnail:files[i].thumbnail?files[i].thumbnail:'',title:files[i].originalFileName,size:files[i].size,field_name:elem.attr('data-ipsUploader-name'),newUpload:false,insertable:!options.insertable,done:true,'default':files[i].default?files[i].default:null};if(files[i].id==elem.attr('data-ipsUploader-default')){data['checked']="checked";}
if(files[i]['hasThumb']){data['thumb']="<img src='"+(files[i]['thumbnail']?files[i]['thumbnail']:files[i]['imagesrc'])+"' class='ipsImage'>";}
listContainer.append(ips.templates.render(options.template,data));$('#'+files[i].id).trigger('newItem',[$('#'+files[i].id)]);};elem.trigger('fileAdded',{count:files.length,uploader:options.name});},_setUpUploader=function(){pluploadObj=new plupload.Uploader(_getUploaderSettings());pluploadObj.bind('Init',events.init);listContainer.find('[data-role="file"]').each(function(){var fileElem=$(this);fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));uploadCount++;});},_getUploaderSettings=function(){var form=elem.parentsUntil('','form');if(options.action===null){options.action=form.attr('action');}
if(options.key===null){options.key=form.children("[name='plupload']").val();}
var pluploadOptions={runtimes:'html5,flash,silverlight,html4',multi_selection:options.multiple,url:options.action,file_data_name:options.name,flash_swf_url:'applications/core/interface/plupload/Movie.swf',silverlight_xap_url:'applications/core/interface/plupload/Movie.xap',browse_button:elem.find(options.button).identify().attr('id'),headers:{'x-plupload':options.key},chunk_size:options.maxChunkSize+'mb'};if(options.dropTarget){pluploadOptions.drop_element=$(options.dropTarget).attr('id');}else if($(elem).hasClass('ipsAttachment_dropZone')){pluploadOptions.drop_element=$(elem).attr('id');}else if($(elem).find('.ipsAttachment_dropZone').length){pluploadOptions.drop_element=$(elem).find('.ipsAttachment_dropZone').identify().attr('id');}
return pluploadOptions;},_initUploader=function(){pluploadObj.init();},_postInitEvents=function(){pluploadObj.bind('Error',events.error);pluploadObj.bind('FilesAdded',events.filesAdded);pluploadObj.bind('FilesRemoved',events.filesRemoved);pluploadObj.bind('UploadFile',events.uploadFile);pluploadObj.bind('UploadProgress',events.uploadProgress);pluploadObj.bind('FileUploaded',events.fileUploaded);$(elem).on('injectFile',function(e,file){inject=true;pluploadObj.addFile(file);}).on('resetUploader',function(data){_resetUploader(e,data);})},_resetUploader=function(data){uploadCount=0;_updateCount();$(elem).trigger('removeAllFiles',{uploaderID:uploaderID});},_startUpload=function(){Debug.log('Starting upload process...');pluploadObj.start();},_getStatus=function(status){switch(status){case plupload.QUEUED:return ips.getString('attachQueued');break;case plupload.UPLOADING:return ips.getString('attachUploading');break;case plupload.FAILED:return ips.getString('attachFailed');break;case plupload.DONE:return ips.getString('attachDone');break;}},_updateFileElement=function(file){var fileElem=_findFileElem(file);_updateStatus(fileElem,file.status);_removeStatusClasses(fileElem);_updateCount();return fileElem;},_findFileElem=function(file){return $(elem).find('#'+file.id);},_updateStatus=function(fileElem,status){fileElem.find('[data-role="status"]').html(_getStatus(status));},_removeStatusClasses=function(fileElem){_.each(['uploading','done','error','queued'],function(type){fileElem.removeClass('ipsAttach_'+type);});},_updateCount=function(){$(elem).find('[data-role="count"]').text(uploadCount);elem.trigger('uploadedCountChanged',{count:uploadCount,percent:pluploadObj.total.percent,uploader:options.name});},_setPercent=function(fileElem,percent){fileElem.find('[data-role="progressbar"]').css({width:percent+'%'});if(percent===100){ips.utils.anim.go('fadeOut fast',fileElem.find('.ipsAttachment_progress'));}},_buildThumb=function(fileElem,file,info){var toInsert='';if(info.imagesrc){Debug.log(fileElem.find('[data-role="preview"]'));toInsert=$('<img/>').attr({src:info.thumbnail?info.thumbnail:info.imagesrc}).addClass('ipsImage');fileElem.attr('data-fullsizeurl',info.imagesrc).attr('data-thumbnailurl',info.thumbnail?info.thumbnail:info.imagesrc).find('[data-role="preview"]').html(toInsert).css('background-image','url( "'+(info.thumbnail?info.thumbnail:info.imagesrc)+'")');}
fileElem.attr('data-fileid',info.id);},_deleteFile=function(fileElem,e){e.preventDefault();e.stopPropagation();ips.getAjax()(options.action+'&postKey='+options.postkey+'&deleteFile='+encodeURIComponent(fileElem.attr('data-fileid')));uploadCount--;_updateCount();fileElem.animationComplete(function(){fileElem.remove();elem.trigger('fileDeleted',{fileElem:fileElem,uploader:options.name});});ips.utils.anim.go('fadeOutDown',fileElem);},_supportsDraggable=function(){if('draggable'in document.createElement('span')&&typeof FileReader!='undefined'&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return true;}
return false;},events={init:function(up,err){if(_supportsDraggable()){var dropElement=$(up.settings.drop_element);var _drag=function(){var currentElem=null;$(document).on('dragenter',function(e){if(currentElem&&!$(e.target).is(dropElement)&&!$.contains(dropElement.get(0),currentElem)){dropElement.removeClass('ipsDragging');currentElem=null;}});dropElement.on('dragleave',function(e){if(!$(currentElem).is(dropElement)&&!$.contains(dropElement.get(0),currentElem)){dropElement.removeClass('ipsDragging');currentElem=null;}}).on('dragenter',function(e){var target=$(e.target);if(target.is(dropElement)||$.contains(dropElement.get(0),e.target)){dropElement.addClass('ipsDragging');currentElem=e.target;}}).on('drop',function(e){dropElement.removeClass('ipsDragging');currentElem=null;});}();}},filesAdded:function(up,files){if(!options.multiple){listContainer.find('[data-role="deleteFile"]').click();if(files.length>1){alert(ips.getString('uploadSingleErr'));return false;}}else if(options.maxTotalSize&&up.total.size>(options.maxTotalSize*1048576)){ips.ui.alert.show({type:'alert',icon:'warn',message:ips.getString('uploadTotalErr',{size:(options.maxTotalSize>1)?options.maxTotalSize:(options.maxTotalSize*1024),size_suffix:(options.maxTotalSize>1)?ips.getString('size_mb'):ips.getString('size_kb')}),callbacks:{}});return false;}
var tooLarge=0;_.each(files,function(file,idx){if(options.maxFileSize!==null&&((file.size/1024)>(options.maxFileSize*1024))){tooLarge++;up.removeFile(file);return;}
var size=plupload.formatSize(file.size),status=_getStatus(file.status),isImage=false;if(['jpg','jpeg','jpe','gif','png'].indexOf(file.name.substr((~-file.name.lastIndexOf(".")>>>0)+2).toLowerCase())!==-1){isImage=true;}
var data={uploaderID:uploaderID,id:file.id,title:file.name,size:size,status:status,statusCode:file.status,statusText:ips.getString('attachStatus',{size:size,status:status}),field_name:elem.attr('data-ipsUploader-name'),newUpload:true,insertable:true,isImage:isImage};$(elem).trigger('addUploaderFile',data);$('#'+file.id).addClass('ipsAttach_queued').trigger('newItem',[$('#'+file.id)]);});if(tooLarge){var errorString=ips.getString('uploadSizeErr',{max_file_size:(options.maxFileSize>1)?options.maxFileSize:(options.maxFileSize*1024),size_suffix:(options.maxFileSize>1)?ips.getString('size_mb'):ips.getString('size_kb')});ips.ui.alert.show({type:'alert',icon:'warn',message:ips.pluralize(errorString,[tooLarge,tooLarge]),callbacks:{}});}
if(up.files.length){elem.trigger('fileAdded',{count:up.files.length,uploader:options.name});if(options.autoStart){_startUpload();}}},filesRemoved:function(){Debug.log('removed');},uploadFile:function(up,file){var fileElem=_updateFileElement(file);fileElem.addClass('ipsAttach_uploading');},uploadProgress:function(up,file){var fileElem=_updateFileElement(file);fileElem.addClass('ipsAttach_uploading');_setPercent(fileElem,file.percent);elem.trigger('uploadProgress',{count:uploadCount,percent:pluploadObj.total.percent,uploader:options.name});},fileUploaded:function(up,file,info){uploadCount++;var fileElem=_updateFileElement(file);fileElem.addClass('ipsAttach_done');if(options.insertable){ips.utils.anim.go('fadeIn',fileElem.find('[data-role="insert"]'));}
ips.utils.anim.go('fadeIn',fileElem.find('[data-role="deleteFileWrapper"]'));_setPercent(fileElem,100);try{var jsonInfo=$.parseJSON(info.response);elem.before($('<input type="hidden">').attr('name',elem.attr('data-ipsUploader-name')+'_existing['+file.id+']').attr('value',jsonInfo.id));if(jsonInfo['error']){fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));file.status=plupload.FAILED;up.trigger('error',{code:jsonInfo['error'],extra:jsonInfo['extra'],file:file,uploader:options.name});return;}
if(jsonInfo){_buildThumb(fileElem,file,jsonInfo);fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));}}catch(err){fileElem.on('click','[data-role="deleteFile"]',_.bind(_deleteFile,fileElem,fileElem));file.status=plupload.FAILED;up.trigger('error',{code:'upload_error',extra:err.message,file:file,uploader:options.name});Debug.warn(err);}
if(inject){fileElem.dblclick();inject=false;}},error:function(up,err){if(err.file){_updateFileElement(err.file);}
if(err.code==-600||err.code==-601){errorCounts[(err.code==-600)?'size':'ext']++;return;}
var errorMessage=ips.getString('pluploaderr_'+err.code,{max_file_size:(options.maxFileSize>1)?options.maxFileSize:(options.maxFileSize*1024),size_suffix:(options.maxFileSize>1)?ips.getString('size_mb'):ips.getString('size_kb'),allowed_extensions:(options.allowedFileTypes!==null)?$.parseJSON(options.allowedFileTypes).join(','):'',server_error_code:(err.extra!==null)?err.extra:0});if(!errorMessage){errorMessage=ips.getString('pluploaderr_SERVER_CONFIGURATION',{server_error_code:err.code});}
ips.ui.alert.show({type:'alert',icon:'warn',message:errorMessage,callbacks:{}});}};init();return{init:init};}}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.validation',function(){var defaults={live:true,submit:true,characterLimit:3,displayAs:'list'};var respond=function(elem,options,e){if(!$(elem).data('_validation')){$(elem).data('_validation',validateObj(elem,_.defaults(options,defaults)));}};var validateObj=function(elem,options){var init=function(){if(options.live){$(elem).on('keyup blur','input:not( [type="button"] ):not( [type="checkbox"] ):not( [type="hidden"] )'+':not( [type="radio"] ):not( [data-validate-bypass] ), textarea:not( [data-validate-bypass] )',_textEvent);$(elem).on('change','select',_selectEvent);}
if(options.submit){$(elem).closest('form').on('submit',_submitEvent);}},_submitEvent=function(e){var errors=0;var elements=$(elem).find('input:not( [type="submit"] ):not( [type="checkbox"] )'+':not( [type="radio"] ):not( [type="hidden"] ), select, textarea');elements.each(function(){if(!_validate($(this))){errors++;}});if(errors>0){e.preventDefault();$(e.currentTarget).trigger('error.validation',{count:errors});}else{$(e.currentTarget).trigger('success.validation');}},_selectEvent=function(e){},_textEvent=function(e){var field=$(e.currentTarget);if(e.type=='blur'||e.type=='focusout'){if(field.val().length>=options.characterLimit||field.is('[type="number"], [type="range"]')){_validate(field);}}else{if(field.attr('data-hasErrors')){_validate(field);}}},_validate=function(target){var result=ips.utils.validate.validate(target);if(result!==true&&!result.result){_displayErrors(target,result);}else{_clearErrors(target);}
return result.result;},_displayErrors=function(target,results){var id=target.identify().attr('id');var errorList=$('#'+id+'_errors');if(!errorList.length){var wrapper=ips.templates.render('core.forms.validationWrapper',{id:id+'_errors'});target.after(wrapper);errorList=$('#'+id+'_errors');}
errorList.html('');for(var i=0;i<results.messages.length;i++){errorList.append(ips.templates.render('core.forms.validationItem',{message:results.messages[i].message}));}
target.addClass('ipsField_error').attr('data-hasErrors',true);},_clearErrors=function(target){var id=target.identify().attr('id');if($('#'+id+'_errors').length){$('#'+id+'_errors').remove();}
target.removeClass('ipsField_error').removeAttr('data-hasErrors');}
init();return{};};ips.ui.registerWidget('validation',ips.ui.validation);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.wizard',function(){var respond=function(elem,options,e){elem.on('click','[data-action="wizardLink"]',_.bind(refresh,e,elem));elem.on('submit','form',_.bind(refresh,e,elem));};var refresh=function(elem,e){var target=$(e.currentTarget);_showLoading(elem);if(target.is('form')){if(target.attr('data-bypassAjax')){return true;}
e.preventDefault();ips.getAjax()(target.attr('action'),{data:target.serialize(),type:'post'}).done(function(response){if(_.isObject(response)&&response.redirect){window.location=response.redirect;return;}
var responseWizard=$('<div>'+response+'</div>').find('[data-ipsWizard]').html();if(!responseWizard){responseWizard=response;}
elem.html(responseWizard);$(document).trigger('contentChange',[elem]);elem.trigger('wizardStepChanged');}).fail(function(response,textStatus,errorThrown){target.attr('data-bypassAjax',true);target.submit();})}else{e.preventDefault();ips.getAjax()(target.attr('href')).done(function(response){if(_.isObject(response)&&response.redirect){window.location=response.redirect;return;}
var responseWizard=$('<div>'+response+'</div>').find('[data-ipsWizard]').html();if(!responseWizard){responseWizard=response;}
elem.html(responseWizard);$(document).trigger('contentChange',[elem]);elem.trigger('wizardStepChanged');});}},_showLoading=function(elem){var loading=elem.find('[data-role="loading"]');var formContainer=elem.find('[data-role="wizardContent"]');if(!loading.length){loading=$('<div/>').attr('data-role','loading').addClass('ipsLoading').hide();elem.append(loading);}
var dims={width:formContainer.outerWidth(),height:formContainer.outerHeight()};loading.css({width:dims.width+'px',height:dims.height+'px'}).show();formContainer.hide().after(loading.show());},_hideLoading=function(){var loading=elem.find('[data-role="loading"]');var formContainer=elem.find('[data-role="registerForm"]');loading.remove();formContainer.show();};ips.ui.registerWidget('wizard',ips.ui.wizard);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils',function(options){var argsToArray=function(obj){return Array.prototype.slice.call(obj);},uppercaseFirst=function(fromString){return fromString.charAt(0).toUpperCase()+fromString.slice(1);},getIDsFromList=function(list){if(!list){return'';}
if(!_.isArray(list)){list=list.toString().split(',');}
list=_.compact(list);if(!list.length){return false;}
return _.map(list,function(val){return'#'+val;}).join(',');};return{argsToArray:argsToArray,uppercaseFirst:uppercaseFirst,getIDsFromList:getIDsFromList};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.anim',function(){var animationSupport=false;var elm=document.createElement('div'),animation=false,animationstring='animation',keyframeprefix='',domPrefixes='Webkit Moz O ms Khtml'.split(' '),pfx='';if(elm.style.animationName){animationSupport=true;}
if(animationSupport===false){for(var i=0;i<domPrefixes.length;i++){if(elm.style[domPrefixes[i]+'AnimationName']!==undefined){pfx=domPrefixes[i];animationstring=pfx+'Animation';keyframeprefix='-'+pfx.toLowerCase()+'-';animationSupport=true;break;}}}
var init=function(){},_transitions={fadeIn:{anim:function(elem,speed){cleanClasses(elem);return elem.show().addClass(['ipsAnim','ipsAnim_fade','ipsAnim_in',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.fadeIn('fast');}},fadeOut:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_fade','ipsAnim_out',speed].join(' ')).animationComplete(function(){elem.hide();cleanClasses(elem);});},fallback:function(elem){return elem.fadeOut('fast');}},fadeInDown:{anim:function(elem,speed){cleanClasses(elem);return elem.show().addClass(['ipsAnim','ipsAnim_fade','ipsAnim_in','ipsAnim_down',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.fadeIn('fast');}},fadeOutDown:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_fade','ipsAnim_out','ipsAnim_down',speed].join(' ')).animationComplete(function(){elem.hide();cleanClasses(elem);});},fallback:function(elem){return elem.fadeOut('fast');}},slideLeft:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_slide','ipsAnim_left',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.show();}},blindDown:{anim:function(elem,speed){cleanClasses(elem);return elem.show().addClass(['ipsAnim','ipsAnim_blind','ipsAnim_down',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.show();}},blindUp:{anim:function(elem,speed){cleanClasses(elem);return elem.show().addClass(['ipsAnim','ipsAnim_blind','ipsAnim_up',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.hide();}},zoomIn:{anim:function(elem,speed){cleanClasses(elem);return elem.show().addClass(['ipsAnim','ipsAnim_zoom','ipsAnim_in',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem.show();}},zoomOut:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_zoom','ipsAnim_out',speed].join(' ')).animationComplete(function(){elem.hide();cleanClasses(elem);});},fallback:function(elem){return elem.hide();}},wobble:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_wobble',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem;}},jiggle:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_jiggle'].join(' ')).animationComplete(function(){cleanClasses(elem);})},fallback:function(elem){return elem;}},pulseOnce:{anim:function(elem,speed){cleanClasses(elem);return elem.addClass(['ipsAnim','ipsAnim_pulseOnce',speed].join(' ')).animationComplete(function(){cleanClasses(elem);});},fallback:function(elem){return elem;}}},go=function(animationInfo){var thisArgs=arguments,run='anim';thisArgs=ips.utils.argsToArray(thisArgs);thisArgs.shift();animationInfo=animationInfo.split(' ');var animName=animationInfo[0];var animSpeed=(animationInfo[1])?'ipsAnim_'+animationInfo[1]:'';if(!_transitions[animName]){Debug.warn("The animation '"+animName+"' doesn't exist");return;}
if(!animationSupport){run='fallback';}
thisArgs.push(animSpeed);var elem=$(thisArgs[0]);var deferred=$.Deferred();var done=0;var _checkCount=function(){done++;if(done>=elem.length){deferred.resolve();}};_.each(elem,function(){_addToQueue(elem,animName,run,thisArgs).always(_checkCount);_checkQueue(elem);});return deferred.promise();},_addToQueue=function(elem,animName,toRun,args){var deferred=$.Deferred();if(!elem.data('animQueue')||!_.isArray(elem.data('animQueue'))){elem.data('animQueue',[]);}
elem.data('animQueue').push({animName:animName,run:toRun,args:args,deferred:deferred});return deferred.promise();},_checkQueue=function(elem){var queue=elem.data('animQueue');if(elem.attr('animating')==true||!queue||!_.isArray(queue)||!queue.length){return;}
var item=queue.shift();if(item.run=='anim'){elem.animationComplete(function(){elem.attr('animating',false);item.deferred.resolve();_checkQueue(elem);});elem.attr('animating',true);_transitions[item.animName][item.run].apply(this,item.args);}else{item.deferred.resolve();_transitions[item.animName][item.run].apply(this,item.args);_checkQueue(elem);}
item.deferred.resolve();},cleanClasses=function(elem){$(elem).removeClass('ipsAnim').removeClass(function(index,css){return(css.match(/ipsAnim[0-9a-z_\-]+/gi)||[]).join(' ');});return elem;},isTransition=function(name){return!_.isUndefined(_transitions[name]);},addTransition=function(name,cssAnimation,fallbackAnimation){if(_transitions[name]){Debug.warn("A transition with the name '"+name+"' already exists");return;}
_transitions[name]={anim:cssAnimation,fallback:fallbackAnimation};},scrollTo=function(elem,options){};return{init:init,cleanClasses:cleanClasses,animationSupport:animationSupport,isTransition:isTransition,addTransition:addTransition,go:go,cancel:cleanClasses};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.color',function(){var init=function(){};var convertHex=function(hex,toHue,toSat){hex=hex.replace('#','');if(hex.length===3){hex=hex.slice(0,1)+hex.slice(0,1)+hex.slice(1,2)+hex.slice(1,2)+hex.slice(2,3)+hex.slice(2,3);}
if(hex.length!==6){Debug.write(hex+" isn't a valid hex color");return false;}
var r=(hexToRGB(hex.slice(0,2))/255);var g=(hexToRGB(hex.slice(2,4))/255);var b=(hexToRGB(hex.slice(4,6))/255);var hsl=RGBtoHSL(r,g,b);hsl[0]=(1/360)*toHue;hsl[1]=(1/100)*toSat;var rgb=HSLtoRGB(hsl[0],hsl[1],hsl[2]);return RGBtoHex(rgb[0],rgb[1],rgb[2]);},HSLtoRGB=function(h,s,l){var red=0;var green=0;var blue=0;var v2=0;if(s==0){red=l*255;green=l*255;blue=l*255;}else{if(l<0.5){v2=l*(1+s);}else{v2=(l+s)-(s*l);}
var v1=2*l-v2;red=255*hueToRGB(v1,v2,(h+(1/3)));green=255*hueToRGB(v1,v2,h);blue=255*hueToRGB(v1,v2,(h-(1/3)));}
return[Math.round(red),Math.round(green),Math.round(blue)];},hueToRGB=function(v1,v2,h){if(h<0){h+=1;}
if(h>1){h-=1;}
if((6*h)<1){return(v1+(v2-v1)*6*h);}
if((2*h)<1){return v2;}
if((3*h)<2){return(v1+(v2-v1)*((2/3)-h)*6);}
return v1;},RGBtoHSL=function(r,g,b){var lightness,hue,saturation=0;var min=_.min([r,g,b]);var max=_.max([r,g,b]);var delta=max-min;lightness=(max+min)/2;if(delta==0){hue=0;saturation=0;}else{if(lightness<0.5){saturation=delta/(max+min);}else{saturation=delta/(2-max-min);}
var delta_r=(((max-r)/6)+(delta/2))/delta;var delta_g=(((max-g)/6)+(delta/2))/delta;var delta_b=(((max-b)/6)+(delta/2))/delta;if(r==max){hue=delta_b-delta_g;}else if(g==max){hue=(1/3)+delta_r-delta_b;}else if(b==max){hue=(2/3)+delta_g-delta_r;}
if(hue<0){hue+=1;}
if(hue>1){hue-=1;}}
return[hue,saturation,lightness];},hexToRGB=function(hex){return parseInt(hex,16);},RGBtoHex=function(r,g,b){var hex=[r.toString(16),g.toString(16),b.toString(16)];_.each(hex,function(val,nr){if(val.length==1){hex[nr]='0'+val;}});return hex.join('');};return{convertHex:convertHex,HSLtoRGB:HSLtoRGB,hueToRGB:hueToRGB,RGBtoHSL:RGBtoHSL,hexToRGB:hexToRGB,RGBtoHex:RGBtoHex};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.cookie',function(){var _toSkip=['session_id','ipb_admin_session_id','member_id','pass_hash'],_store={},_init=false;var init=function(){var cookies=_parseCookies(document.cookie.replace(" ",'')),cookieID=ips.getSetting('cookie_prefix')||false;$.each(cookies,function(key,cookie){if(cookieID){if(key.startsWith(cookieID)){key=key.replace(cookieID,'');}}
if(!_toSkip[key]){_store[key]=unescape(cookie||'');}});_init=true;},get=function(cookieKey){if(!_init){init();}
if(_store[cookieKey]){return _store[cookieKey];}
return undefined;},set=function(cookieKey,value,sticky){var expires='',path='/',domain='',ssl='',prefix='';if(!cookieKey){return;}
if(!_.isUndefined(sticky)){if(sticky===true){expires="; expires=Wed, 1 Jan 2020 00:00:00 GMT";}else if(sticky===-1){expires="; expires=Thu, 01-Jan-1970 00:00:01 GMT";}else if(sticky.length>10){expires="; expires="+sticky;}}
if(!_.isUndefined(ips.getSetting('cookie_domain'))&&ips.getSetting('cookie_domain')!=''){domain="; domain="+ips.getSetting('cookie_domain');}
if(!_.isUndefined(ips.getSetting('cookie_path'))&&ips.getSetting('cookie_path')!=''){path=ips.getSetting('cookie_path');}
if(!_.isUndefined(ips.getSetting('cookie_prefix'))&&ips.getSetting('cookie_prefix')!=''){prefix=ips.getSetting('cookie_prefix');}
if(!_.isUndefined(ips.getSetting('cookie_ssl'))&&ips.getSetting('cookie_ssl')!=''){ssl='; secure';}
document.cookie=prefix+cookieKey+"="+escape(value)+"; path="+path+expires+domain+ssl+';';_store[cookieKey]=value;},unset=function(cookieKey){if(_store[cookieKey]){set(cookieKey,'',-1);}},_parseCookies=function(cookieString){var pairs=cookieString.split(";"),cookies={};for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("=");cookies[$.trim(pair[0])]=$.trim(unescape(pair[1]));}
return cookies;};return{init:init,get:get,set:set,unset:unset};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.css',function(){var prefixes=['webkit','moz','ms','o','w3c'];var init=function(){},buildStyleBlock=function(selector,styles,important){var output=selector+" {\n";var getValue=function(key,value){return"\t"+key+': '+value+((important)?' !important':'')+";\n";};_.each(styles,function(value,key){if(_.isArray(value)){for(var i=0;i<value.length;i++){output+=getValue(key,value[i]);}}else{output+=getValue(key,value);}});output+="}";return output;},supportsTransform=function(){var bs=document.body.style;if(!_.isUndefined(bs.transform)||!_.isUndefined(bs.WebkitTransform)||!_.isUndefined(bs.MozTransform)||!_.isUndefined(bs.OTransform)){return true;}
return false;},replaceStyle=function(stylesheetID,selector,styles){var stylesheet=getStylesheetRef(stylesheetID);var styleBlock=buildStyleBlock(selector,styles);var rulesKey=(stylesheet['cssRules'])?'cssRules':'rules';var done=false;for(var rules=0;rules<stylesheet[rulesKey].length;rules++){if(stylesheet[rulesKey][rules].selectorText==selector){stylesheet.deleteRule(rules);stylesheet.insertRule(styleBlock,rules);done=true;}}
if(!done){var idx=stylesheet.insertRule(styleBlock,stylesheet[rulesKey].length);}},getStylesheetRef=function(stylesheetID){var stylesheets=document.styleSheets;for(var sheet=0;sheet<stylesheets.length;sheet++){if(stylesheets[sheet].ownerNode.id==stylesheetID){return stylesheets[sheet];}}
return false;},generateGradient=function(angle,stops,asPureCSS){var stops=_buildStops(stops);var angles=_buildAngles(angle);var output=[];for(var i=0;i<prefixes.length;i++){output.push(_buildPrefix(prefixes[i],'linear-gradient')+'('+angles[prefixes[i]]+', '+stops+')');}
if(!asPureCSS){return output;}else{var prefixOutput=[];for(var i=0;i<output.length;i++){prefixOutput.push('background-image: '+output[i]+';');}
return prefixOutput.join("\n");}},_buildStops=function(stops){var line=[];for(var i=0;i<stops.length;i++){if(stops[i][0].charAt(0)!='#'){stops[i][0]='#'+stops[i][0];}
line.push(stops[i][0]+' '+stops[i][1]+'%');}
return line.join(',');},_buildAngles=function(angle){var mapDegrees={'0':'right','90':'top','-90':'bottom','180':'left'};var opposites={'0':'180','90':'-90','-90':'90','180':'0'};var output={};for(var i=0;i<prefixes.length;i++){if(!_.isUndefined(mapDegrees[angle])){if(prefixes[i]=='w3c'){output[prefixes[i]]='to '+mapDegrees[opposites[angle]];}else{output[prefixes[i]]=mapDegrees[angle];}}else{output[prefixes[i]]=angle+'deg';}}
return output;},_buildPrefix=function(vendor,style){return((vendor!='w3c')?'-'+vendor+'-':'')+style;};return{generateGradient:generateGradient,replaceStyle:replaceStyle,getStylesheetRef:getStylesheetRef,buildStyleBlock:buildStyleBlock};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.db',function(){var enabled=null;var init=function(queryString){enabled=isEnabled();},set=function(type,key,value){if(enabled){if(value)
{localStorage.setItem(type+'.'+key,JSON.stringify(value));}
else
{localStorage.removeItem(type+'.'+key);}}},get=function(type,key){if(_.isUndefined(key)){return getByType(type);}
var val=localStorage.getItem(type+'.'+key);try{return JSON.parse(val);}catch(err){return val;}},remove=function(type,key){if(_.isUndefined(key)){removeByType(type);return;}
localStorage.removeItem(type+'.'+key);},getByType=function(type){try{var dbLen=localStorage.length;}catch(e){return{};}
var results={};if(dbLen){for(var key in localStorage){if(key.startsWith(type+'.')){var actualKey=key.replace(type+'.','');results[actualKey]=get(type,actualKey);}}}
return results;},removeByType=function(type){var dbLen=localStorage.length;var count=0;if(dbLen){for(var key in localStorage){if(key.startsWith(type+'.')){remove(key);count++;}}}
return count;},isEnabled=function(){if(!_.isBoolean(enabled)){try{if('localStorage'in window&&window['localStorage']!==null&&window.JSON){return true;}else{return false;}}catch(e){return false;}}else{return enabled;}};init();return{set:set,get:get,getByType:getByType,remove:remove,removeByType:removeByType,enabled:enabled,isEnabled:isEnabled};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.defaultEditorPlugins',function(){return{inline:function(command,html){return{exec:function(editor){var range=editor.getSelection().getRanges()[0];var selected=range.extractContents();var element=new CKEDITOR.dom.element('span');element.setHtml(html.replace('{contents}','<span data-content-marker="true"></span>').replace('{content}','<span data-content-marker="true"></span>'));var spans=element.getElementsByTag('span');for(var i=0;i<spans.count();i++){if(spans.getItem(i).hasAttribute('data-content-marker')){selected.insertAfterNode(spans.getItem(i));spans.getItem(i).remove();}}
editor.insertHtml(element.getHtml());}}},block:function(command,tagName,tagAttributes,beforeContent,includeContent,afterContent,optionValue){if(tagName=='p'){tagName='div';}
return{exec:function(editor){var selection=editor.getSelection(),range=selection&&selection.getRanges(true)[0];if(!range)
return;var bookmarks=selection.createBookmarks();if(CKEDITOR.env.ie){var bookmarkStart=bookmarks[0].startNode,bookmarkEnd=bookmarks[0].endNode,cursor;if(bookmarkStart&&bookmarkStart.getParent().getName()==tagName){cursor=bookmarkStart;while((cursor=cursor.getNext())){if(cursor.type==CKEDITOR.NODE_ELEMENT&&cursor.isBlockBoundary()){bookmarkStart.move(cursor,true);break;}}}
if(bookmarkEnd&&bookmarkEnd.getParent().getName()==tagName){cursor=bookmarkEnd;while((cursor=cursor.getPrevious())){if(cursor.type==CKEDITOR.NODE_ELEMENT&&cursor.isBlockBoundary()){bookmarkEnd.move(cursor);break;}}}}
var iterator=range.createIterator(),block;iterator.enlargeBr=editor.config.enterMode!=CKEDITOR.ENTER_BR;var paragraphs=[];while((block=iterator.getNextParagraph()))
paragraphs.push(block);if(paragraphs.length<1){var para=editor.document.createElement(editor.config.enterMode==CKEDITOR.ENTER_P?'p':'div'),firstBookmark=bookmarks.shift();range.insertNode(para);para.append(new CKEDITOR.dom.text('\ufeff',editor.document));range.moveToBookmark(firstBookmark);range.selectNodeContents(para);range.collapse(true);firstBookmark=range.createBookmark();paragraphs.push(para);bookmarks.unshift(firstBookmark);}
var commonParent=paragraphs[0].getParent(),tmp=[];for(var i=0;i<paragraphs.length;i++){block=paragraphs[i];commonParent=commonParent.getCommonAncestor(block.getParent());}
var denyTags={table:1,tbody:1,tr:1,ol:1,ul:1};while(denyTags[commonParent.getName()])
commonParent=commonParent.getParent();var lastBlock=null;while(paragraphs.length>0){block=paragraphs.shift();while(!block.getParent().equals(commonParent))
block=block.getParent();if(!block.equals(lastBlock))
tmp.push(block);lastBlock=block;}
while(tmp.length>0){block=tmp.shift();if(block.getName()==tagName){var docFrag=new CKEDITOR.dom.documentFragment(editor.document);while(block.getFirst()){docFrag.append(block.getFirst().remove());paragraphs.push(docFrag.getLast());}
docFrag.replace(block);}else
paragraphs.push(block);}
if(optionValue){beforeContent=beforeContent.replace('{option}',optionValue);afterContent=afterContent.replace('{option}',optionValue);var _tagAttributes=tagAttributes;tagAttributes={};for(i in _tagAttributes){var newI=i.replace('{option}',optionValue);tagAttributes[newI]=_tagAttributes[i].replace('{option}',optionValue);}}
var bqBlock=editor.document.createElement(tagName);bqBlock.setAttributes(tagAttributes);bqBlock.insertBefore(paragraphs[0]);if(beforeContent){bqBlock.appendHtml(beforeContent);}
if(includeContent){while(paragraphs.length>0){block=paragraphs.shift();bqBlock.append(block);}}
if(afterContent){bqBlock.appendHtml(afterContent);}
selection.selectBookmarks(bookmarks);editor.focus();}}}};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.events',function(){var manualEvent=function(element,ev){if(_.isObject(element)){element.each(function(){_fireEvent(this,ev);});}else{_fireEvent(element,ev);}},isTouchDevice=function(){return(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));},_fireEvent=function(element,ev){if(document.createEvent){var evObj=document.createEvent('MouseEvents');evObj.initEvent(ev,true,false);element.dispatchEvent(evObj);}else if(document.createEventObject){var evObj=document.createEventObject();element.fireEvent('on'+evt,evObj);}};return{manualEvent:manualEvent,isTouchDevice:isTouchDevice};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.position',function(){var theWindow=$(window);var getElemPosition=function(elem){if(!elem){return false;}
var elem=$(elem);var props={};var hidden=!elem.is(':visible');var opacity=elem.css('opacity');if(hidden){elem.css({opacity:0.0001}).show();}
var offset=elem.offset();var position=elem.position();var dims=getElemDims(elem);props.absPos={left:offset.left,top:offset.top,right:(offset.left+dims.outerWidth),bottom:(offset.top+dims.outerHeight),};props.offsetPos={left:position.left,top:position.top,right:(position.left+dims.outerWidth),bottom:(position.top+dims.outerHeight)};props.viewportOffset={left:offset.left-theWindow.scrollLeft(),top:offset.top-theWindow.scrollTop()};props.offsetParent=elem.offsetParent();props.fixed=(hasFixedParents(elem,true));if(hidden){elem.hide().css({opacity:opacity});}
return props;},positionElem=function(options){var trigger=$(options.trigger);var triggerPos=getElemPosition(trigger);var triggerDims=getElemDims(trigger);var targetDims=getElemDims(options.target);var toReturn={};var stemOffset=options.stemOffset||{top:0,left:0};var offsetParent;var positioned=false;if(options.targetContainer){if(hasFixedParents(trigger)){offsetParent=triggerPos.viewportOffset;}else{var containerPos=getElemPosition(options.targetContainer);var containerOffset;if($(options.targetContainer).css('position')=='static'){containerOffset=$(options.targetContainer).position();}else{containerOffset={left:0,top:0};}
offsetParent={left:(triggerPos.absPos.left-containerPos.absPos.left)+containerOffset.left,top:(triggerPos.absPos.top-containerPos.absPos.top)+containerOffset.top};}
positioned=true;}else{offsetParent=triggerPos.viewportOffset;}
var bestFit=_getBestFit(triggerPos.viewportOffset,triggerDims,targetDims,stemOffset,{horizontal:(options.center)?'center':'left',vertical:(options.above===true)?'top':'bottom'},!options.above);switch(bestFit.horizontal){case'center':toReturn.left=offsetParent.left+(triggerDims.outerWidth/2)-
(targetDims.outerWidth/2);break;case'left':toReturn.left=offsetParent.left-stemOffset.left+(triggerDims.outerWidth/2);break;case'right':toReturn.left=offsetParent.left-targetDims.outerWidth+
(triggerDims.outerWidth/2)+stemOffset.left;break;}
switch(bestFit.vertical){case'top':toReturn.top=offsetParent.top-targetDims.outerHeight+
stemOffset.top;break;case'bottom':toReturn.top=offsetParent.top+triggerDims.outerHeight-
stemOffset.top;break;}
if(!positioned&&!triggerPos.fixed){toReturn.top+=theWindow.scrollTop();}
toReturn.fixed=triggerPos.fixed;toReturn.location=bestFit;return toReturn;},hasFixedParents=function(elem,andSelf){elem=$(elem);var fixed=false;var parents=elem.parents();if(andSelf){parents=parents.addBack();}
parents.each(function(){if(this.style.position=='fixed'){fixed=true;}});return fixed;},_getBestFit=function(viewportOffset,triggerDims,targetDims,offset,posDefaults,preferBottom){var position=_.defaults(posDefaults||{},{vertical:'bottom',horizontal:'left'});if(position.horizontal=='center'){var targetLeft=viewportOffset.left+(triggerDims.outerWidth/2)-(targetDims.outerWidth/2);var targetRight=targetLeft+targetDims.outerWidth;if(targetLeft<0||targetRight>theWindow.width()){position.horizontal='left';}}
if(position.horizontal=='left'){if((viewportOffset.left+targetDims.outerWidth-offset.left)>theWindow.width()){position.horizontal='right';}}else if(position.horizontal=='right'){if((viewportOffset.right-targetDims.outerWidth+offset.left)<0){position.horizontal='left';}}
if(position.vertical=='top'||preferBottom){if((viewportOffset.top-targetDims.outerHeight-offset.top)<0){position.vertical='bottom';}}else{if((viewportOffset.top+triggerDims.outerHeight+targetDims.outerHeight+offset.top)>theWindow.height()){position.vertical='top';}}
return position;},getElemDims=function(elem){elem=$(elem);return{width:elem.width(),height:elem.height(),outerWidth:elem.outerWidth(),outerHeight:elem.outerHeight()};},naturalWidth=function(elem){return _getNatural(elem,'Width');},naturalHeight=function(elem){return _getNatural(elem,'Height');},_getNatural=function(elem,type){if(('natural'+type)in new Image()){return elem[0]['natural'+type];}else{var img=new Image();img.src=elem[0].src;return img['natural'+type];}};return{getElemPosition:getElemPosition,getElemDims:getElemDims,positionElem:positionElem,hasFixedParents:hasFixedParents,naturalWidth:naturalWidth,naturalHeight:naturalHeight};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.responsive',function(options){options=$.extend({breakpoints:{980:'desktop',770:'tablet',0:'phone'}});var self=this,previousBreakpoint=[],currentBreakpoint=[],breakpointsBySize={},breakpointsByKey={},callbacks={};var currentIs=function(toCheck){if(_.isNumber(toCheck)){return currentBreakpoint[0]==toCheck;}else{return toCheck&&currentBreakpoint[1]==toCheck;}},getCurrentKey=function(){return currentBreakpoint[1];},getAllBreakpoints=function(){return breakpointsBySize;},addBreakpoint=function(breakpoint,name){breakpointsBySize[breakpoint]=name;breakpointsByKey[name]=breakpoint;callbacks[breakpoint]={enter:[],exit:[]};},addCallback=function(breakpoint,type,callback){if(!breakpointsBySize[breakpoint]||(type!='enter'&&type!='exit')){return false;}
callbacks[breakpoint][type].push(callback);},checkForBreakpointChange=function(){var newBreak=getCurrentBoundary();if(newBreak!=currentBreakpoint[0]){executeCallbacks(newBreak,currentBreakpoint[0]);previousBreakpoint=currentBreakpoint;currentBreakpoint=[newBreak,breakpointsBySize[newBreak]];$(document).trigger('breakpointChange',{curBreakSize:newBreak,curBreakName:breakpointsBySize[newBreak]});}},executeCallbacks=function(enterPoint,exitPoint){if(!_.isUndefined(enterPoint)&&!_.isUndefined(callbacks[enterPoint]['enter'])&&callbacks[enterPoint]['enter'].length){$.each(callbacks[enterPoint]['enter'],function(idx,thisCallback){thisCallback();});}
if(!_.isUndefined(exitPoint)&&callbacks[exitPoint]['exit'].length){$.each(callbacks[exitPoint]['exit'],function(idx,thisCallback){thisCallback();});}},getCurrentBoundary=function(){var curWidth=$(window).width();var curBreak;var possibleSizes=_.filter(breakpointsByKey,function(num){return curWidth>=num;});if(possibleSizes.length){curBreak=_.max(possibleSizes,function(num){return parseInt(num);});}else{curBreak=_.min(breakpointsByKey,function(num){return parseInt(num);});}
return curBreak;},init=function(){$.each(options.breakpoints,function(size,name){addBreakpoint(size,name);});$(window).resize(windowResize);checkForBreakpointChange();},windowResize=function(){checkForBreakpointChange();},enabled=function(){return true;};init();return{addBreakpoint:addBreakpoint,addCallback:addCallback,currentIs:currentIs,getCurrentKey:getCurrentKey,getAllBreakpoints:getAllBreakpoints,enabled:enabled}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.time',function(){var _supportsLocale=null;var readable=function(timestamp){var date=new Date();var time=date.getTime()/1000;var dst=0;var now=time+dst;var elapsed=now-timestamp;if(elapsed<60){return ips.getString('time_just_now');}else if(elapsed<3600){return ips.pluralize(ips.getString('time_minutes_ago'),Math.floor(elapsed/60));}else if(elapsed<5400){return ips.getString('time_1_hour_ago');}else if(elapsed<86400){return ips.pluralize(ips.getString('time_hours_ago'),Math.floor(elapsed/3600));}else{var time=new Date(timestamp*1000).toLocaleString();time=time.split('').reverse().join('');time=time.substr(time.indexOf(' ')+1);time=time.split('').reverse().join('');return ips.getString('time_other',{time:time});}},isDST=function(){var today=new Date();var jan=new Date(today.getFullYear(),0,1);var jul=new Date(today.getFullYear(),6,1);var stdOffset=Math.max(jan.getTimezoneOffset(),jul.getTimezoneOffset());return today.getTimezoneOffset()<stdOffset;},isValidDateObj=function(d){if(Object.prototype.toString.call(d)!=="[object Date]"){return false;}
return!isNaN(d.getTime());},localeDateString=function(date,options){if(!_.isBoolean(_supportsLocale)){_supportsLocale=_checkLocaleSupport();}
if(_supportsLocale&&_.isObject(options)&&window.navigator.language){return date.toLocaleDateString(window.navigator.language,options);}else{return date.toLocaleDateString();}},_checkLocaleSupport=function(){try{new Date().toLocaleDateString("i");}catch(e){return e.name==="RangeError";}
return false;};return{readable:readable,localeDateString:localeDateString,isValidDateObj:isValidDateObj};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.url',function(){var _skipped=['s'],_store={};var init=function(queryString){},getParam=function(name,url){return parseUri(url||window.location.href).queryKey[name];},getURIObject=function(url){return parseUri(url||window.location.href);};function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};return{getParam:getParam,getURIObject:getURIObject};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.validate',function(options){var formats={email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))){2,6}$/i,url:/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/,alphanum:/^\w+$/,integer:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/,creditcard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,hex:/^[0-9a-f]+$/i};var validators={maxlength:function(val,max){return val.length<=max;},minlength:function(val,min){return val.length>=min;},rangelength:function(val,min,max){return validators.maxlength(val,max)&&validators.minlength(val,min);},min:function(val,min){return Number(val)>=min;},max:function(val,max){return Number(val)<=max;},range:function(val,min,max){return validators.min(val,min)&&validators.max(val,max);},required:function(val){return val.length>0},regex:function(val,regex){return new RegExp(regex).test(val);},format:function(val,format){return new RegExp(formats[format]).test(val);},remote:function(val,url){var deferred=$.Deferred();ips.getAjax()(url,{dataType:'json',data:{input:encodeURI(val)}}).done(function(response){if(response.result=='ok'){deferred.resolve();}else{deferred.reject(response.message||null);}}).fail(function(jqHXR,textStatus){deferred.reject(textStatus);});return deferred.promise();}};var addFormat=function(name,format){formats[name]=format;},addValidator=function(name,fn){validators[name]=fn;};var isUrl=function(url){return validators.regex(url,formats.url);},isAllowedUrl=function(url){var returnValue;returnValue=true;if(ips.getSetting('blacklist'))
{for(var i in ips.getSetting('blacklist'))
{var blacklistUrl=ips.getSetting('blacklist')[i];blacklistUrl=escapeRegExp(blacklistUrl);blacklistUrl=blacklistUrl.replace('\\*','(.+?)');var index=url.search(new RegExp(blacklistUrl,'ig'));if(index>=0)
{returnValue=false;break;}}}
if(ips.getSetting('whitelist'))
{returnValue=false;for(var i in ips.getSetting('whitelist'))
{var whitelistUrl=ips.getSetting('whitelist')[i];whitelistUrl=escapeRegExp(whitelistUrl);whitelistUrl=whitelistUrl.replace('\\*','(.+?)');var index=url.search(new RegExp(whitelistUrl,'ig'));if(index>=0)
{returnValue=true;break;}}}
return returnValue;},isEmail=function(email){return validators.regex(email,formats.email);};var validate=function(field,conditions,ignoreHTML5){if(!ignoreHTML5){conditions=_.extend(_getAutomaticConditions(field),conditions||{});}
if(!_.size(conditions)){return true;}
var validated=true;var messages=[];for(var i in conditions){if(!_.isFunction(validators[i])){continue;}
var value=field.val();var args=[];if(_.isObject(conditions[i])){args=_.values(conditions[i])
args.splice(0,1);}else{args=[conditions[i]];}
args.unshift(value);if(validators[i].apply(this,args)!==true){validated=false;messages.push({condition:i,message:_getMessage(i,args)});}}
return{result:validated,messages:messages}},_getMessage=function(type,args){return ips.getString('validation_'+type,{data:args});},_getAutomaticConditions=function(field){var conditions={};if(field.is('[required]')){conditions.required=true;}
if(field.is('input[type="number"], input[type="range"], input[type="email"], input[type="url"]')){conditions.format=field.attr('type');}
if(field.is('[max]')){conditions.max=field.attr('max');}
if(field.is('[min]')){conditions.min=field.attr('min');}
if(field.is('[pattern]')){conditions.regex=field.attr('pattern');}
return conditions;};return{isUrl:isUrl,isEmail:isEmail,addFormat:addFormat,addValidator:addValidator,validate:validate,isAllowedUrl:isAllowedUrl}});}(jQuery,_));var escapeRegExp;(function(){var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp('['+specials.join('\\')+']','g');escapeRegExp=function(str){return str.replace(regex,"\\$&");};}());;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.customtags',{editorWrap:null,editorSidebar:null,editorSidebarHeader:null,editorSidebarList:null,initialize:function(){this.on('click','[data-tagKey]',this.insertTag);this.on('click','[data-action="tagsToggle"]',this.toggleSidebar);this.setup();},setup:function(){var self=this;this.editorWrap=this.scope.find('[data-role="editor"]');this.editorSidebar=this.scope.find('.ipsComposeArea_sidebar');this.editorSidebarList=this.editorSidebar.find('[data-role="tagsList"]');this.editorSidebarHeader=this.editorSidebar.find('[data-role="tagsHeader"]');setInterval(function(){var editorHeight=self.editorWrap.outerHeight();var headerHeight=self.editorSidebarHeader.outerHeight();self.editorSidebarList.css({height:(editorHeight-headerHeight)+'px'});},300);},toggleSidebar:function(e){e.preventDefault();if(this.editorSidebar.hasClass('ipsComposeArea_sidebarOpen')){this.editorSidebar.removeClass('ipsComposeArea_sidebarOpen').addClass('ipsComposeArea_sidebarClosed');ips.utils.cookie.unset('tagSidebar');}else{this.editorSidebar.removeClass('ipsComposeArea_sidebarClosed').addClass('ipsComposeArea_sidebarOpen');ips.utils.cookie.set('tagSidebar',true,true);}},insertTag:function(e){var content=$(e.currentTarget).attr('data-tagKey');if(this.scope.attr('data-tagFieldType')=='editor'){this.trigger('insertText',{editorID:this.scope.attr('data-tagFieldID'),content:'<span>'+content+'</span>'});}else if(this.scope.attr('data-tagFieldType')=='codemirror'){this.scope.trigger('codeMirrorInsert',{elemID:$(e.currentTarget).closest('[data-codemirrorid]').attr('data-codemirrorid'),tag:content});}else{var textField=$('#'+this.scope.attr('data-tagFieldID'));textField.focus().insertText(content,textField.getSelection().start,'collapseToEnd');}}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.emoticons',{_doneInit:false,_emoticonsObj:{},_typeTimer:null,_lastVal:'',_lastActive:null,initialize:function(){this.on(document,'menuOpened',this.menuOpened);this.on('menuItemSelected','[data-role="categoryTrigger"]',this.changeCategory);this.on('focus','[data-role="emoticonSearch"]',this.searchEmoticons);this.on('blur','[data-role="emoticonSearch"]',this.stopSearchEmoticons);this.on('click','[data-emoticon]',this.insertEmoticon);this.setup();},setup:function(){var self=this;this.editorID=this.scope.attr('data-editorID');if(!this._doneInit){if(!_.size(this._emoticonsObj)){this._getJSON().done(function(){self._buildEmoticonsPanel();self._buildOverview();});}else{this._buildEmoticonsPanel();this._buildOverview();}}},insertEmoticon:function(e){var emoticonKey=$(e.currentTarget).attr('data-emoticon');var emoticonSrc=$(e.currentTarget).attr('data-src');this.trigger($(document),'insertEmoticon',{editorID:this.editorID,text:emoticonKey,src:emoticonSrc});if(e&&!e.shiftKey){this.scope.trigger('closeMenu');}
if(window.JSON){var emoticonCookie=ips.utils.cookie.get('recentEmoticons');var newItem={src:emoticonSrc,text:emoticonKey};if(!emoticonCookie){var json=[newItem];ips.utils.cookie.set('recentEmoticons',JSON.stringify(json),true);}else{try{var existing=$.parseJSON(emoticonCookie);}catch(err){Debug.warn('Invalid emoticon cookie');return;}
for(var key in existing){var obj=existing[key];if(obj.src==newItem.src){return;}}
existing.unshift(newItem);if(existing.length>7){existing.splice((existing.length-7)*-1,existing.length-7);}
ips.utils.cookie.set('recentEmoticons',JSON.stringify(existing),true);}}},searchEmoticons:function(e){var lastActive=this.scope.find('[data-panel]:visible').attr('data-panel');if(lastActive!='search'){this._lastActive=lastActive;}
this._typeTimer=setInterval(_.bind(this._typing,this),200);},stopSearchEmoticons:function(e){if(this._typeTimer){clearInterval(this._typeTimer);this._typeTimer=null;}},_typing:function(){var textElem=this.scope.find('[data-role="emoticonSearch"]');if(this._lastVal==textElem.val()){return;}
if(textElem.val()==''){this._clearSearch();}else{this._doSearch(textElem.val());}
this._lastVal=textElem.val();},_clearSearch:function(){if(this.scope.find('[data-panel="search"]')){this.scope.find('[data-panel="search"]').remove();if(!this._lastActive){this._lastActive='overview';}
this.scope.find('[data-panel="'+this._lastActive+'"]').show();}},_doSearch:function(value){var panel=this._getSearchPanel();var matchEmoticons=[];for(var cat in this._emoticonsObj){var catLength=this._emoticonsObj[cat].emoticons.length;for(var i=0;i<catLength;i++){if(this._emoticonsObj[cat].emoticons[i].src.indexOf(value)!==-1||this._emoticonsObj[cat].emoticons[i].text.indexOf(value)!==-1){matchEmoticons.push({src:this._emoticonsObj[cat].emoticons[i].src,text:this._emoticonsObj[cat].emoticons[i].text});}}}
if(!matchEmoticons.length){panel.html(ips.templates.render('core.editor.emoticonNoResults'));}else{var rows=this._buildEmoticonRows(matchEmoticons);var content=ips.templates.render('core.editor.emoticonCategory',{emoticons:rows.join(''),title:ips.getString('emoticonSearch'),categoryID:'search'});panel.html(ips.templates.render('core.editor.emoticonSection',{content:content,id:'search'}));}},_getSearchPanel:function(){var panel=this.scope.find('[data-panel="search"]');if(!panel.length){this.scope.find('.ipsMenu_innerContent').append(ips.templates.render('core.editor.emoticonSection',{content:'',id:'search'}));panel=this.scope.find('[data-panel="search"]');this.scope.find('[data-panel]').hide();ips.utils.anim.go('fadeIn',this.scope.find('[data-panel="search"]'));}
return panel;},menuOpened:function(e,data){if(data.elemID=='elEmoticons'){data.originalEvent.preventDefault();if(!this._doneInit){this._buildEmoticonsPanel();this._buildOverview();}}},changeCategory:function(e,data){if(!$.contains(this.scope.get(0),data.triggerElem)){return;}
data.originalEvent.preventDefault();e.stopPropagation();var categoryID=data.selectedItemID||false;if(categoryID===false||(categoryID!='overview'&&!this._emoticonsObj[categoryID])){return;}
if(this.scope.find('[data-panel="'+categoryID+'"]').is(':visible')){return;}
if(!this.scope.find('[data-panel="'+categoryID+'"]').length){var primaryContent='';var rows=this._buildEmoticonRows(this._emoticonsObj[categoryID].emoticons);primaryContent=ips.templates.render('core.editor.emoticonCategory',{emoticons:rows.join(''),title:this._emoticonsObj[categoryID].title,categoryID:categoryID});this.scope.find('.ipsMenu_innerContent').append(ips.templates.render('core.editor.emoticonSection',{content:primaryContent,id:categoryID}));}
this.scope.find('[data-panel]').hide();ips.utils.anim.go('fadeIn',this.scope.find('[data-panel="'+categoryID+'"]'));},_buildEmoticonsPanel:function(){var menuContent=[];for(var cat in this._emoticonsObj){menuContent.push(ips.templates.render('core.editor.emoticonMenu',{title:this._emoticonsObj[cat].title,count:this._emoticonsObj[cat].total,categoryID:cat}));}
$(this.scope).find('[data-role="categoryMenu"]').append(menuContent.join(''));this._doneInit=true;},_getJSON:function(){var deferred=$.Deferred();var self=this;if(this._ajaxObj&&this._ajaxObj.abort){this._ajaxObj.abort();}
this._ajaxObj=ips.getAjax();this._setLoading();this._ajaxObj(ips.getSetting('baseURL')+'?app=core&module=system&controller=editor&do=emoticons',{dataType:'json'}).done(function(emoticons){ips.setSetting('emoticons',emoticons);self._emoticonsObj=emoticons;deferred.resolve();}).fail(function(){deferred.reject();}).always(function(){self._setLoadingDone();});return deferred.promise();},_setLoading:function(){this.scope.find('[data-panel="loading"]').remove().end().find('.ipsMenu_innerContent').append(ips.templates.render('core.editor.emoticonSection',{content:'',id:'loading'})).find('[data-panel="loading"]').css({height:'150px'}).addClass('ipsLoading').end().end().find('[data-role="emoticonSearch"]').prop('disabled',true).end().find('[data-role="categoryTrigger"]').hide();},_setLoadingDone:function(){this.scope.find('[data-panel="loading"]').remove().end().find('[data-role="emoticonSearch"]').prop('disabled',false).end().find('[data-role="categoryTrigger"]').show();},_buildOverview:function(){var primaryContent=[];var cookie=ips.utils.cookie.get('recentEmoticons');try{var recentlyUsed=$.parseJSON(cookie);var rows=this._buildEmoticonRows(recentlyUsed,7);primaryContent.push(ips.templates.render('core.editor.emoticonCategory',{emoticons:rows.join(''),title:ips.getString('emoticonRecent'),categoryID:'recent'}));}catch(err){Debug.warn('Problem loading recently used emoticons cookie.');}
for(var cat in this._emoticonsObj){var rows=this._buildEmoticonRows(this._emoticonsObj[cat].emoticons,21);primaryContent.push(ips.templates.render('core.editor.emoticonCategory',{emoticons:rows.join(''),title:this._emoticonsObj[cat].title,categoryID:cat}));}
this.scope.find('.ipsMenu_innerContent').html(ips.templates.render('core.editor.emoticonSection',{content:primaryContent.join(''),id:'overview'}));},_buildEmoticonRows:function(emoticons,max){if(!max){max=emoticons.length;}
var thisCategory=[];var emoticonArray=[];var pos=0;for(var i=0;i<max;i++){if(pos==0&&_.isUndefined(emoticons[i])){break;}
if(!_.isUndefined(emoticons[i])){emoticonArray.push(ips.templates.render('core.editor.emoticonItem',{tag:emoticons[i].text,src:emoticons[i].src,img:"<img src='"+emoticons[i].src+"'>"}));this._testEmoticon(emoticons[i].src);}else{emoticonArray.push(ips.templates.render('core.editor.emoticonBlank'));}
pos++;if(pos==7||(i+1)==max){thisCategory.push(ips.templates.render('core.editor.emoticonRow',{emoticons:emoticonArray.join('')}));pos=0;emoticonArray=[];}}
return thisCategory;},_testEmoticon:function(emoticon){var image=new Image();var noerror=true;image.onerror=function(){$('[data-src="'+emoticon+'"]').remove();}
image.src=emoticon;}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.image',{_typingTimer:null,_textTypingTimer:null,_ajaxObj:null,_imageWidth:null,initialize:function(){this.on('submit','form',this.formSubmit);this.on('focus','[data-role="imageWidth"]',this.focusImageWidth);this.on('change','[data-role="imageWidth"]',this.blurImageWidth);},formSubmit:function(e){e.preventDefault();e.stopPropagation();this.updateImage(e);},focusImageWidth:function(e){this._imageWidth=$(this.scope).find('[data-role="imageWidth"]').val();},blurImageWidth:function(e){if(this._imageWidth){var ratio=$(this.scope).find('[data-role="imageWidth"]').val()/this._imageWidth;$(this.scope).find('[data-role="imageHeight"]').val(Math.floor($(this.scope).find('[data-role="imageHeight"]').val()*ratio));}},updateImage:function(e){var error=false;if(parseInt($(this.scope).find('[data-role="imageWidth"]').val())>parseInt($(this.scope).find('[data-role="imageWidth"]').attr('max'))){error=true;$(this.scope).find('[data-role="imageWidth"]').closest('.ipsFieldRow').addClass('ipsFieldRow_error');$(this.scope).find('[data-role="imageSizeWarning"]').text(ips.getString('editorImageMaxWidth',{'maxwidth':$(this.scope).find('[data-role="imageWidth"]').attr('max')}));}
if(parseInt($(this.scope).find('[data-role="imageHeight"]').val())>parseInt($(this.scope).find('[data-role="imageHeight"]').attr('max'))){error=true;$(this.scope).find('[data-role="imageWidth"]').closest('.ipsFieldRow').addClass('ipsFieldRow_error');$(this.scope).find('[data-role="imageSizeWarning"]').text(ips.getString('editorImageMaxHeight',{'maxheight':$(this.scope).find('[data-role="imageHeight"]').attr('max')}));}
if(!error){var editor=CKEDITOR.instances[$(this.scope).data('editorid')];var selection=editor.getSelection();var selectedElement=selection.getSelectedElement();if($(this.scope).find('[data-role="imageLink"]').val()){var url=$(this.scope).find('[data-role="imageLink"]').val();if(!url.match(/^[a-z]+\:\/\//i)){url='http://'+url;}
if($(selectedElement.$).parent().prop('tagName')==='A'){$(selectedElement.$).parent().attr('href',url);}else{$(selectedElement.$).wrap($('<a>').attr('href',url));}}else{if($(selectedElement.$).parent().prop('tagName')==='A'){$(selectedElement.$).parent().replaceWith($(selectedElement.$));}}
$(selectedElement.$).css({"width":$(this.scope).find('[data-role="imageWidth"]').val(),"height":$(this.scope).find('[data-role="imageHeight"]').val(),"border":$(this.scope).find('[data-role="imageBorder"]').val()+'px solid black',"margin":$(this.scope).find('[data-role="imageMargin"]').val()+'px'});if($(this.scope).find('[data-role="imageAlign"]:checked').val()){if($(selectedElement.$).parent().prop('tagName')==='A'){$(selectedElement.$).parent().css('float',$(this.scope).find('[data-role="imageAlign"]:checked').val());}else{$(selectedElement.$).css('float',$(this.scope).find('[data-role="imageAlign"]:checked').val());}}else{$(selectedElement.$).css('float','');if($(selectedElement.$).parent().prop('tagName')==='A'){$(selectedElement.$).parent().css('float','');}}
this.trigger('closeDialog');}}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.insertable',{_editorID:'',_selectedItems:{},initialize:function(){this.on('click','[data-action="insertFile"]',this.insertFile);this.on('click','[data-action="selectFile"]',this.selectFile);this.on('click','[data-action="insertSelected"]',this.insertSelected);this.on('click','[data-action="clearAll"]',this.clearSelection);this.setup();},setup:function(){this._editorID=this.scope.attr('data-editorID');},selectFile:function(e){e.preventDefault();var thisAttach=$(e.currentTarget).closest('.ipsAttach');var thisToggle=thisAttach.find('[data-action="selectFile"]');var thisDataRow=thisAttach.closest('.ipsDataItem');if(thisToggle.hasClass('ipsAttach_selectionOn')){thisToggle.removeClass('ipsAttach_selectionOn');if(thisDataRow.length){thisDataRow.removeClass('ipsDataItem_selected');}else{thisAttach.removeClass('ipsAttach_selected');}
this._removeSelectedItem(thisAttach);}else{thisToggle.addClass('ipsAttach_selectionOn');if(thisDataRow.length){thisDataRow.addClass('ipsDataItem_selected');}else{thisAttach.addClass('ipsAttach_selected');}
this._addSelectedItem(thisAttach);}},clearSelection:function(e){if(e){e.preventDefault();}
if(!_.size(this._selectedItems)){return;}
this._selectedItems={};this.scope.find('.ipsAttach_selectionOn').removeClass('ipsAttach_selectionOn').closest('.ipsAttach').removeClass('ipsAttach_selected').end().closest('.ipsDataItem').removeClass('ipsDataItem_selected');this._checkSelectedButton();},insertSelected:function(e){e.preventDefault();var self=this;if(!_.size(this._selectedItems)){return;}
var editor=CKEDITOR.instances[this._editorID];_.each(this._selectedItems,function(item){if(item.type=='file'){editor.insertHtml('&nbsp;');}
editor.insertElement(self._buildInsert(item,editor));});this.clearSelection();if(!this.scope.closest('[data-role="attachmentArea"]').length){this.trigger('closeDialog');}},insertFile:function(e){if(e){e.preventDefault();}
var editor=CKEDITOR.instances[this._editorID];var insertData=this._buildInsertData($(e.target));if(insertData.type=='file'){editor.insertHtml('&nbsp;');}
editor.insertElement(this._buildInsert(insertData,editor));if(!this.scope.closest('[data-role="attachmentArea"]').length){this.trigger('closeDialog');}},_addSelectedItem:function(element){var fileID=element.attr('data-fileid');this._selectedItems[fileID]=this._buildInsertData(element);this._checkSelectedButton();},_removeSelectedItem:function(element){var fileID=element.attr('data-fileid');if(!_.isUndefined(this._selectedItems[fileID])){delete this._selectedItems[fileID];}
this._checkSelectedButton();},_checkSelectedButton:function(){var button=this.scope.find('[data-action="insertSelected"]');this.scope.find('[data-action="clearAll"]').toggleClass('ipsButton_disabled',!(_.size(this._selectedItems)>0));button.toggleClass('ipsButton_disabled',!(_.size(this._selectedItems)>0));if(!_.size(this._selectedItems)){button.text(ips.getString('insertSelected'));}else{button.text(ips.pluralize(ips.getString('insertSelectedNum'),_.size(this._selectedItems)));}},_buildInsertData:function(element){var element=element.closest('.ipsAttach');var fileID=element.attr('data-fileid');var type=(element.attr('data-isImage'))?'image':'file';var url='';var image='';if(type=='image'){url=(element.attr('data-thumbnailurl'))?element.attr('data-thumbnailurl'):element.attr('data-fullsizeurl');if(url!=element.attr('data-fullsizeurl')){image=element.attr('data-fullsizeurl');}}else{url=(element.attr('data-filelink'))?element.attr('data-filelink'):'';}
return{fileID:fileID,type:type,title:(type!='image')?element.find('[data-role="title"]').html():'',link:url,fullImage:image};},_buildInsert:function(item,editor){var element=null;if(item.type=='image'){element=editor.document.createElement('img');element.setAttribute('data-fileid',item.fileID);element.setAttribute('src',item.link);element.addClass('ipsImage ipsImage_thumbnailed');if(item.fullImage){var link=editor.document.createElement('a');link.setAttribute('href',item.fullImage);link.addClass('ipsAttachLink ipsAttachLink_image');element.addClass('ipsImage_thumbnailed');link.append(element);element=link;}}else{element=editor.document.createElement('a');element.setHtml(item.title);element.addClass('ipsAttachLink');if(item.link){element.setAttribute('href',item.link);}else{element.setAttribute('href',ips.getSetting('baseURL')+'applications/core/interface/file/attachment.php?id='+item.fileID);}}
return element;}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.link',{_typingTimer:null,_textTypingTimer:null,_ajaxObj:null,initialize:function(){this.on('submit','form',this.formSubmit);this.on('click','.cEditorURLButtonInsert',this.formSubmit);this.on('click','[data-action="linkRemoveButton"]',this.removeLink);this.scope.find('[data-role="linkURL"]').focus();},formSubmit:function(e){e.preventDefault();this.insertLink(e);},insertLink:function(e){var url=this.scope.find('[data-role="linkURL"]').val();if(!url.match(/^[a-z]+\:\/\//i)&&!url.match(/^mailto\:/i)){url='http://'+url;}
var editor=CKEDITOR.instances[$(this.scope).data('editorid')];if($(this.scope).data('image')){var element=CKEDITOR.dom.element.createFromHtml("<img src='"+url+"' class='ipsImage'>");var self=this;var dialog=ips.ui.dialog.getObj($('#'+this.scope.closest('.ipsDialog').attr('id').replace(/_dialog$/,'')));dialog.setLoading(true);ips.getAjax()(ips.getSetting('baseURL')+'?app=core&module=system&controller=editor&do=validateLink&url='+encodeURIComponent(url)).done(function(response){if(response.embed){var element=CKEDITOR.dom.element.createFromHtml(response.preview);}
self.scope.find('input.cEditorURL').val('');editor.insertElement(element);dialog.setLoading(false);self.trigger('closeDialog');}).fail(function(){self.scope.find('input.cEditorURL').val('');editor.insertElement(element);dialog.setLoading(false);self.trigger('closeDialog');});}else{var title=this.scope.find('[data-role="linkText"]').val().replace(/ {2}/g,' &nbsp;');if(!title){title=decodeURI(url);}
var element=CKEDITOR.dom.element.createFromHtml("<a href='"+url+"'>"+title+"</a>");this.scope.find('input.cEditorURL').val('');editor.insertElement(element);this.trigger('closeDialog');}},removeLink:function(e){e.preventDefault();e.stopPropagation();var editor=CKEDITOR.instances[$(this.scope).data('editorid')];editor.insertHtml(this.scope.find('[data-role="linkText"]').val().replace(/ {2}/g,' &nbsp;'));this.trigger('closeDialog');},});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.mymedia',{initialize:function(){$(window).on('resize',_.bind(this._resizeContentArea,this));this.setup();},setup:function(){this._resizeContentArea();},_resizeContentArea:function(){var dialogHeight=this.scope.closest('.ipsDialog_content').outerHeight();var controlsHeight=this.scope.find('.cMyMedia_controls').outerHeight();this.scope.find('[data-role="myMediaContent"]').css({height:(dialogHeight-controlsHeight-10)+'px'});}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.mymediasection',{_timer:null,_ajax:null,_value:'',initialize:function(){this.on('focus','[data-role="myMediaSearch"]',this.focusMediaSearch);this.on('blur','[data-role="myMediaSearch"]',this.blurMediaSearch);this.on('paginationClicked',this.paginationClicked);},paginationClicked:function(e,data){var self=this;var results=this.scope.find('[data-role="myMediaResults"]');data.originalEvent.preventDefault();this._ajax=ips.getAjax()(data.href,{showLoading:true}).done(function(response){results.html(response);$(document).trigger('contentChange',[results]);});},focusMediaSearch:function(){this._timer=setInterval(_.bind(this._checkValue,this),700);},blurMediaSearch:function(){clearInterval(this._timer);},_checkValue:function(){var value=this.scope.find('[data-role="myMediaSearch"]').val();if(value==this._value){return;}
this._value=value;this._loadResults();},_loadResults:function(){var self=this;var url=this.scope.attr('data-url');if(this._ajax&&this._ajax.abort){this._ajax.abort();}
this.scope.find('[data-role="myMediaSearch"]').addClass('ipsField_loading');this._ajax=ips.getAjax()(url,{data:{search:this._value}}).done(function(response){self.scope.find('[data-role="myMediaResults"]').html(response);}).always(function(){self.scope.find('[data-role="myMediaSearch"]').removeClass('ipsField_loading');});}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('core.global.editor.uploader',{initialize:function(){this.on('addUploaderFile',this.addUploaderFile);this.on('removeAllFiles',this.removeAllFiles);this.on('fileDeleted',this.fileDeleted);this.setup();},setup:function(){this.scope.find('[data-role="fileContainer"]').each(function(){if($(this).children().length>0){$(this).parent().removeClass('ipsHide');}});},removeAllFiles:function(e,data){this.scope.find('[data-role="files"], [data-role="images"]').hide();this.scope.find('[data-role="fileList"]').hide();},addUploaderFile:function(e,data){e.stopPropagation();var container=null;var template='core.attachments.';this.scope.find('[data-role="fileList"]').show();if(data.isImage){container=this.scope.find('[data-role="images"]');template+='imageItem';}else{container=this.scope.find('[data-role="files"]');template+='fileItem';}
container.show().find('[data-role="fileContainer"]').append(ips.templates.render(template,data));},fileDeleted:function(e,data){var count=0;this.scope.find('[data-role="fileContainer"]').each(function(){if(!$(this).find('.ipsAttach').length){$(this).closest('[data-role="files"], [data-role="images"]').hide();count++;}});if(count==2){this.scope.find('[data-role="fileList"]').hide();}}});}(jQuery,_));;